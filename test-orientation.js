/**
 * üß™ SCRIPT DE TESTS AUTOMATIS√âS - SYST√àME D'ORIENTATION
 * Date: 23 octobre 2025
 * 
 * Ce script teste les 4 profils types d√©finis dans ORIENTATION_TESTS_INTEGRATION.md
 * pour valider le nouveau syst√®me de matching contextuel.
 * 
 * USAGE: node test-orientation.js
 * Note: Ce script simule le comportement de orientationService.js c√¥t√© serveur
 */

// Simulation simple des fonctions de orientationService pour tests Node.js
// (Alternative: utiliser un bundler ou tester via navigateur)

const calculateOrientationScores = (answers) => {
  // Simuler le calcul des scores (logique simplifi√©e pour tests)
  const scores = {
    scientific: 0,
    literary: 0,
    technical: 0,
    artistic: 0,
    social: 0,
    commercial: 0,
  };

  const preferences = {
    preferred_subjects: answers.Q1 || [],
    disliked_subjects: answers.Q2 || [],
    preferred_work_environment: answers.Q3 || '',
    financial_constraint: answers.Q13 || '',
    family_network: answers.Q14 || '',
    location: answers.Q15 || '',
    network_access: answers.Q16 || '',
    religious_importance: 0,
    career_goals: answers.Q18 || '',
  };

  // Calculer scores (questions Q4-Q12)
  const domainMapping = {
    Q4: 'scientific', Q5: 'literary', Q6: 'technical',
    Q7: 'artistic', Q8: 'social', Q9: 'commercial',
    Q10: 'scientific', Q11: 'literary', Q12: 'technical',
  };

  Object.entries(domainMapping).forEach(([qId, domain]) => {
    if (answers[qId]) {
      scores[domain] += (answers[qId] / 5) * 100;
    }
  });

  // Normaliser
  Object.keys(scores).forEach(domain => {
    const count = Object.values(domainMapping).filter(d => d === domain).length;
    scores[domain] = scores[domain] / count;
  });

  // Religious importance (Q17: 1-5 ‚Üí 0-100)
  if (answers.Q17) {
    preferences.religious_importance = ((answers.Q17 - 1) / 4) * 100;
  }

  return { scores, preferences };
};

const matchCareers = async (scores, preferences, userLevel) => {
  // Mock des 20 m√©tiers (avec les nouveaux champs)
  const mockCareers = [
    { id: '1', slug: 'ingenieur-informatique', title: 'Ing√©nieur Informatique', financial_requirement: 'high', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_scientific: 90, interest_technical: 85 },
    { id: '2', slug: 'medecin-generaliste', title: 'M√©decin G√©n√©raliste', financial_requirement: 'high', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_scientific: 95, interest_social: 80 },
    { id: '3', slug: 'data-scientist', title: 'Data Scientist', financial_requirement: 'high', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_scientific: 95, interest_technical: 80 },
    { id: '4', slug: 'pharmacien', title: 'Pharmacien', financial_requirement: 'high', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_scientific: 85 },
    { id: '5', slug: 'expert-comptable', title: 'Expert Comptable', financial_requirement: 'medium', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_commercial: 80 },
    { id: '6', slug: 'responsable-marketing', title: 'Responsable Marketing', financial_requirement: 'medium', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_commercial: 90 },
    { id: '7', slug: 'entrepreneur', title: 'Entrepreneur', financial_requirement: 'medium', requires_network: true, preferred_location: 'semi-urban', religious_friendly: 'neutral', interest_commercial: 95 },
    { id: '8', slug: 'gestionnaire-rh', title: 'Gestionnaire RH', financial_requirement: 'medium', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_social: 85 },
    { id: '9', slug: 'designer-graphique', title: 'Designer Graphique', financial_requirement: 'low', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_artistic: 95 },
    { id: '10', slug: 'community-manager', title: 'Community Manager', financial_requirement: 'low', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_social: 80 },
    { id: '11', slug: 'journaliste', title: 'Journaliste', financial_requirement: 'medium', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_literary: 85 },
    { id: '12', slug: 'photographe-professionnel', title: 'Photographe Professionnel', financial_requirement: 'low', requires_network: true, preferred_location: 'semi-urban', religious_friendly: 'neutral', interest_artistic: 95 },
    { id: '13', slug: 'avocat', title: 'Avocat', financial_requirement: 'high', requires_network: true, preferred_location: 'urban', religious_friendly: 'neutral', interest_literary: 80 },
    { id: '14', slug: 'assistant-social', title: 'Assistant Social', financial_requirement: 'low', requires_network: false, preferred_location: 'semi-urban', religious_friendly: 'friendly', interest_social: 95 },
    { id: '15', slug: 'psychologue', title: 'Psychologue', financial_requirement: 'medium', requires_network: false, preferred_location: 'urban', religious_friendly: 'neutral', interest_social: 90 },
    { id: '16', slug: 'electricien-batiment', title: '√âlectricien B√¢timent', financial_requirement: 'low', requires_network: false, preferred_location: 'rural', religious_friendly: 'neutral', interest_technical: 95 },
    { id: '17', slug: 'mecanicien-automobile', title: 'M√©canicien Automobile', financial_requirement: 'low', requires_network: false, preferred_location: 'semi-urban', religious_friendly: 'neutral', interest_technical: 95 },
    { id: '18', slug: 'technicien-maintenance-informatique', title: 'Technicien Maintenance Informatique', financial_requirement: 'medium', requires_network: false, preferred_location: 'urban', religious_friendly: 'neutral', interest_technical: 90 },
    { id: '19', slug: 'agronome', title: 'Agronome', financial_requirement: 'medium', requires_network: false, preferred_location: 'rural', religious_friendly: 'neutral', interest_scientific: 75 },
    { id: '20', slug: 'veterinaire', title: 'V√©t√©rinaire', financial_requirement: 'high', requires_network: false, preferred_location: 'rural', religious_friendly: 'neutral', interest_scientific: 85 },
  ];

  // Calculer compatibilit√© pour chaque m√©tier
  const careersWithScores = mockCareers.map(career => {
    let compatibilityScore = 0;

    // 1. Similarit√© d'int√©r√™ts (base 60% du score)
    Object.keys(scores).forEach(domain => {
      const careerInterest = career[`interest_${domain}`] || 0;
      const userScore = scores[domain];
      const similarity = 100 - Math.abs(careerInterest - userScore);
      compatibilityScore += (similarity * 0.6) / 6;
    });

    // 2. Ajustements financiers
    if (preferences.financial_constraint?.includes('√âlev√©e') && career.financial_requirement === 'high') {
      compatibilityScore -= 15;
    } else if (preferences.financial_constraint?.includes('Moyenne') && career.financial_requirement === 'high') {
      compatibilityScore -= 7;
    }

    // 3. Bonus r√©seau
    if (career.requires_network) {
      if (preferences.network_access?.includes('Fort')) {
        compatibilityScore += 10;
      } else if (preferences.network_access?.includes('Limit√©')) {
        compatibilityScore += 5;
      }
    }

    // 4. Ajustement localisation
    if (preferences.location === 'rural' && career.preferred_location === 'urban') {
      compatibilityScore -= 5;
    } else if (preferences.location === 'urban' && career.preferred_location === 'rural') {
      compatibilityScore -= 5;
    }

    // 5. Compatibilit√© religieuse
    if (preferences.religious_importance >= 60) {
      if (career.religious_friendly === 'friendly') {
        compatibilityScore += 10;
      } else if (career.religious_friendly === 'challenging') {
        compatibilityScore -= 10;
      }
    }

    // Limiter entre 0 et 100
    compatibilityScore = Math.max(0, Math.min(100, compatibilityScore));

    return { ...career, compatibilityScore };
  });

  // Trier par score d√©croissant
  return careersWithScores.sort((a, b) => b.compatibilityScore - a.compatibilityScore);
};

// ===================================================================
// PROFILS DE TEST
// ===================================================================

const TEST_PROFILES = {
  // TEST 1: √âtudiant Rural avec Contraintes Financi√®res √âlev√©es
  AMINATA: {
    name: 'Aminata',
    description: '√âtudiante rurale (BFEM) avec contraintes financi√®res √©lev√©es',
    level: 'bfem',
    answers: {
      Q1: ['Math√©matiques', 'SVT', 'Physique'],
      Q2: ['Fran√ßais', 'Anglais'],
      Q3: 'Terrain',
      Q4: 5,   // Scientifique (Math√©matiques)
      Q5: 2,   // Litt√©raire
      Q6: 4,   // Technique
      Q7: 2,   // Artistique
      Q8: 4,   // Social
      Q9: 2,   // Commercial
      Q10: 4,  // Scientifique (Exp√©riences)
      Q11: 2,  // Litt√©raire (D√©bat)
      Q12: 5,  // Technique (Construire)
      Q13: '√âlev√©e (√©tudes longues difficiles)',
      Q14: 'Oui, mais limit√©',
      Q15: 'rural',
      Q16: 'Limit√©',
      Q17: 3,  // Importance religieuse (normalis√©e √† 60/100)
      Q18: 'Avoir un m√©tier stable et aider ma communaut√©',
      Q19: 'rural',
      Q20: 'Ind√©pendance financi√®re et respect de la famille',
    },
    expectedTopCareers: ['electricien-batiment', 'mecanicien-automobile', 'agronome'],
    expectedExcluded: ['ingenieur-informatique', 'medecin-generaliste', 'data-scientist'],
    criteria: {
      financialLowInTop3: true,
      ruralInTop5: true,
      noHighFinancialInTop5: true,
      electricienScoreAbove75: true,
    },
  },

  // TEST 2: √âtudiant Urbain avec Fort R√©seau Professionnel
  MOUSSA: {
    name: 'Moussa',
    description: '√âtudiant urbain (BAC) avec fort r√©seau professionnel',
    level: 'bac',
    answers: {
      Q1: ['√âconomie', 'Math√©matiques', 'Anglais'],
      Q2: ['SVT', 'Physique'],
      Q3: 'Bureau',
      Q4: 3,   // Scientifique
      Q5: 4,   // Litt√©raire
      Q6: 2,   // Technique
      Q7: 3,   // Artistique
      Q8: 3,   // Social
      Q9: 5,   // Commercial
      Q10: 2,  // Scientifique
      Q11: 4,  // Litt√©raire
      Q12: 1,  // Technique
      Q13: 'Faible (famille peut financer)',
      Q14: 'Oui, r√©seau fort (entrepreneurs, professionnels)',
      Q15: 'urban',
      Q16: 'Fort et stable',
      Q17: 1,  // Importance religieuse faible (20/100)
      Q18: 'Cr√©er ma propre entreprise et innover',
      Q19: 'urban',
      Q20: 'R√©ussite financi√®re et impact social',
    },
    expectedTopCareers: ['entrepreneur', 'responsable-marketing', 'expert-comptable'],
    expectedExcluded: ['electricien-batiment', 'agronome', 'veterinaire'],
    criteria: {
      networkRequiredInTop5: 3,
      entrepreneurInTop3: true,
      noRuralInTop5: true,
      urbanScoresAbove80: true,
    },
  },

  // TEST 3: √âtudiant avec Forte Importance Religieuse
  FATOU: {
    name: 'Fatou',
    description: '√âtudiante (BAC) avec forte importance religieuse',
    level: 'bac',
    answers: {
      Q1: ['Fran√ßais', 'Histoire-G√©ographie', 'SVT'],
      Q2: ['Math√©matiques', 'Physique'],
      Q3: 'Mixte',
      Q4: 2,   // Scientifique
      Q5: 4,   // Litt√©raire
      Q6: 1,   // Technique
      Q7: 3,   // Artistique
      Q8: 5,   // Social (tr√®s √©lev√©)
      Q9: 2,   // Commercial
      Q10: 3,  // Scientifique
      Q11: 4,  // Litt√©raire
      Q12: 1,  // Technique
      Q13: 'Moyenne',
      Q14: 'Oui, mais limit√©',
      Q15: 'semi-urban',
      Q16: 'Mod√©r√©',
      Q17: 5,  // Importance religieuse maximale (100/100)
      Q18: 'Aider les personnes en difficult√© tout en respectant mes valeurs',
      Q19: 'semi-urban',
      Q20: 'Servir ma communaut√© et avoir un impact positif',
    },
    expectedTopCareers: ['assistant-social', 'psychologue', 'gestionnaire-rh'],
    criteria: {
      assistantSocialInTop3: true,
      assistantSocialBonusApplied: true,
      socialScoreHigh: true,
    },
  },

  // TEST 4: √âtudiant sans Contraintes (Profil Privil√©gi√©)
  IBRAHIMA: {
    name: 'Ibrahima',
    description: '√âtudiant urbain (BAC) sans contraintes financi√®res',
    level: 'bac',
    answers: {
      Q1: ['Math√©matiques', 'Physique', 'SVT', 'Chimie'],
      Q2: ['Arts plastiques'],
      Q3: 'Bureau',
      Q4: 5,   // Scientifique
      Q5: 2,   // Litt√©raire
      Q6: 4,   // Technique
      Q7: 1,   // Artistique
      Q8: 4,   // Social
      Q9: 2,   // Commercial
      Q10: 5,  // Scientifique
      Q11: 2,  // Litt√©raire
      Q12: 4,  // Technique
      Q13: 'Faible (famille peut financer)',
      Q14: 'Oui, r√©seau fort (entrepreneurs, professionnels)',
      Q15: 'urban',
      Q16: 'Fort et stable',
      Q17: 3,  // Importance religieuse mod√©r√©e (60/100)
      Q18: 'Devenir m√©decin et aider les gens',
      Q19: 'urban',
      Q20: 'Excellence professionnelle et contribution √† la sant√© publique',
    },
    expectedTopCareers: ['medecin-generaliste', 'ingenieur-informatique', 'data-scientist', 'pharmacien'],
    criteria: {
      noFinancialPenalty: true,
      networkBonusApplied: true,
      medecinOrIngenieurInTop2: true,
      top1ScoreAbove85: true,
    },
  },
};

// ===================================================================
// FONCTIONS DE VALIDATION
// ===================================================================

const validateCriteria = (profile, results) => {
  const { careers, scores, preferences } = results;
  const top5Slugs = careers.slice(0, 5).map(c => c.slug);
  const top3Slugs = careers.slice(0, 3).map(c => c.slug);
  const validations = [];

  console.log(`\nüìã Validation des crit√®res pour ${profile.name}:`);

  // Crit√®res sp√©cifiques par profil
  switch (profile.name) {
    case 'Aminata': {
      // Crit√®re 1: Au moins 1 m√©tier low financial dans Top 3
      const hasFinancialLowTop3 = careers.slice(0, 3).some(c => c.financial_requirement === 'low');
      validations.push({
        test: 'Au moins 1 m√©tier financial_requirement=low dans Top 3',
        passed: hasFinancialLowTop3,
        actual: careers.slice(0, 3).map(c => `${c.title} (${c.financial_requirement})`).join(', '),
      });

      // Crit√®re 2: Au moins 1 m√©tier rural dans Top 5
      const hasRuralTop5 = careers.slice(0, 5).some(c => c.preferred_location === 'rural');
      validations.push({
        test: 'Au moins 1 m√©tier preferred_location=rural dans Top 5',
        passed: hasRuralTop5,
        actual: careers.slice(0, 5).map(c => `${c.title} (${c.preferred_location})`).join(', '),
      });

      // Crit√®re 3: Aucun m√©tier high financial dans Top 5
      const hasHighFinancialTop5 = careers.slice(0, 5).some(c => c.financial_requirement === 'high');
      validations.push({
        test: 'Aucun m√©tier financial_requirement=high dans Top 5',
        passed: !hasHighFinancialTop5,
        actual: hasHighFinancialTop5 ? '√âCHEC: m√©tier high trouv√©' : 'OK',
      });

      // Crit√®re 4: Score √âlectricien > 75
      const electricien = careers.find(c => c.slug === 'electricien-batiment');
      validations.push({
        test: 'Score √âlectricien B√¢timent > 75',
        passed: electricien && electricien.compatibilityScore > 75,
        actual: electricien ? `${electricien.compatibilityScore.toFixed(1)}` : 'Non trouv√©',
      });
      break;
    }

    case 'Moussa': {
      // Crit√®re 1: Au moins 3 m√©tiers requires_network=true dans Top 5
      const networkCount = careers.slice(0, 5).filter(c => c.requires_network).length;
      validations.push({
        test: 'Au moins 3 m√©tiers requires_network=true dans Top 5',
        passed: networkCount >= 3,
        actual: `${networkCount} m√©tiers`,
      });

      // Crit√®re 2: Entrepreneur dans Top 3
      const entrepreneurInTop3 = top3Slugs.includes('entrepreneur');
      validations.push({
        test: 'Entrepreneur dans Top 3',
        passed: entrepreneurInTop3,
        actual: entrepreneurInTop3 ? `Rang ${top3Slugs.indexOf('entrepreneur') + 1}` : 'Non trouv√© en Top 3',
      });

      // Crit√®re 3: Aucun m√©tier rural dans Top 5
      const hasRural = careers.slice(0, 5).some(c => c.preferred_location === 'rural');
      validations.push({
        test: 'Aucun m√©tier preferred_location=rural dans Top 5',
        passed: !hasRural,
        actual: hasRural ? '√âCHEC: m√©tier rural trouv√©' : 'OK',
      });

      // Crit√®re 4: Scores urbains > 80
      const urbanCareers = careers.slice(0, 5).filter(c => c.preferred_location === 'urban');
      const urbanScoresAbove80 = urbanCareers.every(c => c.compatibilityScore > 80);
      validations.push({
        test: 'M√©tiers urbains avec score > 80',
        passed: urbanScoresAbove80,
        actual: urbanCareers.map(c => `${c.title}: ${c.compatibilityScore.toFixed(1)}`).join(', '),
      });
      break;
    }

    case 'Fatou': {
      // Crit√®re 1: Assistant Social dans Top 3
      const assistantSocialInTop3 = top3Slugs.includes('assistant-social');
      validations.push({
        test: 'Assistant Social dans Top 3',
        passed: assistantSocialInTop3,
        actual: assistantSocialInTop3 ? `Rang ${top3Slugs.indexOf('assistant-social') + 1}` : 'Non trouv√© en Top 3',
      });

      // Crit√®re 2: Bonus religieux appliqu√© (+10 pour Assistant Social)
      const assistantSocial = careers.find(c => c.slug === 'assistant-social');
      validations.push({
        test: 'Bonus religieux visible pour Assistant Social (score √©lev√©)',
        passed: assistantSocial && assistantSocial.compatibilityScore > 75,
        actual: assistantSocial ? `Score: ${assistantSocial.compatibilityScore.toFixed(1)}` : 'Non trouv√©',
      });

      // Crit√®re 3: Score social √©lev√©
      validations.push({
        test: 'Score domaine Social > 80',
        passed: scores.social > 80,
        actual: `${scores.social.toFixed(1)}`,
      });
      break;
    }

    case 'Ibrahima': {
      // Crit√®re 1: Aucune p√©nalit√© financi√®re
      validations.push({
        test: 'Contrainte financi√®re = Faible (pas de p√©nalit√©)',
        passed: preferences.financial_constraint === 'Faible (famille peut financer)',
        actual: preferences.financial_constraint,
      });

      // Crit√®re 2: Bonus r√©seau appliqu√©
      validations.push({
        test: 'R√©seau fort d√©tect√©',
        passed: preferences.network_access === 'Fort et stable',
        actual: preferences.network_access,
      });

      // Crit√®re 3: M√©decin ou Ing√©nieur dans Top 2
      const medecinOrIngenieur = top3Slugs.slice(0, 2).some(slug =>
        slug === 'medecin-generaliste' || slug === 'ingenieur-informatique'
      );
      validations.push({
        test: 'M√©decin G√©n√©raliste OU Ing√©nieur Informatique dans Top 2',
        passed: medecinOrIngenieur,
        actual: careers.slice(0, 2).map(c => c.title).join(', '),
      });

      // Crit√®re 4: Top 1 score > 85
      validations.push({
        test: 'Score du Top 1 > 85',
        passed: careers[0].compatibilityScore > 85,
        actual: `${careers[0].compatibilityScore.toFixed(1)}`,
      });
      break;
    }
  }

  return validations;
};

// ===================================================================
// EX√âCUTION DES TESTS
// ===================================================================

const runTests = async () => {
  console.log('üß™ ==========================================');
  console.log('üß™ TESTS AUTOMATIS√âS - SYST√àME D\'ORIENTATION');
  console.log('üß™ ==========================================\n');

  const results = [];

  for (const [key, profile] of Object.entries(TEST_PROFILES)) {
    console.log(`\n${'='.repeat(80)}`);
    console.log(`üìä TEST: ${profile.name.toUpperCase()}`);
    console.log(`üìù Description: ${profile.description}`);
    console.log(`${'='.repeat(80)}\n`);

    try {
      // Calculer les scores
      console.log('‚öôÔ∏è  Calcul des scores...');
      const { scores, preferences } = calculateOrientationScores(profile.answers);

      console.log('\nüìà Scores de domaines:');
      Object.entries(scores).forEach(([domain, score]) => {
        console.log(`   ${domain}: ${score.toFixed(1)}`);
      });

      console.log('\nüîç Pr√©f√©rences contextuelles:');
      console.log(`   Contrainte financi√®re: ${preferences.financial_constraint}`);
      console.log(`   R√©seau familial: ${preferences.family_network}`);
      console.log(`   Localisation: ${preferences.location}`);
      console.log(`   Acc√®s Internet: ${preferences.network_access}`);
      console.log(`   Importance religieuse: ${preferences.religious_importance}/100`);

      // Matching des m√©tiers
      console.log('\nüéØ Matching des m√©tiers...');
      const matchedCareers = await matchCareers(scores, preferences, profile.level);

      console.log(`\n‚úÖ ${matchedCareers.length} m√©tiers trouv√©s`);
      console.log('\nüèÜ TOP 5 M√âTIERS RECOMMAND√âS:');
      matchedCareers.slice(0, 5).forEach((career, index) => {
        console.log(`   ${index + 1}. ${career.title} - ${career.compatibilityScore.toFixed(1)}% compatibilit√©`);
        console.log(`      üí∞ ${career.financial_requirement} | üåç ${career.preferred_location} | ü§ù ${career.requires_network ? 'R√©seau requis' : 'Pas de r√©seau'}`);
      });

      // Validation des crit√®res
      const validations = validateCriteria(profile, {
        careers: matchedCareers,
        scores,
        preferences,
      });

      let passedCount = 0;
      let failedCount = 0;

      validations.forEach(v => {
        if (v.passed) {
          console.log(`   ‚úÖ ${v.test}`);
          console.log(`      ‚Üí ${v.actual}`);
          passedCount++;
        } else {
          console.log(`   ‚ùå ${v.test}`);
          console.log(`      ‚Üí ${v.actual}`);
          failedCount++;
        }
      });

      const testPassed = failedCount === 0;

      results.push({
        profile: profile.name,
        passed: testPassed,
        passedCount,
        failedCount,
        totalCriteria: validations.length,
        topCareers: matchedCareers.slice(0, 5).map(c => c.title),
      });

      console.log(`\nüìä R√âSULTAT: ${testPassed ? '‚úÖ SUCC√àS' : '‚ùå √âCHEC'} (${passedCount}/${validations.length} crit√®res valid√©s)`);

    } catch (error) {
      console.error(`\n‚ùå ERREUR lors du test ${profile.name}:`, error);
      results.push({
        profile: profile.name,
        passed: false,
        error: error.message,
      });
    }
  }

  // R√©sum√© global
  console.log('\n\n' + '='.repeat(80));
  console.log('üìä R√âSUM√â GLOBAL DES TESTS');
  console.log('='.repeat(80) + '\n');

  const totalTests = results.length;
  const passedTests = results.filter(r => r.passed).length;
  const failedTests = totalTests - passedTests;

  results.forEach(r => {
    const status = r.passed ? '‚úÖ SUCC√àS' : '‚ùå √âCHEC';
    console.log(`${status} - ${r.profile}`);
    if (r.passedCount !== undefined) {
      console.log(`   Crit√®res valid√©s: ${r.passedCount}/${r.totalCriteria}`);
      console.log(`   Top 5: ${r.topCareers.join(', ')}`);
    }
    if (r.error) {
      console.log(`   Erreur: ${r.error}`);
    }
    console.log('');
  });

  console.log(`\nüéØ TOTAL: ${passedTests}/${totalTests} tests r√©ussis`);

  if (passedTests === totalTests) {
    console.log('\nüéâ TOUS LES TESTS SONT VALID√âS ! Le syst√®me de matching contextuel fonctionne correctement.\n');
    process.exit(0);
  } else {
    console.log(`\n‚ö†Ô∏è  ${failedTests} test(s) ont √©chou√©. V√©rifiez les d√©tails ci-dessus.\n`);
    process.exit(1);
  }
};

// Ex√©cuter les tests
runTests().catch(error => {
  console.error('‚ùå Erreur fatale:', error);
  process.exit(1);
});
