import{s as e}from"./index-80385b81.js";class t{constructor(e){this.userId=e,this.userData=null}async aggregateUserData(){try{const{data:s}=await e.from("profiles").select("*").eq("id",this.userId).single(),{data:n}=await e.from("user_points").select("*").eq("user_id",this.userId).single(),{data:a}=await e.from("user_progress").select("\n          *,\n          chapitres (\n            id, title,\n            matieres (id, name)\n          )\n        ").eq("user_id",this.userId),{data:i}=await e.from("exam_results").select("\n          *,\n          examens (id, title, type, difficulty, duration_minutes)\n        ").eq("user_id",this.userId).order("completed_at",{ascending:!1}),{data:r}=await e.from("user_badges").select("\n          id,\n          earned_at,\n          badge_id,\n          badges!inner (\n            badge_id,\n            name,\n            icon_name,\n            description\n          )\n        ").eq("user_id",this.userId).order("earned_at",{ascending:!1});let o=[];try{const{data:t}=await e.from("user_learning_challenges").select("*").eq("user_id",this.userId).order("created_at",{ascending:!1}).limit(10);o=t||[]}catch(t){}const{data:l}=await e.from("user_points_history").select("*").eq("user_id",this.userId).order("created_at",{ascending:!1}).limit(50),c={1:"bfem",2:"bac"}[null==s?void 0:s.level]||"bfem",{data:u}=await e.from("matieres").select("id, name").eq("level",c);return this.userData={profile:s,points:n,progress:a,examResults:i||[],badges:r||[],challenges:o||[],pointsHistory:l||[],matieres:u||[]},this.userData}catch(t){return null}}async analyzePerformance(){this.userData||await this.aggregateUserData();const e={overall:this.analyzeOverallPerformance(),bySubject:this.analyzeBySubject(),exams:this.analyzeExamPerformance(),studyHabits:this.analyzeStudyHabits(),strengths:[],weaknesses:[],predictions:{}};return e.strengths=this.identifyStrengths(e),e.weaknesses=this.identifyWeaknesses(e),e.predictions=this.generatePredictions(e),e}analyzeOverallPerformance(){const{points:e,progress:t,examResults:s,quizResults:n}=this.userData,a=(null==t?void 0:t.length)||0,i=(null==t?void 0:t.filter(e=>e.completed).length)||0,r=a>0?i/a*100:0,o=(null==s?void 0:s.length)||0,l=o>0?s.reduce((e,t)=>e+t.score,0)/o:0;let c=0;if(this.userData.quizResults&&this.userData.quizResults.length>0){const e=this.userData.quizResults.filter(e=>e.total_questions>0);e.length>0&&(c=Math.round(e.reduce((e,t)=>e+t.score/t.total_questions*100,0)/e.length))}const u=(null==e?void 0:e.level)||1,d=(null==e?void 0:e.total_points)||0,m=(null==e?void 0:e.current_streak)||0;return{level:u,totalPoints:d,currentStreak:m,completionRate:Math.round(r),totalChapters:a,completedChapters:i,totalExams:o,avgExamScore:Math.round(l),averageScore:c,grade:this.calculateGrade(l,r,m)}}analyzeBySubject(){const{progress:e,matieres:t}=this.userData;return t.map(t=>{const s=(null==e?void 0:e.filter(e=>{var s,n;return(null==(n=null==(s=e.chapitres)?void 0:s.matieres)?void 0:n.id)===t.id}))||[],n=s.filter(e=>e.completed).length,a=s.length,i=a>0?n/a*100:0,r=s.reduce((e,t)=>e+(t.time_spent||0),0);return{name:t.name,id:t.id,completed:n,total:a,completionRate:Math.round(i),timeSpent:Math.round(r/60),status:this.getSubjectStatus(i,r)}})}analyzeExamPerformance(){const{examResults:e}=this.userData;if(!e||0===e.length)return{totalExams:0,avgScore:0,bestScore:0,recentTrend:"none",readiness:0};const t=e.length,s=e.reduce((e,t)=>e+t.score,0)/t,n=Math.max(...e.map(e=>e.score)),a=e.slice(0,5),i=a.reduce((e,t)=>e+t.score,0)/a.length,r=i>s?"improving":i<s?"declining":"stable",o=this.calculateExamReadiness(s,t,r);return{totalExams:t,avgScore:Math.round(s),bestScore:n,recentTrend:r,readiness:o,byDifficulty:this.groupExamsByDifficulty(e)}}analyzeStudyHabits(){const{pointsHistory:e,points:t}=this.userData,s=(null==t?void 0:t.current_streak)||0,n=this.calculateConsistency(s),a=this.analyzeActivityByDay(e);return{currentStreak:s,consistency:n,activityByDay:a,avgStudyTime:this.calculateAvgStudyTime(),mostProductiveDay:this.getMostProductiveDay(a)}}identifyStrengths(e){const t=[];e.studyHabits.currentStreak>=7&&t.push({type:"consistency",icon:"ğŸ”¥",title:"RÃ©gularitÃ© exceptionnelle",description:`Vous avez ${e.studyHabits.currentStreak} jours consÃ©cutifs ! Continuez ainsi !`}),e.exams.avgScore>=75&&t.push({type:"exams",icon:"ğŸ¯",title:"Excellentes performances aux examens",description:`Score moyen de ${e.exams.avgScore}% - Vous maÃ®trisez bien !`}),e.overall.completionRate>=70&&t.push({type:"completion",icon:"ğŸ“š",title:"Progression solide",description:`${e.overall.completionRate}% des chapitres complÃ©tÃ©s`});const s=e.bySubject.sort((e,t)=>t.completionRate-e.completionRate)[0];return s&&s.completionRate>=60&&t.push({type:"subject",icon:"â­",title:`Excellent en ${s.name}`,description:`${s.completionRate}% complÃ©tÃ©`}),t}identifyWeaknesses(e){const t=[];e.studyHabits.currentStreak<3&&t.push({type:"consistency",icon:"âš ï¸",title:"Manque de rÃ©gularitÃ©",description:"Essayez d'Ã©tudier un peu chaque jour",priority:"high",recommendations:["Fixez-vous un horaire d'Ã©tude quotidien","Commencez par 20 minutes par jour","Activez les notifications de rappel"]}),e.exams.avgScore<60&&e.exams.totalExams>0&&t.push({type:"exams",icon:"ğŸ“‰",title:"Scores aux examens Ã  amÃ©liorer",description:`Score moyen: ${e.exams.avgScore}%`,priority:"high",recommendations:["Refaites les examens Ã©chouÃ©s","RÃ©visez les chapitres liÃ©s","Pratiquez plus de questions"]});const s=e.bySubject.sort((e,t)=>e.completionRate-t.completionRate)[0];return s&&s.completionRate<30&&t.push({type:"subject",icon:"ğŸ”",title:`${s.name} nÃ©cessite plus d'attention`,description:`Seulement ${s.completionRate}% complÃ©tÃ©`,priority:"medium",recommendations:[`Consacrez 30 minutes par jour Ã  ${s.name}`,"Commencez par les chapitres les plus faciles","Demandez de l'aide sur les points difficiles"]}),"declining"===e.exams.recentTrend&&t.push({type:"trend",icon:"ğŸ“Š",title:"Baisse rÃ©cente de performance",description:"Vos derniers scores sont en dessous de votre moyenne",priority:"high",recommendations:["Prenez une pause pour Ã©viter la fatigue","Revisitez les bases","Variez vos mÃ©thodes d'apprentissage"]}),t}generatePredictions(e){return{examSuccess:this.predictExamSuccess(e),nextLevel:this.predictNextLevel(e),timeToMastery:this.predictTimeToMastery(e),riskAreas:this.identifyRiskAreas(e)}}predictExamSuccess(e){const{avgScore:t,totalExams:s,recentTrend:n,readiness:a}=e.exams,{completionRate:i}=e.overall,r=(.4*(t/100)+.2*Math.min(s/10,1)+.3*(i/100)+a/100*.1)*("improving"===n?1.2:"declining"===n?.8:1),o=Math.min(Math.round(100*r),100);return{percentage:o,level:o>=80?"high":o>=60?"medium":"low",confidence:s>=5?"high":s>=2?"medium":"low",message:this.getSuccessMessage(o)}}predictNextLevel(e){const{totalPoints:t,level:s}=e.overall,n=100*s-t%100,{pointsHistory:a}=this.userData,i=a.slice(0,7),r=i.length>0?i.reduce((e,t)=>e+t.points_earned,0)/7:10,o=r>0?Math.ceil(n/r):30;return{currentLevel:s,nextLevel:s+1,pointsNeeded:n,daysEstimated:o,message:`Encore ${n} points pour le niveau ${s+1} (environ ${o} jours)`}}predictTimeToMastery(e){e.overall;const t=e.overall.totalChapters-e.overall.completedChapters,s=30*t,n=Math.ceil(s/60);return{hoursNeeded:n,daysNeeded:Math.ceil(n),remainingChapters:t,message:`Environ ${n}h de rÃ©vision pour maÃ®triser toutes les matiÃ¨res`}}identifyRiskAreas(e){const t=[];0===e.exams.totalExams&&t.push({type:"no_practice",severity:"high",title:"Aucun examen de pratique",message:"Passez des examens blancs pour Ã©valuer votre niveau",action:"Commencer un examen"});const s=e.bySubject.filter(e=>0===e.completionRate);return s.length>0&&t.push({type:"unstarted_subjects",severity:"medium",title:`${s.length} matiÃ¨re(s) non commencÃ©e(s)`,message:`${s.map(e=>e.name).join(", ")}`,action:"Commencer ces matiÃ¨res"}),0===e.studyHabits.currentStreak&&t.push({type:"inactivity",severity:"high",title:"InactivitÃ© dÃ©tectÃ©e",message:"Vous n'avez pas Ã©tudiÃ© rÃ©cemment",action:"Reprendre maintenant"}),t}async generateStudyPlan(e=null,t=2){const s=await this.analyzePerformance(),n={title:"Plan d'Ã©tude personnalisÃ©",generatedAt:(new Date).toISOString(),targetDate:e,hoursPerDay:t,schedule:[],priorities:[],tips:[]};return n.priorities=s.weaknesses.map(e=>({area:e.title,priority:e.priority,recommendations:e.recommendations})),n.schedule=this.generateWeeklySchedule(s,t),n.tips=this.generatePersonalizedTips(s),n}generateWeeklySchedule(e,t){const s=[],n=e.bySubject.sort((e,t)=>e.completionRate-t.completionRate);return["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"].forEach((e,a)=>{const i=n[a%n.length],r=60*t/2;s.push({day:e,sessions:[{time:"09:00-10:00",subject:i.name,activity:"RÃ©vision cours",duration:r},{time:"16:00-17:00",subject:n[(a+1)%n.length].name,activity:"Exercices pratiques",duration:r}]})}),s}generatePersonalizedTips(e){const t=[];return e.overall.level<3?t.push("ğŸŒ± Commencez par les bases - la maÃ®trise vient avec la pratique rÃ©guliÃ¨re"):t.push("ğŸš€ Vous progressez bien ! Concentrez-vous maintenant sur la vitesse et la prÃ©cision"),e.studyHabits.currentStreak<7&&t.push("â° La rÃ©gularitÃ© est la clÃ© : 30 minutes par jour valent mieux que 3h une fois par semaine"),e.exams.totalExams<5&&t.push("ğŸ“ Passez plus d'examens blancs pour vous habituer au format et gÃ©rer votre stress"),t.push("ğŸ’¡ RÃ©visez le soir ce que vous avez appris le matin - la rÃ©pÃ©tition espacÃ©e amÃ©liore la rÃ©tention"),t}calculateGrade(e,t,s){const n=.5*e+.3*t+.2*Math.min(2*s,20);return n>=85?"A+":n>=75?"A":n>=65?"B":n>=55?"C":"D"}getSubjectStatus(e,t){return e>=80?"mastered":e>=50?"good":e>=20?"learning":t>0?"started":"not_started"}calculateExamReadiness(e,t,s){let n=e;return t<3&&(n*=.7),"improving"===s&&(n*=1.1),"declining"===s&&(n*=.9),Math.min(Math.round(n),100)}calculateConsistency(e){return e>=30?95:e>=14?80:e>=7?60:e>=3?40:20}analyzeActivityByDay(e){const t=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"].map(e=>({day:e,points:0,count:0}));return null==e||e.forEach(e=>{const s=new Date(e.created_at).getDay();t[s].points+=e.points_earned,t[s].count+=1}),t}calculateAvgStudyTime(){const{progress:e}=this.userData,t=(null==e?void 0:e.reduce((e,t)=>e+(t.time_spent||0),0))||0,s=(null==e?void 0:e.length)||1;return Math.round(t/s/60)}getMostProductiveDay(e){var t;return(null==(t=[...e].sort((e,t)=>t.points-e.points)[0])?void 0:t.day)||"Lundi"}groupExamsByDifficulty(e){const t={facile:[],moyen:[],difficile:[]};return e.forEach(e=>{var s;const n=(null==(s=e.examens)?void 0:s.difficulty)||"moyen";t[n]&&t[n].push(e.score)}),{facile:t.facile.length>0?Math.round(t.facile.reduce((e,t)=>e+t,0)/t.facile.length):0,moyen:t.moyen.length>0?Math.round(t.moyen.reduce((e,t)=>e+t,0)/t.moyen.length):0,difficile:t.difficile.length>0?Math.round(t.difficile.reduce((e,t)=>e+t,0)/t.difficile.length):0}}getSuccessMessage(e){return e>=85?"ğŸŒŸ Excellentes chances de rÃ©ussite ! Continuez comme Ã§a !":e>=70?"âœ… Bonnes chances de rÃ©ussite ! Encore un petit effort !":e>=50?"âš ï¸ Chances moyennes - Intensifiez vos rÃ©visions":"ğŸš¨ Risque Ã©levÃ© - Il faut vraiment rÃ©viser davantage"}generateMotivationalMessage(e){var t,s;const n={morning:[`ğŸŒ… Bonjour ! Aujourd'hui est une nouvelle opportunitÃ© d'apprendre. CommenÃ§ons par ${null==(t=e.bySubject[0])?void 0:t.name} !`,`â˜€ï¸ Nouvelle journÃ©e, nouvelles connaissances ! Vous Ãªtes au niveau ${e.overall.level} - impressionnant !`,"ğŸ¯ Objectif du jour : ComplÃ©ter 1 chapitre. Vous en Ãªtes capable !"],afternoon:[`â˜€ï¸ Belle progression ce matin ! Prenez une pause puis continuez avec ${null==(s=e.bySubject[1])?void 0:s.name}`,`ğŸ’ª Vous avez ${e.overall.totalPoints} points ! Encore ${e.predictions.nextLevel.pointsNeeded} pour le prochain niveau !`,"ğŸ“š Temps de rÃ©viser ! Vos efforts d'aujourd'hui sont vos succÃ¨s de demain"],evening:[`ğŸŒ™ Excellente journÃ©e de travail ! Votre streak est maintenant Ã  ${e.studyHabits.currentStreak} jours !`,"â­ Bravo pour votre assiduitÃ© ! Reposez-vous bien, vous l'avez mÃ©ritÃ©",`ğŸ‰ ${e.overall.completedChapters} chapitres complÃ©tÃ©s ! Vous progressez incroyablement bien`]},a=(new Date).getHours(),i=n[a<12?"morning":a<18?"afternoon":"evening"];return i[Math.floor(Math.random()*i.length)]}}export{t as A};
