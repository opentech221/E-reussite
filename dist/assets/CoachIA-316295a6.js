import{r as e,j as s}from"./vendor-react-470eca1f.js";import{H as t}from"./Helmet-2c7e73f6.js";import{s as a,C as r,a as l,b as n,c as i,h as o,B as d,e as c,A as x,m,n as u,u as p,G as h,H as g,I as b,f as j,J as f,K as v,M as N,P as y}from"./index-80385b81.js";import{T as k,a as w,b as _,c as q}from"./tabs-04421a9d.js";import{P as C}from"./progress-d9418a6f.js";import{A as z}from"./aiCoachService-d7596553.js";import{g as S}from"./profileOrientationService-536adee1.js";import{m as $,A,R as Q,L as I,C as M,X as P,Y as E,T,d as L,a as R,b as B}from"./vendor-charts-0ffd78b1.js";import{bA as D,x as U,J as F,ao as O,aI as H,b3 as G,C as K,g as V,f as W,d as J,m as Z,A as X,bB as Y,aH as ee,q as se,bC as te,ap as ae,ax as re,a0 as le,p as ne,c as ie,aa as oe,bD as de,U as ce,bj as xe,l as me,a as ue,K as pe,b as he,bE as ge,a3 as be}from"./vendor-ui-297a683c.js";import{f as je}from"./format-89148104.js";import{u as fe,c as ve}from"./vendor-router-da2b77bd.js";import"./vendor-supabase-1d8f37f5.js";const Ne=({userId:t,config:r,onComplete:l,onCancel:n})=>{var i;const{subject:o,chapter:d,difficulty:c="medium"}=r||{},{isActive:x,isLoading:m,error:u,quizCompleted:p,currentQuestion:h,currentQuestionIndex:g,totalQuestions:b,userAnswers:j,currentAnswer:f,showCorrection:v,score:N,progress:y,timeElapsed:k,finalStats:w,startQuiz:_,submitAnswer:q,nextQuestion:C,abandonQuiz:z}=(({userId:s,subject:t,chapter:r,difficulty:l="medium"})=>{const[n,i]=e.useState(!1),[o,d]=e.useState(null),[c,x]=e.useState([]),[m,u]=e.useState(0),[p,h]=e.useState([]),[g,b]=e.useState(0),[j,f]=e.useState(!1),[v,N]=e.useState(null),[y,k]=e.useState(0),[w,_]=e.useState(null),q=e.useRef(null),[C,z]=e.useState(!1),[S,$]=e.useState(null),[A,Q]=e.useState(!1),[I,M]=e.useState(null),P=e.useCallback(()=>{q.current&&clearInterval(q.current),_(Date.now()),q.current=setInterval(()=>{k(e=>e+1)},1e3)},[]),E=e.useCallback(()=>{q.current&&(clearInterval(q.current),q.current=null)},[]),T=e.useCallback(async()=>{if(!t)return N("Mati√®re non d√©finie"),null;f(!0),N(null);try{const e=[{id:1,question:"Quelle est la capitale du S√©n√©gal ?",options:["Dakar","Thi√®s","Saint-Louis","Kaolack"],correct_answer:0,explanation:"Dakar est la capitale √©conomique et politique du S√©n√©gal depuis 1960.",subject:t,difficulty:l},{id:2,question:"Combien font 5 √ó 8 ?",options:["35","40","45","50"],correct_answer:1,explanation:"5 √ó 8 = 40. C'est une multiplication de base √† conna√Ætre par c≈ìur.",subject:t,difficulty:l},{id:3,question:"Quelle est la formule de l'aire d'un rectangle ?",options:["Longueur + Largeur","Longueur √ó Largeur","2 √ó (Longueur + Largeur)","Longueur¬≤"],correct_answer:1,explanation:"L'aire d'un rectangle = Longueur √ó Largeur. C'est une formule fondamentale en g√©om√©trie.",subject:t,difficulty:l},{id:4,question:"Comment dit-on 'Bonjour' en anglais ?",options:["Goodbye","Hello","Thanks","Sorry"],correct_answer:1,explanation:"'Hello' signifie 'Bonjour' en anglais. C'est la salutation la plus courante.",subject:t,difficulty:l},{id:5,question:"Quel est le r√©sultat de 15 - 7 ?",options:["6","7","8","9"],correct_answer:2,explanation:"15 - 7 = 8. Pour v√©rifier : 8 + 7 = 15.",subject:t,difficulty:l}];return x(e),e}catch(e){return N(e.message),null}finally{f(!1)}},[t,l]),L=e.useCallback(async e=>{try{const{data:t,error:r}=await a.rpc("start_interactive_quiz",{p_user_id:s,p_subject_id:null,p_chapter_id:null,p_conversation_id:null,p_total_questions:e.length,p_difficulty_level:l});if(r)throw r;const n=t.session_id;return d(n),n}catch(t){N(t.message);const e=`temp_${Date.now()}`;return d(e),e}},[s,t,r,l]),R=e.useCallback(async()=>{f(!0),N(null),i(!1);try{const e=await T();return!!e&&(!!(await L(e))&&(u(0),h([]),b(0),k(0),Q(!1),M(null),i(!0),P(),!0))}catch(e){return N(e.message),!1}finally{f(!1)}},[T,L,P]),B=e.useCallback(async e=>{if(!n||m>=c.length)return;const s=c[m],t=s.options.indexOf(e),r=t===s.correct_answer,l=w?Math.floor((Date.now()-w)/1e3):0;try{const t=["A","B","C","D"][s.correct_answer],{error:n}=await a.from("interactive_quiz_questions").insert({session_id:o,question_number:m+1,question_text:s.question,question_type:"qcm",option_a:s.options[0]||null,option_b:s.options[1]||null,option_c:s.options[2]||null,option_d:s.options[3]||null,correct_option:t,user_answer:e,is_correct:r,answered_at:(new Date).toISOString(),time_to_answer_seconds:l,explanation:s.explanation||null})}catch(d){}const i={question_id:s.id,user_answer:e,user_answer_index:t,correct_answer:s.correct_answer,is_correct:r,time_spent:l,explanation:s.explanation};return h(e=>[...e,i]),$(i),z(!0),r&&b(e=>e+1),i},[n,m,c,w,o]),D=e.useCallback(()=>{z(!1),$(null),m<c.length-1?(u(e=>e+1),_(Date.now())):F()},[m,c.length]),U=e.useCallback(()=>{const e=c.length,s=p.filter(e=>e.is_correct).length,a=Math.round(s/e*100),n=Math.round(y/e);return{totalQuestions:e,correctAnswers:s,wrongAnswers:e-s,percentage:a,totalPoints:10*s+(a>=80?50:a>=60?20:0),badgeUnlocked:a>=80?{name:`Expert ${t}`,icon:"üèÜ",description:`Quiz ${t} r√©ussi avec ${a}% !`}:null,timeElapsed:y,averageTimePerQuestion:n,difficulty:l,subject:t,chapter:r}},[c.length,p,y,l,t,r]),F=e.useCallback(async()=>{E(),i(!1),Q(!0);try{await new Promise(e=>setTimeout(e,300));const{data:e,error:s}=await a.rpc("complete_interactive_quiz",{p_session_id:o});if(s){const e=U();return M(e),e}const n={totalQuestions:e.total_questions,correctAnswers:e.correct_answers,wrongAnswers:e.total_questions-e.correct_answers,percentage:Math.round(e.score_percentage),totalPoints:e.points_earned,badgeUnlocked:e.badge_unlocked?{name:e.badge_unlocked,icon:e.badge_unlocked.includes("üèÜ")?"üèÜ":e.badge_unlocked.includes("ü•á")?"ü•á":e.badge_unlocked.includes("ü•à")?"ü•à":e.badge_unlocked.includes("ü•â")?"ü•â":"‚úÖ",description:`Quiz ${t} r√©ussi avec ${Math.round(e.score_percentage)}% !`}:null,timeElapsed:y,averageTimePerQuestion:Math.round(y/e.total_questions),difficulty:l,subject:t,chapter:r};return M(n),n}catch(e){N(e.message);const s=U();return M(s),s}},[E,U,o,y,l,t,p]),O=e.useCallback(async()=>{if(E(),i(!1),o)try{await a.from("interactive_quiz_sessions").update({status:"abandoned",completed_at:(new Date).toISOString()}).eq("id",o)}catch(e){}x([]),u(0),h([]),b(0),k(0),d(null),Q(!1),M(null)},[o,E]);e.useEffect(()=>()=>{q.current&&clearInterval(q.current)},[]);const H=c[m]||null,G=c.length>0?Math.round((m+1)/c.length*100):0;return{isActive:n,isLoading:j,error:v,quizCompleted:A,questions:c,currentQuestion:H,currentQuestionIndex:m,totalQuestions:c.length,userAnswers:p,currentAnswer:S,showCorrection:C,score:g,progress:G,timeElapsed:y,finalStats:I,startQuiz:R,submitAnswer:B,nextQuestion:D,abandonQuiz:O}})({userId:t,subject:o,chapter:d,difficulty:c});e.useEffect(()=>{p&&w&&l&&l({correctAnswers:w.correctAnswers,totalQuestions:w.totalQuestions,scorePercent:w.percentage,badgeEarned:w.badgeUnlocked,timeElapsed:w.timeElapsed})},[p,w,l]);const S=e=>{const s=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},Q={easy:"bg-green-100 text-green-700 border-green-300",medium:"bg-yellow-100 text-yellow-700 border-yellow-300",hard:"bg-red-100 text-red-700 border-red-300"},I={easy:"Facile",medium:"Moyen",hard:"Difficile"};if(!x&&!p)return s.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-900 rounded-xl p-6 shadow-lg border border-blue-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"bg-blue-600 p-3 rounded-lg",children:s.jsx(D,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Quiz Interactif"}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[o," ",d?`‚Ä¢ ${d}`:""]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Questions"}),s.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"10"})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Difficult√©"}),s.jsx("p",{className:`text-sm font-semibold px-2 py-1 rounded inline-block ${Q[c]}`,children:I[c]})]})]}),s.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-4",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(U,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Comment √ßa marche ?"}),s.jsxs("ul",{className:"text-xs text-yellow-700 dark:text-yellow-300 mt-1 space-y-1",children:[s.jsx("li",{children:"‚úì Je te pose 10 questions une par une"}),s.jsx("li",{children:"‚úì Tu choisis une r√©ponse"}),s.jsx("li",{children:"‚úì Correction instantan√©e avec explications"}),s.jsx("li",{children:"‚úì Badge d√©bloqu√© si score ‚â• 80% üèÜ"})]})]})]})}),u&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3 mb-4",children:s.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:u})}),s.jsx("button",{onClick:_,disabled:m,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-lg flex items-center justify-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:m?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),s.jsx("span",{children:"Chargement..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(D,{className:"w-5 h-5"}),s.jsx("span",{children:"D√©marrer le Quiz"})]})})]});if(x&&h&&!p)return s.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:["Question ",g+1," / ",b]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600 dark:text-gray-400",children:[s.jsx(F,{className:"w-4 h-4"}),s.jsx("span",{children:S(k)})]}),s.jsxs("div",{className:"flex items-center gap-1 text-sm font-semibold text-blue-600 dark:text-blue-400",children:[s.jsx(O,{className:"w-4 h-4"}),s.jsxs("span",{children:[N," / ",b]})]})]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx($.div,{initial:{width:0},animate:{width:`${y}%`},transition:{duration:.5},className:"bg-gradient-to-r from-blue-600 to-indigo-600 h-2 rounded-full"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:h.question}),s.jsx("div",{className:"space-y-3",children:null==(i=h.options)?void 0:i.map((e,t)=>{const a=String.fromCharCode(65+t),r=(null==f?void 0:f.user_answer)===e,l=t===h.correct_answer,n=v;let i="bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 border-gray-300 dark:border-gray-600";return n&&(l?i="bg-green-100 dark:bg-green-900/30 border-green-500 dark:border-green-500":r&&!l&&(i="bg-red-100 dark:bg-red-900/30 border-red-500 dark:border-red-500")),s.jsxs($.button,{onClick:()=>!v&&q(e),disabled:v,whileHover:v?{}:{scale:1.02},whileTap:v?{}:{scale:.98},className:`w-full text-left p-4 rounded-lg border-2 transition-all flex items-center gap-3 ${i} disabled:cursor-not-allowed`,children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-semibold "+(n&&l?"bg-green-500 text-white":n&&r&&!l?"bg-red-500 text-white":"bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300"),children:a}),s.jsx("span",{className:"flex-1 text-gray-900 dark:text-white",children:e}),n&&l&&s.jsx(H,{className:"w-5 h-5 text-green-600"}),n&&r&&!l&&s.jsx(G,{className:"w-5 h-5 text-red-600"})]},t)})})]}),s.jsx(A,{children:v&&f&&s.jsx($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 p-4 rounded-lg border-2 "+(f.is_correct?"bg-green-50 dark:bg-green-900/20 border-green-500":"bg-red-50 dark:bg-red-900/20 border-red-500"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[f.is_correct?s.jsx(H,{className:"w-6 h-6 text-green-600 flex-shrink-0"}):s.jsx(G,{className:"w-6 h-6 text-red-600 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold mb-2 "+(f.is_correct?"text-green-800 dark:text-green-200":"text-red-800 dark:text-red-200"),children:f.is_correct?"‚úì Bravo ! Bonne r√©ponse":"‚úó Incorrect"}),h.explanation&&s.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[s.jsx("strong",{children:"Explication :"})," ",h.explanation]})]})]})})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>{z(),n&&n()},className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all",children:"Abandonner"}),v&&s.jsxs($.button,{initial:{opacity:0},animate:{opacity:1},onClick:C,className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-lg flex items-center justify-center gap-2 transition-all",children:[s.jsx("span",{children:g<b-1?"Question suivante":"Voir les r√©sultats"}),s.jsx(K,{className:"w-5 h-5"})]})]})]});if(p&&w){const e=100===w.percentage,t=w.percentage>=80,a=w.percentage>=60;return s.jsxs($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-900 rounded-xl p-6 shadow-lg border border-blue-200 dark:border-gray-700",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx($.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},className:"inline-block text-6xl mb-3",children:e?"üéâ":t?"üèÜ":a?"üëç":"üí™"}),s.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:e?"Parfait !":t?"Excellent !":a?"Bien jou√© !":"Continue !"}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Quiz termin√© en ",S(w.timeElapsed)]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 mb-6 text-center border border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 mb-2",children:[w.percentage,"%"]}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[w.correctAnswers," / ",w.totalQuestions," bonnes r√©ponses"]}),w.badgeUnlocked&&s.jsxs($.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3,type:"spring",stiffness:200},className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-yellow-100 to-orange-100 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-full border-2 border-yellow-400 dark:border-yellow-600",children:[s.jsx("span",{className:"text-2xl",children:w.badgeUnlocked.icon}),s.jsx("span",{className:"font-bold text-yellow-800 dark:text-yellow-200",children:w.badgeUnlocked.name})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(V,{className:"w-5 h-5 text-blue-600"}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Points gagn√©s"})]}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["+",w.totalPoints]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(F,{className:"w-5 h-5 text-blue-600"}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Temps moyen"})]}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[w.averageTimePerQuestion,"s"]})]})]}),w.badgeUnlocked&&s.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl p-4 mb-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"bg-white rounded-full p-3",children:s.jsx(W,{className:"w-8 h-8 text-yellow-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold text-white opacity-90",children:"Badge d√©bloqu√© !"}),s.jsxs("p",{className:"text-lg font-bold text-white",children:[w.badgeUnlocked.icon," ",w.badgeUnlocked.name]})]})]})}),s.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:s.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e&&"üåü Score parfait ! Tu ma√Ætrises ce sujet √† la perfection !",t&&!e&&"üèÜ Excellent travail ! Continue sur cette lanc√©e !",a&&!t&&"üëç Bon travail ! Quelques r√©visions et tu seras au top !",!a&&"üí™ Continue √† t'entra√Æner ! R√©vise les concepts cl√©s et recommence !"]})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:n,className:"flex-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-3 px-6 rounded-lg transition-all",children:"Fermer"}),s.jsxs("button",{onClick:()=>{z(),setTimeout(_,500)},className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-all flex items-center justify-center gap-2",children:[s.jsx(J,{className:"w-5 h-5"}),s.jsx("span",{children:"Recommencer"})]})]})]})}return null},ye=({active:e,payload:t})=>{if(e&&t&&t.length){const e=t[0].payload;return s.jsxs("div",{className:"bg-white dark:bg-slate-800 border-2 border-blue-500 rounded-lg shadow-lg p-3",children:[s.jsx("p",{className:"font-semibold text-slate-900 dark:text-white mb-2",children:e.dateFormatted}),s.jsxs("p",{className:"text-blue-600 dark:text-blue-400 font-bold text-lg mb-1",children:["Score: ",e.score,"%"]}),s.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-300 space-y-1",children:[s.jsxs("p",{children:["‚úÖ ",e.correctAnswers,"/",e.totalQuestions," bonnes r√©ponses"]}),s.jsxs("p",{children:["‚è±Ô∏è ",e.timeFormatted]}),e.badge&&s.jsxs("p",{className:"flex items-center gap-1 text-yellow-600 dark:text-yellow-400 font-semibold",children:[s.jsx(W,{className:"w-3 h-3"}),e.badge]})]})]})}return null},ke=({sessions:t=[],loading:a=!1})=>{const[c,x]=e.useState("area");if(a)return s.jsxs(r,{className:"border-blue-200 dark:border-blue-700",children:[s.jsx(l,{children:s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(O,{className:"w-5 h-5 text-blue-500"}),"√âvolution de tes Scores"]})}),s.jsx(i,{children:s.jsx("div",{className:"h-64 flex items-center justify-center",children:s.jsx("div",{className:"animate-pulse text-slate-400",children:"Chargement des donn√©es..."})})})]});if(!t||0===t.length)return s.jsxs(r,{className:"border-blue-200 dark:border-blue-700",children:[s.jsx(l,{children:s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(O,{className:"w-5 h-5 text-blue-500"}),"√âvolution de tes Scores"]})}),s.jsx(i,{children:s.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-slate-400",children:[s.jsx(Z,{className:"w-12 h-12 mb-2 opacity-50"}),s.jsx("p",{className:"font-medium",children:"Pas encore de donn√©es"}),s.jsx("p",{className:"text-sm",children:"Compl√®te des quiz pour voir ta progression"})]})})]});const m=t.filter(e=>"completed"===e.status&&null!=e.score_percentage).slice(0,10).reverse().map((e,s)=>{const t=new Date(e.completed_at||e.created_at),a=e.time_elapsed||0,r=Math.floor(a/60),l=a%60;return{index:s+1,score:Math.round(e.score_percentage),correctAnswers:e.correct_answers||0,totalQuestions:e.total_questions||5,badge:e.badge_unlocked||null,dateFormatted:je(t,"dd MMM yyyy",{locale:o}),timeFormatted:`${r}min ${l}s`,sessionId:e.id}}),u=m.map(e=>e.score),p=Math.round(u.reduce((e,s)=>e+s,0)/u.length),h=Math.max(...u),g=Math.min(...u),b=u.length>1?u[u.length-1]-u[0]:0;return s.jsxs(r,{className:"border-blue-200 dark:border-blue-700",children:[s.jsx(l,{children:s.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(O,{className:"w-5 h-5 text-blue-500"}),"√âvolution de tes Scores"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(d,{variant:"line"===c?"default":"outline",size:"sm",onClick:()=>x("line"),children:"Ligne"}),s.jsx(d,{variant:"area"===c?"default":"outline",size:"sm",onClick:()=>x("area"),children:"Zone"})]})]})}),s.jsxs(i,{children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:"text-center p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[s.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mb-1",children:"Moyenne"}),s.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[p,"%"]})]}),s.jsxs("div",{className:"text-center p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[s.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mb-1",children:"Meilleur"}),s.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[h,"%"]})]}),s.jsxs("div",{className:"text-center p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[s.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mb-1",children:"Plus faible"}),s.jsxs("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:[g,"%"]})]}),s.jsxs("div",{className:"text-center p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[s.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mb-1",children:"Tendance"}),s.jsxs("p",{className:"text-2xl font-bold "+(b>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[b>=0?"+":"",b,"%"]})]})]}),s.jsx("div",{className:"h-64",children:s.jsx(Q,{width:"100%",height:"100%",children:"line"===c?s.jsxs(I,{data:m,children:[s.jsx(M,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(P,{dataKey:"index",stroke:"#64748b",label:{value:"Quiz #",position:"insideBottom",offset:-5}}),s.jsx(E,{stroke:"#64748b",domain:[0,100],label:{value:"Score (%)",angle:-90,position:"insideLeft"}}),s.jsx(T,{content:s.jsx(ye,{})}),s.jsx(L,{type:"monotone",dataKey:"score",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",strokeWidth:2,r:5},activeDot:{r:7}}),s.jsx(L,{type:"monotone",dataKey:()=>p,stroke:"#94a3b8",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]}):s.jsxs(R,{data:m,children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"scoreGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),s.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})}),s.jsx(M,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(P,{dataKey:"index",stroke:"#64748b",label:{value:"Quiz #",position:"insideBottom",offset:-5}}),s.jsx(E,{stroke:"#64748b",domain:[0,100],label:{value:"Score (%)",angle:-90,position:"insideLeft"}}),s.jsx(T,{content:s.jsx(ye,{})}),s.jsx(B,{type:"monotone",dataKey:"score",stroke:"#3b82f6",strokeWidth:3,fill:"url(#scoreGradient)"})]})})}),s.jsxs("div",{className:"mt-4 flex items-center justify-center gap-6 text-sm text-slate-600 dark:text-slate-400",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),s.jsx("span",{children:"Ton score"})]}),"line"===c&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-6 h-0.5 bg-slate-400 border-dashed"}),s.jsxs("span",{children:["Moyenne (",p,"%)"]})]})]})]})]})},we=({tier:e="bronze",percentile:t=0,size:a="md",showPercentile:r=!0,showLabel:l=!0,animated:n=!0})=>{const i={bronze:{name:"Bronze",icon:X,color:"text-amber-600",bgColor:"bg-amber-50 dark:bg-amber-900/20",borderColor:"border-amber-300 dark:border-amber-700",gradient:"from-amber-400 to-amber-600",glow:"shadow-[0_0_20px_rgba(217,119,6,0.3)]",description:"En progression"},argent:{name:"Argent",icon:W,color:"text-slate-500",bgColor:"bg-slate-50 dark:bg-slate-800/50",borderColor:"border-slate-400 dark:border-slate-600",gradient:"from-slate-300 to-slate-500",glow:"shadow-[0_0_20px_rgba(148,163,184,0.4)]",description:"Bon niveau"},or:{name:"Or",icon:J,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-400 dark:border-yellow-600",gradient:"from-yellow-400 to-yellow-600",glow:"shadow-[0_0_25px_rgba(234,179,8,0.5)]",description:"Excellent"},platine:{name:"Platine",icon:Y,color:"text-cyan-400",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",borderColor:"border-cyan-400 dark:border-cyan-600",gradient:"from-cyan-300 to-cyan-500",glow:"shadow-[0_0_30px_rgba(34,211,238,0.6)]",description:"√âlite"},diamant:{name:"Diamant",icon:ee,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-400 dark:border-purple-600",gradient:"from-purple-400 to-pink-500",glow:"shadow-[0_0_35px_rgba(168,85,247,0.7)]",description:"L√©gendaire"}},o={sm:{icon:"w-4 h-4",badge:"px-2 py-1 text-xs",percentile:"text-xs",label:"text-xs"},md:{icon:"w-5 h-5",badge:"px-3 py-1.5 text-sm",percentile:"text-sm",label:"text-sm"},lg:{icon:"w-6 h-6",badge:"px-4 py-2 text-base",percentile:"text-base",label:"text-base"}},d=i[e]||i.bronze,c=o[a]||o.md,x=d.icon,m=Math.max(0,100-t).toFixed(0),u={initial:{opacity:.5},animate:{opacity:[.5,1,.5],transition:{duration:2,repeat:1/0,ease:"easeInOut"}}};return s.jsx($.div,{variants:n?{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1,transition:{type:"spring",stiffness:200,damping:15}},hover:{scale:1.05,transition:{type:"spring",stiffness:400,damping:10}}}:{},initial:n?"initial":void 0,animate:n?"animate":void 0,whileHover:n?"hover":void 0,className:"inline-flex items-center gap-2",children:s.jsxs("div",{className:`\n        relative inline-flex items-center gap-2 rounded-full border-2\n        ${d.bgColor} ${d.borderColor} ${c.badge}\n        ${n?d.glow:""}\n        transition-all duration-300\n      `,children:[s.jsxs("div",{className:`\n          relative flex items-center justify-center\n          ${c.icon}\n        `,children:[n&&s.jsx($.div,{variants:u,initial:"initial",animate:"animate",className:`absolute inset-0 rounded-full bg-gradient-to-r ${d.gradient} blur-md opacity-50`}),s.jsx(x,{className:`${d.color} ${c.icon} relative z-10`})]}),l&&s.jsx("span",{className:`\n            font-semibold ${d.color} ${c.label}\n          `,children:d.name}),r&&t>0&&s.jsxs("span",{className:`\n            ml-1 px-2 py-0.5 rounded-full \n            bg-white/80 dark:bg-slate-800/80 \n            font-bold ${d.color} ${c.percentile}\n            backdrop-blur-sm border border-current/20\n          `,children:["Top ",m,"%"]})]})})},_e=({rank:e="bronze",percentile:t=0,averageScore:a=0,totalUsers:r=0,compact:l=!1})=>{const n={bronze:{gradient:"from-amber-400 to-amber-600",description:"En progression"},argent:{gradient:"from-slate-300 to-slate-500",description:"Bon niveau"},or:{gradient:"from-yellow-400 to-yellow-600",description:"Excellent"},platine:{gradient:"from-cyan-300 to-cyan-500",description:"√âlite"},diamant:{gradient:"from-purple-400 to-pink-500",description:"L√©gendaire"}},i=n[e]||n.bronze,o=Math.max(0,100-t).toFixed(0);return s.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`\n        relative overflow-hidden rounded-xl border-2 \n        bg-white dark:bg-slate-800 \n        border-slate-200 dark:border-slate-700\n        shadow-lg\n        ${l?"p-4":"p-6"}\n      `,children:[s.jsx("div",{className:`\n        absolute inset-0 bg-gradient-to-br ${i.gradient} \n        opacity-5 dark:opacity-10\n      `}),s.jsxs("div",{className:"relative z-10",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx(we,{tier:e,percentile:t,size:l?"sm":"md",showPercentile:!0,showLabel:!0,animated:!0}),!l&&r>0&&s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Participants actifs"}),s.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:r}),s.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-500",children:"utilisateurs"})]})]}),!l&&s.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:[i.description," ‚Ä¢ Vous surpassez ",s.jsxs("span",{className:"font-semibold text-slate-900 dark:text-white",children:[t.toFixed(0),"%"]})," des participants"]}),!l&&s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(O,{className:"w-4 h-4 text-green-500"}),s.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Score moyen"})]}),s.jsxs("div",{className:"text-xl font-bold text-slate-900 dark:text-white",children:[a.toFixed(1),"%"]})]}),s.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(W,{className:"w-4 h-4 text-blue-500"}),s.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Percentile"})]}),s.jsxs("div",{className:"text-xl font-bold text-slate-900 dark:text-white",children:["Top ",o,"%"]})]})]})]})]})},qe=95,Ce=85,ze=70,Se=50,$e={diamant:{rank:"diamant",name:"Diamant",color:"#a78bfa",icon:"Trophy",minPercentile:95,minScore:90},platine:{rank:"platine",name:"Platine",color:"#e5e7eb",icon:"Star",minPercentile:85,minScore:80},or:{rank:"or",name:"Or",color:"#fbbf24",icon:"Crown",minPercentile:70,minScore:70},argent:{rank:"argent",name:"Argent",color:"#c0c0c0",icon:"Award",minPercentile:50,minScore:60},bronze:{rank:"bronze",name:"Bronze",color:"#cd7f32",icon:"Medal",minPercentile:0,minScore:0}};async function Ae(e){try{const{data:s,error:t}=await a.from("interactive_quiz_sessions").select("user_id, score_percentage").eq("status","completed");if(t)throw t;if(!s||0===s.length)return{percentile:0,rank:"bronze",averageScore:0,totalUsers:0,quizCount:0,rankInfo:$e.bronze};const r={};s.forEach(e=>{r[e.user_id]||(r[e.user_id]=[]),r[e.user_id].push(e.score_percentage)});const l=Object.entries(r).map(([e,s])=>({userId:e,averageScore:s.reduce((e,s)=>e+s,0)/s.length,quizCount:s.length})),n=l.find(s=>s.userId===e);if(!n)return{percentile:0,rank:"bronze",averageScore:0,totalUsers:l.length,quizCount:0,rankInfo:$e.bronze};const i=l.filter(e=>e.averageScore<n.averageScore).length,o=l.length>1?i/(l.length-1)*100:100,d=function(e){if(e>=qe)return $e.diamant;if(e>=Ce)return $e.platine;if(e>=ze)return $e.or;if(e>=Se)return $e.argent;return $e.bronze}(o),c=function(e){const s=["bronze","argent","or","platine","diamant"],t=s.indexOf(e);if(-1===t||t===s.length-1)return null;return $e[s[t+1]]}(d.rank),x=c?c.minScore-n.averageScore:0;return{percentile:Math.round(10*o)/10,rank:d.rank,averageScore:Math.round(10*n.averageScore)/10,totalUsers:l.length,quizCount:n.quizCount,rankInfo:d,nextRank:c,pointsToNextRank:Math.max(0,x)}}catch(s){return{percentile:0,rank:"bronze",averageScore:0,totalUsers:0,quizCount:0,rankInfo:$e.bronze}}}const Qe=({userId:t,onRetryQuiz:o})=>{const[c,x]=e.useState([]),[m,u]=e.useState(!0),[p,h]=e.useState(null),[g,b]=e.useState({totalQuizzes:0,averageScore:0,bestScore:0,totalTime:0,badgesEarned:0});e.useEffect(()=>{t&&(f(),j())},[t]);const j=async()=>{try{const e=await Ae(t);e&&h(e)}catch(e){}},f=async()=>{try{u(!0);const{data:e,error:s}=await a.from("interactive_quiz_sessions").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(10);if(s)throw s;if(x(e||[]),e&&e.length>0){const s=e.length,t=e.filter(e=>"completed"===e.status),a=t.reduce((e,s)=>e+(s.score_percentage||0),0),r=t.length>0?Math.round(a/t.length):0,l=Math.max(...t.map(e=>e.score_percentage||0),0),n=t.reduce((e,s)=>e+(s.time_elapsed||0),0),i=t.filter(e=>e.badge_unlocked).length;b({totalQuizzes:s,averageScore:r,bestScore:l,totalTime:n,badgesEarned:i})}}catch(e){}finally{u(!1)}},v=e=>e>=80?"text-green-600 dark:text-green-400":e>=60?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",N=e=>{const s=new Date(e),t=new Date,a=Math.floor((t-s)/864e5);return 0===a?"Aujourd'hui":1===a?"Hier":a<7?`Il y a ${a} jours`:s.toLocaleDateString("fr-FR")};return m?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[s.jsx(r,{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border-blue-200 dark:border-blue-800",children:s.jsxs(i,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(se,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),s.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:"Total"})]}),s.jsx("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:g.totalQuizzes}),s.jsx("p",{className:"text-xs text-blue-600/70 dark:text-blue-400/70",children:"quiz"})]})}),s.jsx(r,{className:"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 border-green-200 dark:border-green-800",children:s.jsxs(i,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(V,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),s.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 font-medium",children:"Moyenne"})]}),s.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[g.averageScore,"%"]}),s.jsx("p",{className:"text-xs text-green-600/70 dark:text-green-400/70",children:"score"})]})}),s.jsx(r,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 border-yellow-200 dark:border-yellow-800",children:s.jsxs(i,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(W,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400"}),s.jsx("span",{className:"text-xs text-yellow-600 dark:text-yellow-400 font-medium",children:"Meilleur"})]}),s.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[g.bestScore,"%"]}),s.jsx("p",{className:"text-xs text-yellow-600/70 dark:text-yellow-400/70",children:"score"})]})}),s.jsx(r,{className:"bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 border-purple-200 dark:border-purple-800",children:s.jsxs(i,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(F,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"}),s.jsx("span",{className:"text-xs text-purple-600 dark:text-purple-400 font-medium",children:"Temps"})]}),s.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:Math.floor(g.totalTime/60)}),s.jsx("p",{className:"text-xs text-purple-600/70 dark:text-purple-400/70",children:"minutes"})]})}),s.jsx(r,{className:"bg-gradient-to-br from-pink-50 to-pink-100 dark:from-pink-900/20 dark:to-pink-800/20 border-pink-200 dark:border-pink-800",children:s.jsxs(i,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(X,{className:"w-4 h-4 text-pink-600 dark:text-pink-400"}),s.jsx("span",{className:"text-xs text-pink-600 dark:text-pink-400 font-medium",children:"Badges"})]}),s.jsx("p",{className:"text-2xl font-bold text-pink-700 dark:text-pink-300",children:g.badgesEarned}),s.jsx("p",{className:"text-xs text-pink-600/70 dark:text-pink-400/70",children:"d√©bloqu√©s"})]})})]}),p&&s.jsx(_e,{rank:p.rank,percentile:p.percentile,averageScore:p.averageScore,totalUsers:p.totalUsers}),s.jsx(ke,{sessions:c,loading:m}),s.jsxs(r,{children:[s.jsx(l,{children:s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(O,{className:"w-5 h-5"}),"Historique des Quiz"]})}),s.jsx(i,{children:0===c.length?s.jsxs("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400",children:[s.jsx(se,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),s.jsx("p",{children:"Aucun quiz compl√©t√© pour le moment"}),s.jsx("p",{className:"text-sm mt-1",children:"Lance ton premier quiz interactif !"})]}):s.jsx("div",{className:"space-y-3",children:c.map((e,t)=>{return s.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:`p-4 rounded-lg border ${r=e.score_percentage,r>=80?"bg-green-100 dark:bg-green-900/30":r>=60?"bg-yellow-100 dark:bg-yellow-900/30":"bg-red-100 dark:bg-red-900/30"} border-slate-200 dark:border-slate-700`,children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(Z,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"}),s.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:N(e.created_at)}),"completed"===e.status&&s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300",children:"Termin√©"}),"abandoned"===e.status&&s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300",children:"Abandonn√©"})]}),s.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(V,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"}),s.jsxs("span",{className:`font-bold text-lg ${v(e.score_percentage)}`,children:[e.score_percentage,"%"]}),s.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:["(",e.score,"/",e.total_questions,")"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(F,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"}),s.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:(a=e.time_elapsed,`${Math.floor(a/60)}min ${a%60}s`)})]}),e.badge_unlocked&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(X,{className:"w-4 h-4 text-yellow-500"}),s.jsx("span",{className:"text-sm text-yellow-600 dark:text-yellow-400 font-medium",children:"Badge d√©bloqu√© !"})]})]}),e.difficulty_level&&s.jsx("div",{className:"mt-2",children:s.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300",children:["Difficult√© : ",e.difficulty_level]})})]}),"completed"===e.status&&e.score_percentage<100&&o&&s.jsxs(d,{onClick:()=>o(e),variant:"outline",size:"sm",className:"gap-2",children:[s.jsx(te,{className:"w-4 h-4"}),"R√©viser"]})]})},e.id);var a,r})})})]})]})},Ie=({sessionId:t,userId:a,questions:o,userAnswers:c})=>{const[x,m]=e.useState([]),[u,p]=e.useState([]),[h,g]=e.useState(!0);e.useEffect(()=>{o&&c&&b()},[o,c]);const b=()=>{try{g(!0);const e=o.filter((e,s)=>{const t=c[s];return t&&!t.is_correct}),s={};e.forEach(e=>{let t="G√©n√©ral";e.question.includes("calculer")||e.question.includes("√ó")||e.question.includes("+")||e.question.includes("aire")?t="Math√©matiques":e.question.includes("capitale")||e.question.includes("pays")?t="G√©ographie":(e.question.includes("anglais")||e.question.includes("traduction"))&&(t="Langues"),s[t]||(s[t]={topic:t,mistakes:0,total:0,questions:[]}),s[t].mistakes++,s[t].questions.push(e)}),o.forEach(e=>{let t="G√©n√©ral";e.question.includes("calculer")||e.question.includes("√ó")||e.question.includes("+")||e.question.includes("aire")?t="Math√©matiques":e.question.includes("capitale")||e.question.includes("pays")?t="G√©ographie":(e.question.includes("anglais")||e.question.includes("traduction"))&&(t="Langues"),s[t]&&s[t].total++});const t=Object.values(s).filter(e=>e.mistakes>0).map(e=>({...e,errorRate:e.mistakes/e.total*100})).sort((e,s)=>s.errorRate-e.errorRate);p(t);const a=[];0===e.length?a.push({type:"success",icon:ae,title:"Parcours sans faute !",message:"Tu as r√©pondu correctement √† toutes les questions. Continue comme √ßa !",action:null}):e.length===o.length?a.push({type:"critical",icon:U,title:"R√©vision approfondie n√©cessaire",message:"Il semble que ce sujet soit nouveau pour toi. Je te recommande de revoir les bases avant de r√©essayer.",action:{label:"Revoir le cours",type:"review_course"}}):(t.forEach(e=>{e.errorRate>50?a.push({type:"warning",icon:re,title:`${e.topic} : Points √† am√©liorer`,message:`Tu as eu ${e.mistakes}/${e.total} erreurs en ${e.topic}. Une r√©vision cibl√©e t'aidera √† progresser.`,action:{label:`R√©viser ${e.topic}`,type:"review_topic",data:e}}):a.push({type:"info",icon:le,title:`${e.topic} : Quelques ajustements`,message:`Tu ma√Ætrises globalement ${e.topic}, mais attention √† quelques d√©tails.`,action:{label:"Revoir les erreurs",type:"review_mistakes",data:e}})}),e.length<o.length/2&&a.push({type:"success",icon:V,title:"Bon niveau g√©n√©ral",message:"Tu as une bonne base ! Quelques r√©visions cibl√©es suffiront pour atteindre l'excellence.",action:{label:"Refaire le quiz",type:"retry_quiz"}})),m(a)}catch(e){}finally{g(!1)}},j=e=>{switch(e){case"success":return"text-green-500";case"warning":return"text-yellow-500";case"critical":return"text-red-500";default:return"text-blue-500"}},f=e=>{switch(e){case"success":return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";case"warning":return"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800";case"critical":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";default:return"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}};return h?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):s.jsxs("div",{className:"space-y-6",children:[u.length>0&&s.jsxs(r,{children:[s.jsx(l,{children:s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(ne,{className:"w-5 h-5"}),"Analyse de tes points faibles"]})}),s.jsx(i,{children:s.jsx("div",{className:"space-y-4",children:u.map((e,t)=>s.jsxs($.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ie,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"}),s.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:e.topic})]}),s.jsxs("span",{className:"text-sm font-semibold "+(e.errorRate>50?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"),children:[Math.round(e.errorRate),"% d'erreurs"]})]}),s.jsx(C,{value:100-e.errorRate,className:"h-2"}),s.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:[e.mistakes," erreur",e.mistakes>1?"s":""," sur ",e.total," question",e.total>1?"s":""]})]},e.topic))})})]}),s.jsxs(r,{children:[s.jsx(l,{children:s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(le,{className:"w-5 h-5"}),"Suggestions personnalis√©es"]})}),s.jsx(i,{children:s.jsx("div",{className:"space-y-3",children:x.map((e,t)=>{const a=e.icon;return s.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:`p-4 rounded-lg border ${f(e.type)}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(a,{className:`w-5 h-5 mt-0.5 ${j(e.type)}`}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-200 mb-1",children:e.title}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-3",children:e.message}),e.action&&s.jsx(d,{size:"sm",variant:"outline",className:"gap-2",children:e.action.label})]})]})},t)})})})]})]})},Me=()=>{var t;const{user:o}=c(),[p,h]=e.useState(!0),[g,b]=e.useState([]),[j,f]=e.useState(null),[v,N]=e.useState(null),[y,k]=e.useState(null);e.useEffect(()=>{o&&w()},[o,v]);const w=async()=>{h(!0),k(null);try{const{data:e,error:s}=await a.from("interactive_quiz_sessions").select("user_id, score_percentage, created_at").eq("status","completed").order("created_at",{ascending:!1});if(s)throw s;const t=[...new Set((null==e?void 0:e.map(e=>e.user_id))||[])],{data:r,error:l}=await a.from("profiles").select("id, full_name").in("id",t);if(l)throw l;const n={};null==r||r.forEach(e=>{n[e.id]=e});const i={};null==e||e.forEach(e=>{const s=e.user_id,t=n[s];i[s]||(i[s]={user_id:s,full_name:(null==t?void 0:t.full_name)||"Utilisateur",avatar_url:null,total_quizzes:0,scores:[],best_score:0}),i[s].total_quizzes+=1,i[s].scores.push(e.score_percentage),i[s].best_score=Math.max(i[s].best_score,e.score_percentage)});const d=Object.values(i).map(e=>{const s=e.scores.reduce((e,s)=>e+s,0)/e.scores.length;let t="bronze";return s>=90?t="diamond":s>=80?t="platinum":s>=70?t="gold":s>=60&&(t="silver"),{user_id:e.user_id,full_name:e.full_name,avatar_url:e.avatar_url,total_quizzes:e.total_quizzes,average_score:Math.round(100*s)/100,best_score:e.best_score,rank_tier:t}});d.sort((e,s)=>s.average_score-e.average_score);const c=d.map((e,s)=>{const t=d.length;return{...e,global_rank:s+1,percentile:t>0?Math.round((t-s)/t*100*100)/100:0}}),x=c.find(e=>e.user_id===o.id);f(x||null);let m=c;v&&(m=m.filter(e=>e.rank_tier===v)),b(m.slice(0,50))}catch(e){k(e.message)}finally{h(!1)}};return p?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsx($.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:s.jsx(oe,{className:"w-8 h-8 text-blue-500"})})}):y?s.jsx(r,{className:"border-red-200 dark:border-red-800",children:s.jsx(i,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-red-600 dark:text-red-400",children:[s.jsx(U,{className:"w-5 h-5"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Erreur de chargement"}),s.jsx("p",{className:"text-sm",children:y})]})]})})}):s.jsxs("div",{className:"space-y-6",children:[j&&j.total_quizzes>0&&s.jsx($.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:s.jsx(_e,{stats:j,compact:!1})}),(!j||0===j.total_quizzes)&&s.jsx(r,{className:"border-2 border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20",children:s.jsx(i,{className:"pt-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx(W,{className:"w-12 h-12 text-blue-500 mx-auto mb-3"}),s.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"Compl√©tez des quiz pour appara√Ætre dans le classement !"}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Votre rang et votre percentile seront calcul√©s automatiquement apr√®s votre premier quiz."})]})})}),s.jsxs(r,{children:[s.jsx(l,{children:s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(de,{className:"w-5 h-5"}),"Filtrer par rang"]})}),s.jsx(i,{children:s.jsx("div",{className:"flex flex-wrap gap-2",children:[{id:null,label:"Tous",color:"bg-slate-500"},{id:"bronze",label:"Bronze",color:"bg-amber-600"},{id:"silver",label:"Argent",color:"bg-slate-500"},{id:"gold",label:"Or",color:"bg-yellow-500"},{id:"platinum",label:"Platine",color:"bg-cyan-400"},{id:"diamond",label:"Diamant",color:"bg-purple-500"}].map(e=>s.jsxs(d,{variant:v===e.id?"default":"outline",size:"sm",onClick:()=>N(e.id),className:"gap-2",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${e.color}`}),e.label]},e.id||"all"))})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(r,{className:"border-2 shadow-lg",children:s.jsxs(i,{className:"pt-6 text-center",children:[s.jsx(W,{className:"w-8 h-8 text-yellow-500 mx-auto mb-2"}),s.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[(null==(t=g[0])?void 0:t.average_score.toFixed(0))||0,"%"]}),s.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Meilleur score moyen"})]})}),s.jsx(r,{className:"border-2 shadow-lg",children:s.jsxs(i,{className:"pt-6 text-center",children:[s.jsx(ce,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),s.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:g.length}),s.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Participants actifs"})]})}),s.jsx(r,{className:"border-2 shadow-lg",children:s.jsxs(i,{className:"pt-6 text-center",children:[s.jsx(O,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),s.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["#",(null==j?void 0:j.global_rank)||"--"]}),s.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Votre classement"})]})})]}),s.jsxs(r,{children:[s.jsx(l,{children:s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(W,{className:"w-5 h-5 text-yellow-500"}),"Classement des Quiz Interactifs",s.jsxs("span",{className:"ml-auto text-sm font-normal text-slate-600 dark:text-slate-400",children:["Top ",g.length]})]})}),s.jsx(i,{children:0===g.length?s.jsxs("div",{className:"text-center py-12 text-slate-600 dark:text-slate-400",children:[s.jsx(ce,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),s.jsx("p",{children:"Aucun participant dans cette cat√©gorie"})]}):s.jsx("div",{className:"space-y-3",children:s.jsx(A,{mode:"popLayout",children:g.map((e,t)=>{var a;const r=e.user_id===(null==o?void 0:o.id);return s.jsx($.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:.05*t},className:`\n                        p-4 rounded-lg border-2 transition-all duration-300\n                        ${r?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-700 shadow-lg":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:shadow-md"}\n                      `,children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"flex items-center justify-center w-12 h-12 flex-shrink-0",children:(l=e.global_rank,1===l?s.jsx(ee,{className:"w-6 h-6 text-yellow-500"}):2===l?s.jsx(xe,{className:"w-6 h-6 text-slate-400"}):3===l?s.jsx(xe,{className:"w-6 h-6 text-amber-600"}):s.jsxs("span",{className:"text-lg font-bold text-slate-600 dark:text-slate-300",children:["#",l]}))}),s.jsxs(x,{className:`w-12 h-12 flex-shrink-0 ${e.global_rank<=3?"ring-2":""} ${1===e.global_rank?"ring-yellow-400":2===e.global_rank?"ring-slate-400":3===e.global_rank?"ring-amber-600":""}`,children:[s.jsx(m,{src:e.avatar_url}),s.jsx(u,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white font-semibold",children:(null==(a=e.full_name)?void 0:a.charAt(0))||"U"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("h3",{className:"font-semibold truncate "+(r?"text-blue-900 dark:text-blue-300":"text-slate-900 dark:text-white"),children:e.full_name||"Utilisateur anonyme"}),r&&s.jsx("span",{className:"px-2 py-0.5 bg-gradient-to-r from-green-400 to-green-600 text-white text-xs rounded-full",children:"Vous"})]}),s.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-600 dark:text-slate-400",children:[s.jsxs("span",{children:[e.total_quizzes," quiz"]}),s.jsx("span",{children:"‚Ä¢"}),s.jsxs("span",{className:"font-semibold",children:[e.average_score.toFixed(0),"% moyenne"]})]})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx(we,{tier:e.rank_tier,percentile:e.percentile,size:"sm",showPercentile:!0,showLabel:!1,animated:!1})}),s.jsxs("div",{className:"text-right flex-shrink-0",children:[s.jsxs("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[e.average_score.toFixed(0),"%"]}),s.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Top ",(100-e.percentile).toFixed(0),"%"]})]})]})},e.user_id);var l})})})})]}),s.jsx(r,{className:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",children:s.jsx(i,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(X,{className:"w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"text-sm text-slate-700 dark:text-slate-300",children:[s.jsx("p",{className:"font-semibold mb-1",children:"Classement anonymis√©"}),s.jsx("p",{children:"Votre position et vos statistiques sont visibles uniquement par vous. Les autres participants voient un classement anonymis√© pour prot√©ger votre vie priv√©e."})]})]})})})]})},Pe=()=>{fe(),ve();const{user:o}=c(),{toast:x}=p(),[m,u]=e.useState(null),[C,A]=e.useState({level:1,totalPoints:0,currentStreak:0,completedChapters:0,totalBadges:0,averageScore:0}),[Q,I]=e.useState(""),[M,P]=e.useState([]),[E,T]=e.useState(!0),[L,R]=e.useState("conversation"),[B,D]=e.useState(!1),[U,O]=e.useState({subject:"Math√©matiques",chapter:null,difficulty:"medium"}),[H,G]=e.useState(null),[J,Z]=e.useState(!1),[X,Y]=e.useState(null),[ee,te]=e.useState(null),[ae,re]=e.useState(""),[de,ce]=e.useState(null),{currentProvider:xe,switchProvider:je}=h(),ye={page:"coach-ia",section:"conversation"},{conversations:ke,currentConversation:we,messages:_e,loading:qe,sending:Ce,createConversation:ze,loadConversation:Se,sendMessage:$e,sendMessageWithImages:Ae,deleteConversation:Pe,renameConversation:Ee,togglePinConversation:Te}=g(null,ye.page,ye);e.useEffect(()=>{(async()=>{if(!o)return;const{data:e,error:s}=await a.from("profiles").select("*").eq("id",o.id).single();if(!s&&e){u(e);try{const e=await S(o.id);e&&u(s=>({...s,orientation:e}))}catch(t){}}})()},[o]),e.useEffect(()=>{(async()=>{if(o)try{const{data:e}=await a.from("profiles").select("full_name").eq("id",o.id).single(),{data:s}=await a.from("user_points").select("total_points, level, current_streak").eq("user_id",o.id).single(),{data:t}=await a.from("user_progress").select("id").eq("user_id",o.id).eq("completed",!0),{data:r}=await a.from("user_badges").select("id").eq("user_id",o.id),{data:l}=await a.from("quiz_results").select("score, total_questions").eq("user_id",o.id);let n=0;if(l&&l.length>0){const e=l.filter(e=>e.total_questions>0);e.length>0&&(n=Math.round(e.reduce((e,s)=>e+s.score/s.total_questions*100,0)/e.length))}A({level:(null==s?void 0:s.level)||1,totalPoints:(null==s?void 0:s.total_points)||0,currentStreak:(null==s?void 0:s.current_streak)||0,completedChapters:(null==t?void 0:t.length)||0,totalBadges:(null==r?void 0:r.length)||0,averageScore:n})}catch(e){}})()},[o]),e.useEffect(()=>{o&&"analyse"===L&&Le()},[o,L]);const Le=async()=>{Z(!0);try{const e=new z(o.id);ce(e);const s=await e.analyzePerformance();Y(s);const t=e.generateMotivationalMessage(s);re(t);const a=await e.generateStudyPlan(null,2);te(a)}catch(e){x({variant:"destructive",title:"Erreur",description:"Impossible de charger l'analyse IA"})}finally{Z(!1)}},Re=async()=>{var e;if(!o)return{};try{const{data:s}=await a.from("user_points").select("total_points, level, current_streak, longest_streak, quizzes_completed, lessons_completed").eq("user_id",o.id).single(),{data:t}=await a.from("user_progress").select("*").eq("user_id",o.id),{data:r}=await a.from("user_badges").select("\n          id,\n          earned_at,\n          badge_id,\n          badges!inner (\n            badge_id,\n            name,\n            icon_name,\n            description\n          )\n        ").eq("user_id",o.id).order("earned_at",{ascending:!1}),{data:l}=await a.from("user_progress").select("\n          chapitre_id,\n          completed,\n          progress_percentage,\n          chapitres (\n            id,\n            title,\n            matieres (\n              name\n            )\n          )\n        ").eq("user_id",o.id).eq("completed",!0),n=[...new Set((null==l?void 0:l.map(e=>{var s,t;return null==(t=null==(s=e.chapitres)?void 0:s.matieres)?void 0:t.name}).filter(Boolean))||[])];return{userName:(null==m?void 0:m.full_name)||(null==(e=o.email)?void 0:e.split("@")[0])||"√âtudiant",level:(null==s?void 0:s.level)||1,totalPoints:(null==s?void 0:s.total_points)||0,currentStreak:(null==s?void 0:s.current_streak)||0,completedChapters:(null==l?void 0:l.length)||0,totalBadges:(null==r?void 0:r.length)||0,matieres:n,recentBadges:(null==r?void 0:r.slice(0,3).map(e=>e.badges.name))||[]}}catch(s){return{userName:(null==m?void 0:m.full_name)||"√âtudiant",level:1,totalPoints:0}}},Be=async()=>{if(Q.trim()||0!==M.length)try{const e=await Re(),s={page:"coach-ia",section:"conversation"};let t=null==we?void 0:we.id;if(!t){const s=await ze("coach-ia",{section:"conversation",userContext:e});t=null==s?void 0:s.id}M.length>0?(await Ae(Q,M,t,e),P([])):await $e(Q,"text",null,t,e,s),I("")}catch(e){}};return s.jsxs(s.Fragment,{children:[s.jsxs(t,{children:[s.jsx("title",{children:"Coach IA - E-R√©ussite"}),s.jsx("meta",{name:"description",content:"Votre coach IA personnel avec conversation et analyse de performances"})]}),s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-purple-50 dark:from-slate-900 dark:via-slate-900 dark:to-slate-950",children:s.jsxs("div",{className:"container mx-auto p-4 lg:p-6",children:[s.jsx($.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6 bg-gradient-to-r from-blue-50 via-green-50 to-pink-50 dark:from-slate-800 dark:via-green-900/30 dark:to-slate-900 rounded-2xl p-6 shadow-[0_0_32px_0_rgba(34,197,94,0.18)] dark:shadow-[0_0_40px_0_rgba(34,197,94,0.25)]",children:s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg",children:s.jsx(me,{className:"w-7 h-7 text-white"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:["Coach IA",s.jsx(ue,{className:"w-6 h-6 text-yellow-500"})]}),s.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"Conversation & Analyse personnalis√©e"})]})]}),s.jsxs("div",{className:"hidden lg:flex items-center gap-4",children:[s.jsxs("div",{className:"text-center px-4 py-2 bg-white/80 dark:bg-slate-700/80 backdrop-blur rounded-lg shadow-md border border-white/20 dark:border-slate-600/30",children:[s.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-300",children:"Niveau"}),s.jsx("p",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:C.level})]}),s.jsxs("div",{className:"text-center px-4 py-2 bg-white/80 dark:bg-slate-700/80 backdrop-blur rounded-lg shadow-md border border-white/20 dark:border-slate-600/30",children:[s.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-300",children:"Points"}),s.jsx("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:C.totalPoints})]}),s.jsxs("div",{className:"text-center px-4 py-2 bg-white/80 dark:bg-slate-700/80 backdrop-blur rounded-lg shadow-md border border-white/20 dark:border-slate-600/30",children:[s.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-300",children:"S√©rie"}),s.jsxs("p",{className:"text-xl font-bold text-orange-600 dark:text-orange-400",children:["üî• ",C.currentStreak]})]})]})]})}),s.jsxs(k,{value:L,onValueChange:R,className:"space-y-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"overflow-x-auto scrollbar-hide",children:s.jsxs(w,{className:"inline-flex w-auto min-w-full lg:w-auto gap-2 p-1",children:[s.jsxs(_,{value:"conversation",className:"gap-2 flex-shrink-0",children:[s.jsx(pe,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Conversation"})]}),s.jsxs(_,{value:"recherche",className:"gap-2 flex-shrink-0",children:[s.jsx(he,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Recherche Web"})]}),s.jsxs(_,{value:"analyse",className:"gap-2 flex-shrink-0",children:[s.jsx(ne,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Analyse & Conseils"})]}),s.jsxs(_,{value:"history",className:"gap-2 flex-shrink-0",children:[s.jsx(se,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Historique Quiz"})]}),s.jsxs(_,{value:"suggestions",className:"gap-2 flex-shrink-0",children:[s.jsx(V,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Suggestions"})]}),s.jsxs(_,{value:"leaderboard",className:"gap-2 flex-shrink-0",children:[s.jsx(W,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Classement"})]})]})}),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-background to-transparent pointer-events-none lg:hidden"})]}),s.jsxs(q,{value:"conversation",className:"space-y-4",children:[s.jsx(r,{className:"border-blue-200 dark:border-blue-700",children:s.jsx(i,{className:"pt-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(b,{currentProvider:xe,onProviderChange:je}),s.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 flex items-center gap-2",children:[s.jsx(pe,{className:"w-4 h-4"}),ke.length," conversation",ke.length>1?"s":""]})]})})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4",children:[E&&s.jsxs(r,{className:"lg:col-span-3 h-[calc(100vh-200px)] overflow-hidden flex flex-col shadow-[0_0_16px_0_rgba(34,197,94,0.10)] dark:shadow-[0_0_24px_0_rgba(34,197,94,0.18)] dark:bg-slate-800 dark:border-slate-700",children:[s.jsxs(l,{className:"pb-3",children:[s.jsx(n,{className:"text-lg",children:"Conversations"}),s.jsx(j,{children:"Historique"})]}),s.jsx(i,{className:"flex-1 overflow-y-auto p-0",children:s.jsx(f,{conversations:ke,currentConversationId:null==we?void 0:we.id,onSelectConversation:Se,onCreateConversation:async()=>{const e=await Re();await ze("coach-ia",{userContext:e})},onPinConversation:Te,onRenameConversation:Ee,onDeleteConversation:Pe,loading:qe.conversations})})]}),s.jsxs(r,{className:(E?"lg:col-span-9":"lg:col-span-12")+" h-[calc(100vh-200px)] flex flex-col shadow-[0_0_16px_0_rgba(34,197,94,0.10)] dark:shadow-[0_0_24px_0_rgba(34,197,94,0.18)] dark:bg-slate-900 dark:border-slate-700",children:[s.jsx(l,{className:"border-b",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx(n,{children:(null==we?void 0:we.title)||"Nouvelle conversation"}),s.jsxs(j,{children:[_e.length," message",_e.length>1?"s":""]})]}),s.jsxs(d,{variant:"outline",size:"sm",onClick:()=>T(!E),children:[E?"Masquer":"Afficher"," l'historique"]})]})}),s.jsxs(i,{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[B?s.jsx(Ne,{userId:null==o?void 0:o.id,config:U,onComplete:async e=>{D(!1);const s=Math.round(e.correctAnswers/e.totalQuestions*100);let t="";t=s>=80?`üéâ F√©licitations ! Tu as brillamment r√©ussi avec ${s}% de bonnes r√©ponses ! ${e.badgeEarned?"\nüèÜ Tu as d√©bloqu√© un badge : "+e.badgeEarned.name+" "+e.badgeEarned.icon+" !":""}`:s>=60?`üëç Bravo ! Tu as obtenu ${s}% ! C'est un bon score, continue sur cette lanc√©e !`:`üí™ Tu as obtenu ${s}%. Ne te d√©courage pas ! L'important c'est de progresser. Veux-tu qu'on r√©vise ensemble les notions o√π tu as eu des difficult√©s ?`;const a=`üìä **Quiz Interactif Termin√© !**\n\n${t}\n\n**R√©sum√© de ta performance :**\n‚úÖ Bonnes r√©ponses : ${e.correctAnswers}/${e.totalQuestions}\nüìà Score : ${s}%\n‚è±Ô∏è Temps √©coul√© : ${Math.floor(e.timeElapsed/60)}min ${e.timeElapsed%60}s\n\n${s>=80?"üåü Excellente ma√Ætrise du sujet !":s>=60?"üëè Bon travail, tu progresses bien !":"üí° Continue √† t'entra√Æner, tu vas y arriver !"}`;try{let e=we;if((null==e?void 0:e.id)||(e=await ze(),await new Promise(e=>setTimeout(e,500))),null==e?void 0:e.id){(await v.saveMessage(e.id,"assistant",a,"text",{quiz_feedback:!0,score:s})).success&&await Se(e.id)}else x({title:"üéâ Quiz termin√© !",description:t,duration:8e3})}catch(r){x({title:"üéâ Quiz termin√© !",description:t,duration:8e3})}G({sessionId:e.sessionId,results:e,questions:e.questions||[],userAnswers:e.userAnswers||[]}),x({title:"Quiz termin√© !",description:`${s}% - ${e.correctAnswers}/${e.totalQuestions} bonnes r√©ponses`,duration:5e3}),setTimeout(()=>{R("suggestions")},2e3)},onCancel:()=>D(!1)}):0===_e.length?s.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-12",children:[s.jsx(me,{className:"w-16 h-16 text-slate-300 dark:text-slate-600 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Commencez une conversation"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 max-w-md mb-6",children:"Posez-moi des questions sur vos cours, statistiques ou demandez des conseils !"}),s.jsxs(d,{onClick:()=>D(!0),className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 gap-2",children:[s.jsx(ue,{className:"w-4 h-4"}),"Lancer un Quiz Interactif"]})]}):s.jsx("div",{className:"space-y-4",children:_e.map(e=>s.jsx(N,{message:e,isUser:"user"===e.role,canEdit:!1,canDelete:!1,onEdit:()=>{},onDelete:()=>{}},e.id))}),Ce&&s.jsxs("div",{className:"flex items-center gap-2 text-slate-500",children:[s.jsx(oe,{className:"w-4 h-4 animate-spin"}),s.jsx("span",{className:"text-sm",children:"L'IA r√©fl√©chit..."})]})]}),s.jsxs(i,{className:"border-t p-4",children:[!B&&s.jsx("div",{className:"mb-3",children:s.jsxs(d,{onClick:()=>D(!0),variant:"outline",className:"w-full bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-purple-300 dark:border-purple-700 hover:from-purple-100 hover:to-pink-100 dark:hover:from-purple-900/30 dark:hover:to-pink-900/30 gap-2",children:[s.jsx(ue,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"}),s.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:"Lancer un Quiz Interactif"})]})}),M.length>0&&s.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto pb-2",children:M.map((e,t)=>s.jsxs("div",{className:"relative flex-shrink-0",children:[s.jsx("img",{src:URL.createObjectURL(e),alt:`S√©lection ${t+1}`,className:"w-20 h-20 object-cover rounded-lg border"}),s.jsx("button",{onClick:()=>P(e=>e.filter((e,s)=>s!==t)),className:"absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full text-xs",children:"√ó"})]},t))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const s=Array.from(e.target.files||[]);P(e=>[...e,...s])},className:"hidden",id:"image-upload"}),s.jsx("label",{htmlFor:"image-upload",children:s.jsx(d,{variant:"outline",size:"icon",className:"cursor-pointer",asChild:!0,children:s.jsx("span",{children:s.jsx(ge,{className:"w-4 h-4"})})})}),s.jsx("input",{type:"text",value:Q,onChange:e=>I(e.target.value),onKeyPress:e=>"Enter"===e.key&&!e.shiftKey&&Be(),placeholder:"Posez votre question...",className:"flex-1 px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:Ce}),s.jsx(d,{onClick:Be,disabled:Ce||!Q.trim()&&0===M.length,className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:Ce?s.jsx(oe,{className:"w-4 h-4 animate-spin"}):s.jsx(be,{className:"w-4 h-4"})})]})]})]})]})]}),s.jsx(q,{value:"recherche",className:"space-y-6",children:s.jsxs(r,{className:"border-purple-200 dark:border-purple-700 overflow-hidden",children:[s.jsx(l,{className:"bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-purple-500 rounded-lg",children:s.jsx(he,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx(n,{className:"text-lg",children:"Recherche Web Intelligente"}),s.jsx(j,{className:"text-sm",children:"Powered by Perplexity AI Pro ‚Ä¢ Recherche en temps r√©el avec sources fiables"})]})]})}),s.jsx(i,{className:"p-0 overflow-hidden",children:s.jsx(y,{userContext:{subject:(null==m?void 0:m.favorite_subject)||"g√©n√©ral",level:(null==m?void 0:m.level)||"BFEM"}})})]})}),s.jsx(q,{value:"analyse",className:"space-y-6",children:J?s.jsx(r,{children:s.jsxs(i,{className:"py-12 text-center",children:[s.jsx(oe,{className:"w-12 h-12 animate-spin mx-auto mb-4 text-primary"}),s.jsx("p",{className:"text-lg font-medium",children:"Analyse de vos performances en cours..."}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mt-2",children:"Cela peut prendre quelques secondes"})]})}):X?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(r,{children:[s.jsxs(l,{children:[s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(W,{className:"w-5 h-5 text-green-500"}),"Points Forts"]}),s.jsx(j,{children:"Mati√®res o√π vous excellez"})]}),s.jsx(i,{className:"space-y-3",children:X.strengths&&X.strengths.length>0?X.strengths.map((e,t)=>s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[s.jsx("div",{className:"text-2xl",children:e.icon||"‚úÖ"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:e.title}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:e.description})]})]},t)):s.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Continuez √† travailler pour identifier vos points forts !"})})]}),s.jsxs(r,{children:[s.jsxs(l,{children:[s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(V,{className:"w-5 h-5 text-orange-500"}),"√Ä Am√©liorer"]}),s.jsx(j,{children:"Mati√®res n√©cessitant plus d'attention"})]}),s.jsx(i,{className:"space-y-3",children:X.weaknesses&&X.weaknesses.length>0?X.weaknesses.map((e,t)=>s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-orange-50 rounded-lg border border-orange-200",children:[s.jsx("div",{className:"text-2xl",children:e.icon||"‚ö†Ô∏è"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:e.title}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:e.description}),e.recommendations&&e.recommendations.length>0&&s.jsx("ul",{className:"text-xs text-slate-500 mt-2 space-y-1",children:e.recommendations.slice(0,2).map((e,t)=>s.jsxs("li",{children:["‚Ä¢ ",e]},t))})]})]},t)):s.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"Excellent ! Aucune faiblesse majeure d√©tect√©e."})})]})]}),ee&&ee.recommendations&&ee.recommendations.length>0&&s.jsxs(r,{children:[s.jsxs(l,{children:[s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(ie,{className:"w-5 h-5 text-primary"}),"Plan d'√âtude Recommand√©"]}),s.jsx(j,{children:"Actions prioritaires pour progresser"})]}),s.jsx(i,{className:"space-y-4",children:ee.recommendations.map((e,t)=>s.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg border border-slate-200 hover:border-primary transition-colors",children:[s.jsx("div",{className:"flex items-start justify-between mb-3",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsxs("span",{className:"text-sm font-bold text-primary",children:["#",t+1]}),s.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white",children:e.matiere})]}),s.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-2",children:e.reason}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(F,{className:"w-3 h-3"}),e.estimatedTime]}),e.priority&&s.jsx("span",{className:"px-2 py-0.5 rounded font-medium "+("high"===e.priority?"bg-red-100 text-red-700":"medium"===e.priority?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"),children:"high"===e.priority?"Urgent":"medium"===e.priority?"Important":"Normal"})]})]})}),s.jsxs(d,{size:"sm",className:"w-full",onClick:()=>{e.matiereId&&(window.location.href=`/course/${e.matiereId}`)},children:[s.jsx(K,{className:"w-4 h-4 mr-1"}),"Commencer cette mati√®re"]})]},t))})]})]}):s.jsx(r,{children:s.jsxs(i,{className:"py-16 text-center",children:[s.jsx(ne,{className:"w-20 h-20 text-slate-300 mx-auto mb-6"}),s.jsx("h3",{className:"text-2xl font-semibold text-slate-900 dark:text-white mb-3",children:"Aucune analyse disponible"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6 max-w-md mx-auto",children:"G√©n√©rez votre premi√®re analyse pour d√©couvrir vos statistiques d√©taill√©es, vos points forts et recevoir des recommandations personnalis√©es."}),s.jsxs(d,{onClick:Le,size:"lg",className:"bg-gradient-to-r from-primary to-indigo-600 hover:from-primary/90 hover:to-indigo-600/90",children:[s.jsx(ue,{className:"w-5 h-5 mr-2"}),"G√©n√©rer mon analyse"]})]})})}),s.jsx(q,{value:"history",className:"space-y-4",children:s.jsxs(r,{className:"border-purple-200 dark:border-purple-700",children:[s.jsxs(l,{children:[s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(se,{className:"w-6 h-6 text-purple-500"}),"Historique des Quiz Interactifs"]}),s.jsx(j,{children:"Consulte tous tes quiz pass√©s et recommence ceux que tu veux r√©viser"})]}),s.jsx(i,{children:s.jsx(Qe,{userId:null==o?void 0:o.id,onRetryQuiz:e=>{R("conversation"),O({subject:e.subject||"G√©n√©ral",difficulty:e.difficulty_level||"medium",reviewMode:!0,sessionId:e.id}),D(!0)}})})]})}),s.jsx(q,{value:"suggestions",className:"space-y-4",children:s.jsxs(r,{className:"border-orange-200 dark:border-orange-700",children:[s.jsxs(l,{children:[s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(le,{className:"w-6 h-6 text-orange-500"}),"Suggestions de R√©vision"]}),s.jsx(j,{children:"Recommandations personnalis√©es bas√©es sur ton dernier quiz"})]}),s.jsx(i,{children:H?s.jsx(Ie,{userId:null==o?void 0:o.id,sessionId:H.sessionId,questions:H.questions,userAnswers:H.userAnswers}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(le,{className:"w-16 h-16 text-slate-300 dark:text-slate-600 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-slate-700 dark:text-slate-200 mb-2",children:"Aucune suggestion disponible"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 max-w-md mb-6",children:"Compl√®te un quiz interactif pour recevoir des suggestions personnalis√©es bas√©es sur tes r√©ponses !"}),s.jsxs(d,{onClick:()=>{R("conversation"),D(!0)},className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:[s.jsx(V,{className:"w-4 h-4 mr-2"}),"Lancer un Quiz"]})]})})]})}),s.jsx(q,{value:"leaderboard",className:"space-y-4",children:s.jsxs(r,{className:"border-purple-200 dark:border-purple-700",children:[s.jsxs(l,{children:[s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(W,{className:"w-6 h-6 text-purple-500"}),"Classement des Quiz Interactifs"]}),s.jsx(j,{children:"Compare ta progression avec les autres √©l√®ves"})]}),s.jsx(i,{children:s.jsx(Me,{userId:null==o?void 0:o.id})})]})})]})]})})]})};export{Pe as default};
