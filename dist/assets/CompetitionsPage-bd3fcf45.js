import{j as e,r}from"./vendor-react-470eca1f.js";import{u as t}from"./useCompetitions-2d7d8ef5.js";import{f as a,U as s,J as l,g as i,m as d,e as n,aI as o,aP as c,ao as x,aH as m,bj as g,bD as p}from"./vendor-ui-297a683c.js";import{c as h}from"./vendor-router-da2b77bd.js";import"./index-80385b81.js";import"./vendor-supabase-1d8f37f5.js";import"./vendor-charts-0ffd78b1.js";const b=({competition:r,onClick:t})=>{const c=r.max_participants?r.current_participants/r.max_participants*100:null,x=c>=100;return e.jsxs("div",{onClick:t,className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg border border-gray-200 dark:border-gray-700 p-6 cursor-pointer transition-all hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[(()=>{const t={upcoming:{bg:"bg-blue-100 dark:bg-blue-900/30",text:"text-blue-700 dark:text-blue-400",icon:e.jsx(d,{className:"w-3 h-3"}),label:"Ã€ venir"},active:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-400",icon:e.jsx(n,{className:"w-3 h-3"}),label:"En cours"},completed:{bg:"bg-gray-100 dark:bg-gray-700",text:"text-gray-700 dark:text-gray-400",icon:e.jsx(o,{className:"w-3 h-3"}),label:"TerminÃ©e"}},a=t[r.status]||t.upcoming;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a.bg} ${a.text}`,children:[a.icon,a.label]})})(),e.jsx("span",{className:`text-xs font-semibold uppercase ${(()=>{const e={facile:"text-green-600 dark:text-green-400",moyen:"text-orange-600 dark:text-orange-400",difficile:"text-red-600 dark:text-red-400"};return e[r.difficulty]||e.moyen})()}`,children:r.difficulty})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:r.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:r.description})]}),e.jsx("div",{className:"ml-4 flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx(a,{className:"w-6 h-6 text-white"})})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[r.current_participants||0,r.max_participants&&` / ${r.max_participants}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[r.duration_minutes," min"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[r.questions_count," questions"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm font-semibold text-yellow-600 dark:text-yellow-400",children:["+",r.reward_points," pts"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.subject&&e.jsx("span",{className:"px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full text-xs font-medium",children:r.subject.charAt(0).toUpperCase()+r.subject.slice(1)}),r.grade_level&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded-full text-xs font-medium",children:"troisieme"===r.grade_level?"BFEM":"BAC"})]}),r.max_participants&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Places restantes"}),e.jsx("span",{className:"text-xs font-semibold text-gray-900 dark:text-white",children:r.max_participants-r.current_participants})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all "+(x?"bg-red-500":c>80?"bg-orange-500":"bg-green-500"),style:{width:`${Math.min(c,100)}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(l,{className:"w-4 h-4"}),(()=>{if(!r.starts_at)return null;const e=new Date,t=new Date(r.starts_at),a=new Date(r.ends_at);if("upcoming"===r.status){const r=t-e,a=Math.floor(r/36e5),s=Math.floor(a/24);return s>0?`Commence dans ${s}j`:a>0?`Commence dans ${a}h`:"Commence bientÃ´t"}if("active"===r.status){const r=a-e,t=Math.floor(r/36e5),s=Math.floor(r%36e5/6e4);return t>0?`Se termine dans ${t}h ${s}min`:s>0?`Se termine dans ${s}min`:"Se termine bientÃ´t"}return"TerminÃ©e"})()]}),e.jsx("button",{className:"px-4 py-2 rounded-lg font-semibold transition-colors "+("active"!==r.status||x?"upcoming"!==r.status||x?"bg-gray-300 dark:bg-gray-600 text-gray-600 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700":"bg-purple-600 text-white hover:bg-purple-700"),disabled:"completed"===r.status||x,children:"completed"===r.status?"Voir les rÃ©sultats":x?"Complet":"active"===r.status?"Participer":"S'inscrire"})]})]})},u=({competitionId:s=null,maxEntries:l=10})=>{const{leaderboard:i,loadLeaderboard:d}=t(s),[o,p]=r.useState("global"),[h,b]=r.useState(new Set);r.useEffect(()=>{s&&d(s,o,l)},[s,o,l,d]),r.useEffect(()=>{const e=new Set;i.forEach(r=>{r.rank<=3&&e.add(r.user_id)}),b(e);const r=setTimeout(()=>{b(new Set)},2e3);return()=>clearTimeout(r)},[i]);const u=(e,r)=>r?"bg-purple-50 dark:bg-purple-900/30 border-purple-300 dark:border-purple-700":1===e?"bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 border-yellow-300 dark:border-yellow-700":2===e?"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800/20 dark:to-gray-700/20 border-gray-300 dark:border-gray-600":3===e?"bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 border-orange-300 dark:border-orange-700":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700";return i&&0!==i.length?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 sticky top-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(a,{className:"w-6 h-6 text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Classement Live"}),e.jsx(n,{className:"w-5 h-5 text-orange-500 animate-pulse"})]}),s&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:()=>p("global"),className:"flex-1 px-3 py-2 rounded-lg text-xs font-semibold transition-colors "+("global"===o?"bg-purple-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"ðŸŒ Global"}),e.jsx("button",{onClick:()=>p("regional"),className:"flex-1 px-3 py-2 rounded-lg text-xs font-semibold transition-colors "+("regional"===o?"bg-purple-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"ðŸ“ RÃ©gion"}),e.jsx("button",{onClick:()=>p("national"),className:"flex-1 px-3 py-2 rounded-lg text-xs font-semibold transition-colors "+("national"===o?"bg-purple-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),children:"ðŸ‡¸ðŸ‡³ National"})]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto custom-scrollbar",children:i.map((r,t)=>{var a;const s=r.is_current_user,l=h.has(r.user_id);return e.jsx("div",{className:`\n                p-3 rounded-lg border-2 transition-all duration-300\n                ${u(r.rank,s)}\n                ${l?"scale-105 shadow-lg":""}\n                ${s?"ring-2 ring-purple-500 ring-offset-2 dark:ring-offset-gray-800":""}\n              `,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 text-center",children:r.rank<=3?(i=r.rank,1===i?e.jsx(m,{className:"w-6 h-6 text-yellow-500"}):2===i?e.jsx(g,{className:"w-6 h-6 text-gray-400"}):3===i?e.jsx(g,{className:"w-6 h-6 text-orange-600"}):null):e.jsxs("span",{className:"text-sm font-bold text-gray-600 dark:text-gray-400",children:["#",r.rank]})}),e.jsx("div",{className:"flex-shrink-0",children:r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:r.username,className:"w-10 h-10 rounded-full border-2 border-white dark:border-gray-700"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-white font-bold border-2 border-white dark:border-gray-700",children:(null==(a=r.username)?void 0:a.charAt(0).toUpperCase())||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("p",{className:"font-semibold truncate "+(s?"text-purple-700 dark:text-purple-400":"text-gray-900 dark:text-white"),children:[r.username,s&&e.jsx("span",{className:"ml-2 text-xs bg-purple-600 text-white px-2 py-0.5 rounded-full",children:"Vous"})]})}),r.location&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:[e.jsx(c,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:r.location})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600 dark:text-gray-400 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-3 h-3"}),r.correct_answers," bonnes"]}),e.jsxs("span",{children:["â±ï¸ ",Math.floor(r.time_taken_seconds/60),"m"]})]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right",children:[e.jsx("p",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:r.score}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"points"})]})]})},r.user_id);var i})}),i.length>=l&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Top ",l," participants affichÃ©s"]})})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(a,{className:"w-6 h-6 text-yellow-500"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Classement Live"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center py-8",children:"Aucun participant pour le moment"})]})},y=()=>{const l=h(),{competitions:n,stats:o,loading:c,error:m,loadCompetitions:g,loadStats:y}=t(),[j,f]=r.useState({status:"all",subject:"all",grade_level:"all"}),[v,N]=r.useState(!1),[k,w]=r.useState("active");r.useEffect(()=>{g(),y()},[g,y]);const _=n.filter(e=>("active"!==k||"active"===e.status)&&(("upcoming"!==k||"upcoming"===e.status)&&(("completed"!==k||"completed"===e.status)&&(("all"===j.subject||e.subject===j.subject)&&("all"===j.grade_level||e.grade_level===j.grade_level)))));return c&&0===n.length?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Chargement des compÃ©titions..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(a,{className:"w-8 h-8 text-yellow-500"}),"CompÃ©titions Live"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"DÃ©fiez vos pairs et montez dans le classement francophone"})]}),e.jsxs("button",{onClick:()=>N(!v),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(p,{className:"w-4 h-4"}),"Filtres"]})]}),o&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"w-8 h-8 opacity-80"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:"Participations"}),e.jsx("p",{className:"text-2xl font-bold",children:o.totalCompetitions})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"w-8 h-8 opacity-80"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:"Score Total"}),e.jsx("p",{className:"text-2xl font-bold",children:o.totalScore})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{className:"w-8 h-8 opacity-80"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:"Top 3"}),e.jsx("p",{className:"text-2xl font-bold",children:o.topRanks})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{className:"w-8 h-8 opacity-80"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-90",children:"Rang Moyen"}),e.jsxs("p",{className:"text-2xl font-bold",children:["#",o.avgRank]})]})]})})]})]})}),v&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"MatiÃ¨re"}),e.jsxs("select",{value:j.subject,onChange:e=>f({...j,subject:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"Toutes les matiÃ¨res"}),e.jsx("option",{value:"mathematiques",children:"MathÃ©matiques"}),e.jsx("option",{value:"sciences",children:"Sciences"}),e.jsx("option",{value:"francais",children:"FranÃ§ais"}),e.jsx("option",{value:"anglais",children:"Anglais"}),e.jsx("option",{value:"histoire",children:"Histoire"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Niveau"}),e.jsxs("select",{value:j.grade_level,onChange:e=>f({...j,grade_level:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"Tous les niveaux"}),e.jsx("option",{value:"troisieme",children:"TroisiÃ¨me (BFEM)"}),e.jsx("option",{value:"terminale",children:"Terminale (BAC)"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>f({status:"all",subject:"all",grade_level:"all"}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300",children:"RÃ©initialiser"})})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>w("active"),className:"px-4 py-2 font-medium transition-colors "+("active"===k?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:["En cours (",n.filter(e=>"active"===e.status).length,")"]}),e.jsxs("button",{onClick:()=>w("upcoming"),className:"px-4 py-2 font-medium transition-colors "+("upcoming"===k?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:["Ã€ venir (",n.filter(e=>"upcoming"===e.status).length,")"]}),e.jsxs("button",{onClick:()=>w("completed"),className:"px-4 py-2 font-medium transition-colors "+("completed"===k?"text-purple-600 border-b-2 border-purple-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:["TerminÃ©es (",n.filter(e=>"completed"===e.status).length,")"]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[m&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:m})}),0===_.length?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-12 text-center",children:[e.jsx(d,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucune compÃ©tition"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Aucune compÃ©tition ne correspond Ã  vos filtres."})]}):_.map(r=>e.jsx(b,{competition:r,onClick:()=>l(`/competitions/${r.id}`)},r.id))]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(u,{})})]})})]})};export{y as default};
