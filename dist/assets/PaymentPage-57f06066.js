import{r as e,j as t}from"./vendor-react-470eca1f.js";import{H as a}from"./Helmet-2c7e73f6.js";import{s,u as r,C as n,c as i,a as l,b as o,f as d,B as c,F as m}from"./index-80385b81.js";import{I as x}from"./input-5c98a0d4.js";import{N as p}from"./Navbar-fef78110.js";import{u}from"./useSubscription-4e9a7354.js";import{c as h}from"./vendor-router-da2b77bd.js";import{m as g}from"./vendor-charts-0ffd78b1.js";import{D as b,aT as y,bH as j,x as f,aa as v,aK as N,r as w,ap as _,b3 as k,m as E}from"./vendor-ui-297a683c.js";import"./vendor-supabase-1d8f37f5.js";const M={orange_money:{name:"Orange Money",apiUrl:{}.VITE_ORANGE_MONEY_API_URL||"https://api.orange.com/orange-money-webpay/dev/v1",merchantKey:{}.VITE_ORANGE_MONEY_MERCHANT_KEY,enabled:!1},wave:{name:"Wave",apiUrl:{}.VITE_WAVE_API_URL||"https://api.wave.com/v1",apiKey:{}.VITE_WAVE_API_KEY,enabled:!1},free_money:{name:"Free Money",apiUrl:{}.VITE_FREE_MONEY_API_URL,apiKey:{}.VITE_FREE_MONEY_API_KEY,enabled:!1},mtn_money:{name:"MTN Money",apiUrl:{}.VITE_MTN_MONEY_API_URL||"https://sandbox.momodeveloper.mtn.com",apiKey:{}.VITE_MTN_MONEY_API_KEY,enabled:!1}};class P{static async initiatePayment(e,t,a=1e3,r){try{if(!M[e])throw new Error(`Provider de paiement non support√©: ${e}`);if(!M[e].enabled)return await this.simulatePayment(e,t,a,r);const n=`TXN_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,{data:i,error:l}=await s.from("payment_transactions").insert({user_id:r,amount:a,currency:"XOF",payment_method:e,status:"pending",provider_name:e,provider_transaction_id:n,phone_number:t}).select().single();if(l)throw l;let o;switch(e){case"orange_money":o=await this.processOrangeMoneyPayment(t,a,n);break;case"wave":o=await this.processWavePayment(t,a,n);break;case"free_money":o=await this.processFreeMoneyPayment(t,a,n);break;case"mtn_money":o=await this.processMTNMoneyPayment(t,a,n);break;default:throw new Error(`Provider non impl√©ment√©: ${e}`)}return{success:!0,transactionId:i.id,providerTransactionId:n,status:"pending",message:`Paiement initi√© avec ${M[e].name}. Veuillez compl√©ter la transaction sur votre t√©l√©phone.`,...o}}catch(n){throw n}}static async simulatePayment(e,t,a,r){const n=`DEMO_TXN_${Date.now()}_${Math.random().toString(36).substr(2,9)}_${Math.random().toString(36).substr(2,9)}_${performance.now().toString().replace(".","")}`,{data:i,error:l}=await s.from("payment_transactions").insert({user_id:r,amount:a,currency:"XOF",payment_method:e,status:"completed",provider_name:e,provider_transaction_id:n,phone_number:t,completed_at:(new Date).toISOString(),metadata:{demo:!0,note:"Paiement simul√© en mode d√©veloppement"}}).select().single();if(l)throw l;return await s.rpc("complete_payment",{p_user_id:r,p_transaction_id:n,p_payment_method:e,p_phone_number:t}),{success:!0,transactionId:i.id,providerTransactionId:n,status:"completed",demo:!0,message:"‚úÖ Paiement simul√© avec succ√®s ! (Mode d√©veloppement)"}}static async processOrangeMoneyPayment(e,t,a){throw new Error("Orange Money non configur√©. Veuillez activer le mode d√©mo ou configurer les cl√©s API.")}static async processWavePayment(e,t,a){throw new Error("Wave non configur√©. Veuillez activer le mode d√©mo ou configurer les cl√©s API.")}static async processFreeMoneyPayment(e,t,a){throw new Error("Free Money non configur√©. Veuillez activer le mode d√©mo ou configurer les cl√©s API.")}static async processMTNMoneyPayment(e,t,a){throw new Error("MTN Money non configur√©. Veuillez activer le mode d√©mo ou configurer les cl√©s API.")}static async checkTransactionStatus(e){try{const{data:t,error:a}=await s.from("payment_transactions").select("*").eq("id",e).single();if(a)throw a;return t}catch(t){throw t}}static getAvailableProviders(){return Object.entries(M).map(([e,t])=>({id:e,name:t.name,enabled:t.enabled,demo:!t.enabled}))}}const T=()=>{var M;const T=h(),{toast:A}=r();u();const[F,I]=e.useState(null),[C,V]=e.useState(""),[O,S]=e.useState(!1),[z,U]=e.useState(null),[$,R]=e.useState([]),[Y,K]=e.useState(!0),D=[{id:"orange_money",name:"Orange Money",icon:"üü†",gradient:"from-orange-500 to-red-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",borderColor:"border-orange-300 dark:border-orange-700"},{id:"wave",name:"Wave",icon:"üíô",gradient:"from-blue-500 to-cyan-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-300 dark:border-blue-700"},{id:"free_money",name:"Free Money",icon:"üíú",gradient:"from-purple-500 to-pink-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",borderColor:"border-purple-300 dark:border-purple-700"},{id:"mtn_money",name:"MTN Money",icon:"üíõ",gradient:"from-yellow-500 to-orange-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-300 dark:border-yellow-700"}],W=async()=>{try{K(!0);const{data:{user:e}}=await s.auth.getUser();if(!e)return;const{data:t,error:a}=await s.from("payment_transactions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(a)throw a;R(t||[])}catch(e){}finally{K(!1)}};e.useEffect(()=>{W()},[]);return t.jsxs(t.Fragment,{children:[t.jsxs(a,{children:[t.jsx("title",{children:"Paiement - Finaliser votre inscription | E-R√©ussite"}),t.jsx("meta",{name:"description",content:"Finalisez votre inscription avec un paiement unique de 1000 FCFA pour un acc√®s illimit√© √† vie."})]}),t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-green-50/30 to-slate-50 dark:from-slate-900 dark:via-green-900/10 dark:to-slate-900",children:[t.jsx(p,{}),t.jsx("section",{className:"pt-32 pb-20 px-4",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center mb-12",children:[t.jsx("h1",{className:"text-4xl md:text-5xl font-bold font-heading text-slate-900 dark:text-white mb-4",children:"Finalisez votre inscription"}),t.jsxs("p",{className:"text-xl text-slate-600 dark:text-slate-300",children:["Un seul paiement de ",t.jsx("span",{className:"font-bold text-green-600",children:"1000 FCFA"})," pour un acc√®s illimit√© √† vie"]})]}),t.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.2},className:"mb-8",children:t.jsx(n,{className:"border-2 border-green-300 dark:border-green-700 shadow-xl bg-gradient-to-br from-white to-green-50/30 dark:from-slate-800 dark:to-green-900/10",children:t.jsxs(i,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Acc√®s Illimit√© √† Vie"}),t.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"Tout le contenu d√©bloqu√© pour toujours"})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-4xl font-black text-green-600 dark:text-green-400",children:"1000"}),t.jsx("div",{className:"text-slate-600 dark:text-slate-300 font-semibold",children:"FCFA"})]})]}),t.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:["Tous les cours BFEM et BAC","Coach IA personnalis√© 24h/24","Quiz et examens illimit√©s","Suivi de progression","Badges et r√©compenses","Acc√®s mobile et desktop"].map((e,a)=>t.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700 dark:text-slate-300",children:[t.jsx(b,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),t.jsx("span",{children:e})]},a))})]})})}),t.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:t.jsxs(n,{className:"border-2 border-slate-200 dark:border-slate-700 shadow-xl",children:[t.jsxs(l,{children:[t.jsxs(o,{className:"flex items-center gap-2 text-2xl",children:[t.jsx(y,{className:"w-6 h-6 text-green-600"}),"Choisissez votre mode de paiement"]}),t.jsx(d,{children:"S√©lectionnez votre op√©rateur mobile money pr√©f√©r√©"})]}),t.jsx(i,{children:t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),U(null),F)if(!C||C.length<9)U("Veuillez entrer un num√©ro de t√©l√©phone valide");else try{S(!0);const{data:{user:e}}=await s.auth.getUser();if(!e)throw new Error("Utilisateur non connect√©");const t=await P.initiatePayment(F,C,1e3,e.id);t.demo?(A({title:"‚úÖ Paiement simul√© avec succ√®s !",description:"Mode d√©veloppement - Votre acc√®s illimit√© est activ√©.",duration:5e3}),await W(),setTimeout(()=>{T("/dashboard")},2e3)):(A({title:"üîÑ Paiement en cours",description:"Veuillez compl√©ter la transaction sur votre t√©l√©phone.",duration:5e3}),T(`/payment/status/${t.transactionId}`))}catch(t){U(t.message||"Une erreur est survenue lors du paiement"),A({title:"‚ùå Erreur de paiement",description:t.message,variant:"destructive"})}finally{S(!1)}else U("Veuillez s√©lectionner un mode de paiement")},className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3",children:"Op√©rateur Mobile Money *"}),t.jsx("div",{className:"grid grid-cols-2 gap-4",children:D.map(e=>t.jsx(g.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>I(e.id),className:"p-4 rounded-xl border-2 transition-all duration-200 "+(F===e.id?`${e.bgColor} ${e.borderColor} shadow-lg`:"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:border-slate-300"),children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-br ${e.gradient} flex items-center justify-center text-2xl shadow-lg`,children:e.icon}),t.jsx("span",{className:"font-semibold text-sm text-slate-900 dark:text-white",children:e.name}),F===e.id&&t.jsx(b,{className:"w-5 h-5 text-green-600"})]})},e.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Num√©ro de t√©l√©phone *"}),t.jsxs("div",{className:"relative",children:[t.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),t.jsx(x,{type:"tel",value:C,onChange:e=>V(e.target.value),placeholder:"77 123 45 67",required:!0,className:"pl-10 border-2",disabled:O})]}),t.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Entrez le num√©ro associ√© √† votre compte ",F?null==(M=D.find(e=>e.id===F))?void 0:M.name:"mobile money"]})]}),z&&t.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400",children:[t.jsx(f,{className:"h-4 w-4"}),t.jsx("p",{className:"text-sm",children:z})]}),t.jsx(c,{type:"submit",disabled:O||!F||!C,className:"w-full py-6 text-lg font-bold bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white shadow-xl hover:shadow-2xl transition-all duration-300",children:O?t.jsxs(t.Fragment,{children:[t.jsx(v,{className:"w-5 h-5 mr-2 animate-spin"}),"Traitement en cours..."]}):t.jsxs(t.Fragment,{children:[t.jsx(y,{className:"w-5 h-5 mr-2"}),"Payer 1000 FCFA",t.jsx(N,{className:"w-5 h-5 ml-2"})]})}),t.jsx("p",{className:"text-xs text-center text-slate-500 dark:text-slate-400",children:"Paiement s√©curis√© ‚Ä¢ Aucun frais cach√© ‚Ä¢ Acc√®s imm√©diat apr√®s confirmation"})]})})]})}),t.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.6},className:"mt-8 text-center text-sm text-slate-600 dark:text-slate-400",children:t.jsx("p",{children:"üîí Vos informations de paiement sont s√©curis√©es et ne sont jamais stock√©es sur nos serveurs."})})]})}),t.jsx("section",{className:"py-16 px-4 bg-slate-50 dark:bg-slate-900",children:t.jsx("div",{className:"max-w-4xl mx-auto",children:t.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:t.jsxs(n,{className:"border-2 border-slate-200 shadow-lg dark:bg-slate-800 dark:border-white/20",children:[t.jsxs(l,{className:"bg-gradient-to-r from-primary/10 to-accent/10 dark:from-primary/20 dark:to-accent/20 border-b border-slate-200 dark:border-slate-700",children:[t.jsxs(o,{className:"flex items-center gap-2 text-xl dark:text-white",children:[t.jsx(w,{className:"w-6 h-6 text-primary"}),"Historique des transactions",$.length>0&&t.jsx("span",{className:"ml-auto bg-primary text-white text-sm px-3 py-1 rounded-full font-bold",children:$.length})]}),t.jsx(d,{className:"dark:text-slate-300",children:"Consultez toutes vos transactions de paiement"})]}),t.jsx(i,{className:"p-6",children:Y?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(v,{className:"w-8 h-8 animate-spin text-primary"})}):$.length>0?t.jsx("ul",{className:"space-y-4",children:$.map((e,a)=>t.jsxs(g.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*a},className:"p-5 border-2 border-slate-200 dark:border-slate-700 rounded-xl hover:border-primary/50 hover:shadow-lg transition-all bg-white dark:bg-slate-800",children:[t.jsxs("div",{className:"flex justify-between items-start mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsxs("p",{className:"font-bold text-lg text-slate-900 dark:text-white",children:["Transaction #",e.provider_transaction_id.substring(0,20),"..."]}),t.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1 "+("completed"===e.status?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"pending"===e.status?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"failed"===e.status?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-300"),children:["completed"===e.status&&t.jsx(_,{className:"w-3 h-3"}),"failed"===e.status&&t.jsx(k,{className:"w-3 h-3"}),t.jsx("span",{className:"capitalize",children:"completed"===e.status?"Compl√©t√©e":"pending"===e.status?"En attente":"failed"===e.status?"√âchou√©e":e.status})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2 text-slate-600 dark:text-slate-400",children:[t.jsx(E,{className:"w-4 h-4"}),new Date(e.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-slate-600 dark:text-slate-400",children:[t.jsx(y,{className:"w-4 h-4"}),t.jsx("span",{className:"capitalize",children:e.provider_name.replace("_"," ")})]}),e.phone_number&&t.jsxs("div",{className:"flex items-center gap-2 text-slate-600 dark:text-slate-400",children:[t.jsx(j,{className:"w-4 h-4"}),e.phone_number]})]})]}),t.jsxs("div",{className:"text-right ml-4",children:[t.jsx("p",{className:"font-bold text-2xl text-primary dark:text-primary-light",children:e.amount.toLocaleString("fr-FR")}),t.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:e.currency||"XOF"})]})]}),e.error_message&&t.jsx("div",{className:"mt-3 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:t.jsxs("p",{className:"text-xs text-red-700 dark:text-red-400 flex items-center gap-2",children:[t.jsx(f,{className:"w-4 h-4"}),e.error_message]})})]},e.id))}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(w,{className:"w-16 h-16 text-slate-300 dark:text-slate-600 mx-auto mb-4"}),t.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-lg font-medium",children:"Aucune transaction pour le moment"}),t.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-sm mt-2",children:"Vos paiements appara√Ætront ici"})]})})]})})})}),t.jsx(m,{})]})]})};export{T as default};
