import{R as e,j as s,r as a}from"./vendor-react-470eca1f.js";import{d as t,e as i,u as r,s as l,C as n,a as c,b as d,c as o,B as m,f as x,A as h,n as u}from"./index-80385b81.js";import{H as g}from"./Helmet-2c7e73f6.js";import{B as j}from"./badge-3c6eba89.js";import{T as p,a as b,b as N,c as f}from"./tabs-04421a9d.js";import"./input-5c98a0d4.js";import{f as v}from"./analytics-0f16126e.js";import{c as y}from"./vendor-router-da2b77bd.js";import{m as w,A as _}from"./vendor-charts-0ffd78b1.js";import{U as k,a as z,t as P,bN as C,D as $,Y as S,A as R,ao as q,aQ as T,K as E,a3 as F,f as A}from"./vendor-ui-297a683c.js";import"./vendor-supabase-1d8f37f5.js";const D=e.forwardRef(({className:e,...a},i)=>s.jsx("textarea",{className:t("flex min-h-[80px] w-full rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...a}));D.displayName="Textarea";const V=()=>{const{user:e}=i(),t=y(),{toast:V}=r(),[M,B]=a.useState(!0),[L,H]=a.useState("feed"),[I,K]=a.useState(null),[Q,Y]=a.useState([]),[G,J]=a.useState([]),[U,W]=a.useState(""),[O,X]=a.useState(!1);a.useEffect(()=>{e&&(Z(),v("page_view",{page:"social",user_id:e.id}))},[e]);const Z=async()=>{B(!0);try{const{data:s}=await l.from("user_points").select("*").eq("user_id",e.id).single();K(s);const{data:a}=await l.from("user_badges").select("\n          id,\n          earned_at,\n          badge_id,\n          badges!inner (\n            badge_id,\n            name,\n            icon_name,\n            description\n          )\n        ").eq("user_id",e.id).order("earned_at",{ascending:!1}).limit(5),t=(null==a?void 0:a.map(e=>({badge_id:e.badge_id,badge_name:e.badges.name,earned_at:e.earned_at,icon_name:e.badges.icon_name})))||[];Y(t);J([{id:1,type:"achievement",user_name:"Amina Diallo",action:"a obtenu le badge",badge:"ðŸ† Expert Maths",time:"5 min",likes:12},{id:2,type:"quiz",user_name:"Moussa TraorÃ©",action:"a rÃ©ussi un quiz avec",score:"95%",subject:"Physique",time:"15 min",likes:8},{id:3,type:"streak",user_name:"Fatou Ndiaye",action:"a atteint un streak de",streak:"30 jours",time:"1h",likes:15},{id:4,type:"challenge",user_name:"Koffi Amoussou",action:"a complÃ©tÃ© le dÃ©fi",challenge:"ðŸ“š Semaine studieuse",time:"2h",likes:10}])}catch(s){}finally{B(!1)}},ee=()=>{if(!I)return;const s=`ðŸ“Š Mes stats sur E-RÃ©ussite:\nâœ… ${I.quizzes_completed} quiz complÃ©tÃ©s\nðŸ† ${I.total_points} points\nâ­ ${I.badges_count||0} badges\nRejoignez-moi !`,a=window.location.origin;v("share_stats",{user_id:e.id}),navigator.share?navigator.share({title:"Mes progrÃ¨s sur E-RÃ©ussite",text:s,url:a}):(navigator.clipboard.writeText(`${s}\n${a}`),V({title:"Stats copiÃ©es !",description:"Partagez vos progrÃ¨s sur les rÃ©seaux sociaux"}))},se=()=>{const s=`${window.location.origin}?ref=${e.id.substring(0,8)}`;navigator.clipboard.writeText(s),X(!0),setTimeout(()=>X(!1),2e3),V({title:"Lien de parrainage copiÃ© !",description:"Partagez ce lien pour inviter vos amis"}),v("generate_referral_link",{user_id:e.id})};return M?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Chargement..."})]})}):s.jsxs(s.Fragment,{children:[s.jsxs(g,{children:[s.jsx("title",{children:"Social & Partage - E-RÃ©ussite"}),s.jsx("meta",{name:"description",content:"Partagez vos rÃ©ussites et connectez-vous avec d'autres Ã©tudiants"})]}),s.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[s.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 mb-4",children:s.jsx(k,{className:"w-10 h-10 text-white"})}),s.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Social & Partage"}),s.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Partagez vos rÃ©ussites et connectez-vous avec la communautÃ©"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsxs(w.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"space-y-6",children:[s.jsxs(n,{children:[s.jsx(c,{children:s.jsxs(d,{className:"flex items-center gap-2",children:[s.jsx(z,{className:"h-5 w-5"}),"Vos RÃ©ussites"]})}),s.jsxs(o,{className:"space-y-4",children:[I&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Points totaux"}),s.jsxs(j,{variant:"default",className:"text-lg",children:["ðŸ† ",I.total_points]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Quiz complÃ©tÃ©s"}),s.jsxs("span",{className:"font-semibold",children:["âœ… ",I.quizzes_completed]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Badges gagnÃ©s"}),s.jsxs("span",{className:"font-semibold",children:["â­ ",Q.length]})]})]}),s.jsxs(m,{onClick:ee,className:"w-full mt-4",variant:"outline",children:[s.jsx(P,{className:"h-4 w-4 mr-2"}),"Partager mes stats"]})]})]}),s.jsxs(n,{className:"bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border-blue-200 dark:border-blue-800",children:[s.jsxs(c,{children:[s.jsxs(d,{className:"flex items-center gap-2 text-blue-900 dark:text-blue-100",children:[s.jsx(C,{className:"h-5 w-5"}),"Inviter des amis"]}),s.jsx(x,{className:"text-blue-800 dark:text-blue-200",children:"Gagnez 50 points par ami invitÃ©"})]}),s.jsx(o,{children:s.jsx(m,{onClick:se,className:"w-full bg-blue-600 hover:bg-blue-700",children:O?s.jsxs(s.Fragment,{children:[s.jsx($,{className:"h-4 w-4 mr-2"}),"Lien copiÃ© !"]}):s.jsxs(s.Fragment,{children:[s.jsx(S,{className:"h-4 w-4 mr-2"}),"Copier le lien"]})})})]}),s.jsxs(n,{children:[s.jsx(c,{children:s.jsxs(d,{className:"flex items-center gap-2",children:[s.jsx(R,{className:"h-5 w-5"}),"Derniers Badges"]})}),s.jsx(o,{className:"space-y-3",children:0===Q.length?s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center py-4",children:"Pas encore de badges"}):Q.map((a,t)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:shadow-md transition-shadow",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"text-2xl",children:"ðŸ†"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-sm",children:a.badge_name}),s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:new Date(a.earned_at).toLocaleDateString("fr-FR")})]})]}),s.jsx(m,{size:"sm",variant:"ghost",onClick:()=>(s=>{const a=`ðŸŽ‰ J'ai obtenu le badge "${s.badge_name}" sur E-RÃ©ussite !`,t=`${window.location.origin}/profile/${e.id}`;v("share_achievement",{user_id:e.id,badge_name:s.badge_name}),navigator.share?navigator.share({title:"Mon succÃ¨s sur E-RÃ©ussite",text:a,url:t}).catch(e=>{}):(navigator.clipboard.writeText(`${a}\n${t}`),X(!0),setTimeout(()=>X(!1),2e3),V({title:"Lien copiÃ© !",description:"Partagez votre rÃ©ussite avec vos amis"}))})(a),children:s.jsx(P,{className:"h-4 w-4"})})]},`${a.badge_name}-${t}`))})]})]}),s.jsx(w.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},className:"lg:col-span-2",children:s.jsxs(p,{value:L,onValueChange:H,className:"space-y-6",children:[s.jsxs(b,{className:"grid w-full grid-cols-2",children:[s.jsxs(N,{value:"feed",children:[s.jsx(q,{className:"h-4 w-4 mr-2"}),"Fil d'actualitÃ©"]}),s.jsxs(N,{value:"share",children:[s.jsx(P,{className:"h-4 w-4 mr-2"}),"Partager"]})]}),s.jsxs(f,{value:"feed",className:"space-y-4",children:[s.jsx(n,{children:s.jsxs(c,{children:[s.jsx(d,{children:"ActivitÃ©s rÃ©centes"}),s.jsx(x,{children:"DÃ©couvrez ce que font les autres Ã©tudiants"})]})}),s.jsx(_,{children:G.map(a=>s.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:s.jsx(n,{className:"hover:shadow-lg transition-shadow",children:s.jsx(o,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx(h,{children:s.jsx(u,{children:a.user_name.split(" ").map(e=>e[0]).join("")})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("span",{className:"font-semibold",children:a.user_name}),s.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["â€¢ ",a.time]})]}),s.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:[a.action," ",s.jsx("span",{className:"font-semibold text-primary",children:a.badge||a.score||a.streak||a.challenge}),a.subject&&` en ${a.subject}`]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(m,{size:"sm",variant:"ghost",onClick:()=>{return s=a.id,v("like_post",{user_id:e.id,post_id:s}),J(e=>e.map(e=>e.id===s?{...e,likes:e.likes+1,liked:!0}:e)),void V({title:"â¤ï¸ Vous aimez Ã§a !",description:"Votre like a Ã©tÃ© enregistrÃ©"});var s},className:a.liked?"text-red-500":"",children:[s.jsx(T,{className:"h-4 w-4 mr-1 "+(a.liked?"fill-current":"")}),a.likes]}),s.jsxs(m,{size:"sm",variant:"ghost",children:[s.jsx(E,{className:"h-4 w-4 mr-1"}),"Commenter"]})]})]})]})})})},a.id))})]}),s.jsxs(f,{value:"share",className:"space-y-6",children:[s.jsxs(n,{children:[s.jsxs(c,{children:[s.jsx(d,{children:"Partager une rÃ©ussite"}),s.jsx(x,{children:"CÃ©lÃ©brez vos accomplissements avec la communautÃ©"})]}),s.jsxs(o,{className:"space-y-4",children:[s.jsx(D,{placeholder:"Parlez de votre derniÃ¨re rÃ©ussite...",value:U,onChange:e=>W(e.target.value),rows:4}),s.jsxs(m,{className:"w-full",disabled:!U.trim(),children:[s.jsx(F,{className:"h-4 w-4 mr-2"}),"Publier"]})]})]}),s.jsxs(n,{children:[s.jsx(c,{children:s.jsx(d,{children:"Partages rapides"})}),s.jsxs(o,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs(m,{variant:"outline",className:"h-auto py-4 flex-col gap-2",onClick:ee,children:[s.jsx(A,{className:"h-8 w-8 text-yellow-500"}),s.jsx("span",{children:"Partager mes stats"})]}),s.jsxs(m,{variant:"outline",className:"h-auto py-4 flex-col gap-2",onClick:se,children:[s.jsx(C,{className:"h-8 w-8 text-blue-500"}),s.jsx("span",{children:"Inviter des amis"})]}),s.jsxs(m,{variant:"outline",className:"h-auto py-4 flex-col gap-2",onClick:()=>t("/badges"),children:[s.jsx(R,{className:"h-8 w-8 text-purple-500"}),s.jsx("span",{children:"Voir mes badges"})]}),s.jsxs(m,{variant:"outline",className:"h-auto py-4 flex-col gap-2",onClick:()=>t("/leaderboard"),children:[s.jsx(q,{className:"h-8 w-8 text-green-500"}),s.jsx("span",{children:"Classement"})]})]})]})]})]})})]})]})]})};export{V as default};
