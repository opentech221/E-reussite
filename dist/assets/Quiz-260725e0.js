import{_ as e}from"./vendor-supabase-1d8f37f5.js";import{r as t,j as s}from"./vendor-react-470eca1f.js";import{H as r}from"./Helmet-2c7e73f6.js";import{u as a,e as i,C as l,c as n,B as o,a as c,b as d}from"./index-80385b81.js";import{B as x}from"./badge-3c6eba89.js";import{d as m,c as u}from"./vendor-router-da2b77bd.js";import{aa as h,b3 as p,A as f,aI as j,J as g}from"./vendor-ui-297a683c.js";import{m as b}from"./vendor-charts-0ffd78b1.js";const v=()=>{const{quizId:v}=m(),N=u(),{toast:y}=a(),{user:w,completeQuiz:k}=i(),[_,C]=t.useState(null),[S,q]=t.useState([]),[z,O]=t.useState(0),[E,A]=t.useState({}),[I,Q]=t.useState(!1),[L,R]=t.useState(0),[$,B]=t.useState(!0),[D,H]=t.useState(900),[M,T]=t.useState(!0),[V]=t.useState(Date.now());t.useEffect(()=>{v&&(async()=>{try{B(!0);const{default:t}=await e(()=>import("./index-80385b81.js").then(e=>e.O),["assets/index-80385b81.js","assets/vendor-supabase-1d8f37f5.js","assets/vendor-react-470eca1f.js","assets/vendor-ui-297a683c.js","assets/vendor-router-da2b77bd.js","assets/vendor-charts-0ffd78b1.js","assets/index-10a14d87.css"]),{data:s,error:r}=await t.quiz.getQuiz(parseInt(v));if(r||!s)return y({title:"Erreur",description:"Quiz introuvable",variant:"destructive"}),void N("/my-courses");C(s);let a=[];if(!(s.quiz_questions&&s.quiz_questions.length>0))return y({title:"Erreur",description:"Ce quiz ne contient pas de questions",variant:"destructive"}),void N("/my-courses");if(a=s.quiz_questions.map(e=>{let t;if(Array.isArray(e.options))t=e.options;else if("string"==typeof e.options)try{t=JSON.parse(e.options)}catch(s){t=e.options.split(",").map(e=>e.trim())}else t="object"==typeof e.options&&null!==e.options?Object.values(e.options):[];return{id:e.id,text:e.question,options:t,correctOption:e.correct_option,explanation:e.explanation||"Bonne r√©ponse !"}}),q(a),s.duration_minutes)H(60*s.duration_minutes);else if(a.length>0){const e=(s.difficulty||"Moyen").toLowerCase(),t=a.length;H(({facile:45,easy:45,moyen:60,medium:60,difficile:90,hard:90}[e]||60)*t)}B(!1)}catch(t){y({title:"Erreur",description:"Impossible de charger le quiz",variant:"destructive"}),B(!1)}})()},[v,N,y]),t.useEffect(()=>{if(!M||I)return;const e=setInterval(()=>{H(e=>e<=0?(T(!1),P(!0),0):e-1)},1e3);return()=>clearInterval(e)},[M,I]);const F=e=>String.fromCharCode("A".charCodeAt(0)+e),P=async(e=!1)=>{var t;T(!1);let s=0;const r=[];S.forEach((e,t)=>{const a=E[e.id],i=void 0!==a?F(a):null,l=i===e.correctOption;l&&s++,r.push({question_id:e.id,question_text:e.text,user_answer:i,correct_answer:e.correctOption,is_correct:l,topic:e.topic||e.subject||(null==_?void 0:_.title)||"G√©n√©ral",difficulty:e.difficulty||"moyen"})});const a=s/S.length*100;R(a),Q(!0);try{const l=Math.floor((Date.now()-V)/1e3);k&&await k(parseInt(v),s,r,l);const n=r.filter(e=>!e.is_correct);if(n.length>0&&(null==(t=dbHelpers.progress)?void 0:t.trackError))try{for(const e of n)await dbHelpers.progress.trackError(w.id,e.question_id,e.user_answer)}catch(i){}y({title:e?"Temps √©coul√© !":"Quiz termin√© !",description:`Votre score : ${a.toFixed(0)}%`,variant:a>=75?"default":"destructive"})}catch(l){y({title:"Erreur",description:"Score calcul√© mais non sauvegard√©",variant:"destructive"})}};if($)return s.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-50",children:s.jsxs("div",{className:"text-center",children:[s.jsx(h,{className:"w-12 h-12 animate-spin mx-auto text-primary"}),s.jsx("p",{className:"mt-4 text-slate-600 dark:text-slate-300",children:"Chargement du quiz..."})]})});if(!_||0===S.length)return s.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-50 dark:bg-slate-950",children:s.jsx(l,{className:"max-w-md dark:bg-slate-800 dark:border-white/20 border-2 shadow-lg dark:shadow-[0_0_30px_rgba(255,255,255,0.4)]",children:s.jsxs(n,{className:"pt-6 text-center",children:[s.jsx(p,{className:"w-16 h-16 mx-auto text-red-500 mb-4"}),s.jsx("p",{className:"text-lg font-semibold dark:text-white",children:"Quiz introuvable"}),s.jsx(o,{onClick:()=>N("/my-courses"),className:"mt-4",children:"Retour aux cours"})]})})});const J=S[z];if(I){const e=S.filter(e=>{const t=E[e.id];return(void 0!==t?F(t):null)===e.correctOption}).length/S.length*100;return s.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 flex items-center justify-center p-4",children:s.jsx(b.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},children:s.jsxs(l,{className:"w-full max-w-2xl text-center dark:bg-slate-800 dark:border-white/30 border-2 shadow-xl dark:shadow-[0_0_40px_rgba(255,255,255,0.5)]",children:[s.jsxs(c,{children:[s.jsx(d,{className:"text-3xl dark:text-white",children:"R√©sultats du Quiz"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-2",children:_.title})]}),s.jsxs(n,{children:[s.jsxs("div",{className:"mb-6",children:[s.jsx(f,{className:"w-24 h-24 mx-auto "+(e>=75?"text-yellow-500":e>=50?"text-orange-500":"text-slate-400")}),s.jsxs("p",{className:"text-5xl font-bold mt-4",children:[e.toFixed(0),"%"]}),s.jsx("p",{className:"text-slate-500",children:e>=90?"Excellent !":e>=75?"Tr√®s bien !":e>=50?"Pas mal":"Il faut r√©viser"}),s.jsxs("p",{className:"text-sm text-slate-400 mt-2",children:[S.filter(e=>{const t=E[e.id];return(void 0!==t?F(t):null)===e.correctOption}).length," / ",S.length," bonnes r√©ponses"]})]}),s.jsx("div",{className:"space-y-4 text-left max-h-96 overflow-y-auto",children:S.map((e,t)=>{const r=E[e.id],a=void 0!==r?F(r):null,i=a===e.correctOption,l=e.correctOption.charCodeAt(0)-"A".charCodeAt(0);return s.jsx("div",{className:"p-4 rounded-lg border-2 "+(i?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:s.jsxs("div",{className:"flex items-start gap-2",children:[i?s.jsx(j,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}):s.jsx(p,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"font-semibold text-slate-800 dark:text-slate-100 mb-2",children:["Question ",t+1,": ",e.text]}),s.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-200",children:[s.jsx("span",{className:"font-medium",children:"Votre r√©ponse:"})," ",a?`${a}) ${e.options[r]}`:"Non r√©pondue"]}),!i&&s.jsxs("p",{className:"text-sm text-green-700 font-bold mt-1",children:[s.jsx("span",{className:"font-medium",children:"Bonne r√©ponse:"})," ",e.correctOption,") ",e.options[l]]}),e.explanation&&s.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-2 p-2 bg-white/50 rounded-md border border-slate-200",children:["üí° ",e.explanation]})]})]})},e.id)})}),s.jsxs("div",{className:"flex gap-3 mt-8",children:[s.jsx(o,{onClick:()=>N("/dashboard"),variant:"outline",className:"flex-1",children:"Voir Dashboard"}),s.jsx(o,{onClick:()=>N("/my-courses"),className:"flex-1",children:"Retour aux cours"})]})]})]})})})}return s.jsxs(s.Fragment,{children:[s.jsx(r,{children:s.jsxs("title",{children:[_.title," - E-R√©ussite"]})}),s.jsx("div",{className:"min-h-screen bg-slate-100 dark:bg-slate-950 p-4 sm:p-8",children:s.jsx("div",{className:"max-w-4xl mx-auto",children:s.jsxs(l,{className:"dark:bg-slate-800 dark:border-white/20 border-2 shadow-lg dark:shadow-[0_0_30px_rgba(255,255,255,0.4)]",children:[s.jsxs(c,{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(d,{className:"text-2xl dark:text-white",children:_.title}),_.difficulty&&s.jsx(x,{className:"facile"===_.difficulty.toLowerCase()||"easy"===_.difficulty.toLowerCase()?"bg-green-100 text-green-800":"difficile"===_.difficulty.toLowerCase()||"hard"===_.difficulty.toLowerCase()?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:_.difficulty})]}),s.jsxs("div",{className:"flex justify-between items-center text-slate-500 text-sm mt-2",children:[s.jsxs("span",{className:"font-medium",children:["Question ",z+1,"/",S.length]}),s.jsxs("div",{className:"flex items-center gap-2 font-mono "+(D<60?"text-red-600 font-bold":""),children:[s.jsx(g,{size:16,className:D<60?"animate-pulse":""}),s.jsx("span",{children:(e=>{const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`})(D)})]})]}),s.jsx("div",{className:"mt-3 bg-slate-200 rounded-full h-2",children:s.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:(z+1)/S.length*100+"%"}})})]}),s.jsxs(n,{children:[s.jsxs(b.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{duration:.3},children:[s.jsx("p",{className:"text-lg font-semibold mb-6 text-slate-800 dark:text-slate-100",children:J.text}),s.jsx("div",{className:"space-y-3",children:J.options.map((e,t)=>{const r=F(t),a=E[J.id]===t;return s.jsxs("button",{onClick:()=>{return e=J.id,s=t,void A({...E,[e]:s});var e,s},className:"w-full text-left p-4 rounded-lg border-2 transition-all hover:scale-[1.02] "+(a?"border-primary bg-primary/10 shadow-md":"border-slate-200 hover:border-primary/50 hover:bg-slate-50"),children:[s.jsxs("span",{className:"font-bold text-primary mr-3",children:[r,")"]}),e]},t)})}),s.jsx("div",{className:"mt-4 text-sm text-slate-500",children:void 0!==E[J.id]?s.jsxs("p",{className:"flex items-center gap-2",children:[s.jsx(j,{className:"w-4 h-4 text-green-600"}),"R√©ponse s√©lectionn√©e"]}):s.jsxs("p",{className:"flex items-center gap-2 text-orange-600",children:[s.jsx(g,{className:"w-4 h-4"}),"S√©lectionnez une r√©ponse"]})})]},J.id),s.jsxs("div",{className:"flex justify-between mt-8 gap-3",children:[s.jsx(o,{variant:"outline",onClick:()=>O(e=>Math.max(0,e-1)),disabled:0===z,className:"flex-1",children:"‚Üê Pr√©c√©dent"}),z<S.length-1?s.jsx(o,{onClick:()=>O(e=>e+1),className:"flex-1",children:"Suivant ‚Üí"}):s.jsxs(o,{onClick:()=>P(!1),className:"bg-green-600 hover:bg-green-700 flex-1",disabled:Object.keys(E).length<S.length,children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"Terminer le quiz"]})]}),s.jsxs("div",{className:"mt-4 text-center text-sm text-slate-500",children:[Object.keys(E).length," / ",S.length," questions r√©pondues"]})]})]})})})]})};export{v as default};
