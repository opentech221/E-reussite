import{r as e,j as t}from"./vendor-react-470eca1f.js";import{u as r}from"./useCompetitions-2d7d8ef5.js";import{X as a,t as s,D as n,bK as i,a7 as o,a2 as l,T as d,F as c,L as m,bT as x,b3 as g,f as h,g as p,J as u,aI as b,C as f}from"./vendor-ui-297a683c.js";import{d as w,c as j}from"./vendor-router-da2b77bd.js";import"./index-80385b81.js";import"./vendor-supabase-1d8f37f5.js";import"./vendor-charts-0ffd78b1.js";const k=new class{constructor(){this.appUrl={}.VITE_APP_URL||window.location.origin}generateShareText(e){const{rank:t,score:r,competitionTitle:a,totalParticipants:s,badges:n}=e;let i=`${1===t?"ü•á":2===t?"ü•à":3===t?"ü•â":"üèÜ"} J'ai termin√© ${t}${1===t?"er":"e"}`;return s&&(i+=` sur ${s}`),i+=` au "${a}" avec un score de ${r} points ! üéØ\n\n`,n&&n.length>0&&(i+=`üèÜ Badges obtenus : ${n.map(e=>e.name).join(", ")}\n\n`),i+="Rejoins-moi sur E-R√©ussite pour t'am√©liorer ! üìö",i}shareOnWhatsApp(e,t){const r=`https://wa.me/?text=${encodeURIComponent(`${e}\n\n${t}`)}`;window.open(r,"_blank")}shareOnTwitter(e,t){const r=`https://twitter.com/intent/tweet?text=${encodeURIComponent(e)}&url=${encodeURIComponent(t)}&hashtags=EReussite,Education,BFEM,BAC`;window.open(r,"_blank","width=550,height=420")}shareOnFacebook(e,t){const r=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(e)}&quote=${encodeURIComponent(t)}`;window.open(r,"_blank","width=550,height=420")}shareOnLinkedIn(e,t){const r=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(e)}`;window.open(r,"_blank","width=550,height=420")}async generateShareImage(e){return new Promise(t=>{const r=document.createElement("canvas"),a=r.getContext("2d");r.width=1200,r.height=630;const s=a.createLinearGradient(0,0,r.width,r.height);s.addColorStop(0,"#6366f1"),s.addColorStop(.5,"#8b5cf6"),s.addColorStop(1,"#ec4899"),a.fillStyle=s,a.fillRect(0,0,r.width,r.height),a.globalAlpha=.1,a.fillStyle="#ffffff",a.beginPath(),a.arc(100,100,150,0,2*Math.PI),a.fill(),a.beginPath(),a.arc(r.width-100,r.height-100,200,0,2*Math.PI),a.fill(),a.globalAlpha=1,a.fillStyle="#ffffff",a.font="bold 52px Arial, sans-serif",a.textAlign="center",a.fillText("E-R√©ussite üéì",r.width/2,100);const n=1===e.rank?"ü•á":2===e.rank?"ü•à":3===e.rank?"ü•â":"üèÜ";a.font="120px Arial, sans-serif",a.fillText(n,r.width/2,250),a.font="bold 64px Arial, sans-serif",a.fillText(`Rang #${e.rank}`,r.width/2,340),a.font="bold 56px Arial, sans-serif",a.fillText(`${e.score} points`,r.width/2,415),a.font="32px Arial, sans-serif",a.fillStyle="#e0e7ff";const i=r.width-100,o=e.competitionTitle||"Comp√©tition";a.fillText(this.truncateText(a,o,i),r.width/2,475),e.badges&&e.badges.length>0&&(a.font="bold 24px Arial, sans-serif",a.fillStyle="#fef3c7",a.fillText(`üèÜ ${e.badges.length} badge${e.badges.length>1?"s":""} obtenu${e.badges.length>1?"s":""}`,r.width/2,525)),a.font="bold 28px Arial, sans-serif",a.fillStyle="#ffffff",a.fillText("Rejoins-moi sur E-R√©ussite !",r.width/2,585),t(r.toDataURL("image/png"))})}truncateText(e,t,r){if(e.measureText(t).width<=r)return t;let a=t;for(;e.measureText(a+"...").width>r&&a.length>0;)a=a.slice(0,-1);return a+"..."}generateInviteLink(e,t){return`${`${this.appUrl}/competitions/${t}`}?ref=${btoa(`${e}-${Date.now()}`)}`}async shareInvite(e,t,r){const a=this.generateInviteLink(e,t),s=`üéØ Rejoins-moi pour le "${r}" sur E-R√©ussite !\n\nMets tes connaissances √† l'√©preuve et grimpe au classement ! üèÜ\n\n${a}`;if(navigator.share)try{await navigator.share({title:`Invitation: ${r}`,text:s,url:a})}catch(n){n.name}else await navigator.clipboard.writeText(s)}};function y({result:r,isOpen:x,onClose:g,competitionTitle:h,score:p,rank:u,totalParticipants:b,badges:f=[]}){const[w,j]=e.useState(!1),[y,v]=e.useState(!1);if(!x)return null;const N=r||{competitionTitle:h,score:p,rank:u,totalParticipants:b,badges:f},C=async e=>{var t;try{const r=k.generateShareText(N),a=window.location.origin+"/competitions";switch(e){case"whatsapp":k.shareOnWhatsApp(r,a);break;case"twitter":k.shareOnTwitter(r,a);break;case"facebook":k.shareOnFacebook(a,r);break;case"linkedin":k.shareOnLinkedIn(a,r);break;case"copy":await navigator.clipboard.writeText(r+"\n\n"+a),j(!0),setTimeout(()=>j(!1),2e3);break;case"native":navigator.share&&await navigator.share({title:N.competitionTitle,text:r,url:a});break;case"download":v(!0);const e=await k.generateShareImage(N),s=document.createElement("a");s.href=e,s.download=`E-Reussite-${null==(t=N.competitionTitle)?void 0:t.replace(/\s/g,"-")}.png`,s.click(),v(!1)}}catch(r){v(!1)}},$=[{id:"whatsapp",name:"WhatsApp",icon:l,color:"bg-green-500 hover:bg-green-600",textColor:"text-green-600"},{id:"twitter",name:"Twitter",icon:d,color:"bg-sky-500 hover:bg-sky-600",textColor:"text-sky-600"},{id:"facebook",name:"Facebook",icon:c,color:"bg-blue-600 hover:bg-blue-700",textColor:"text-blue-600"},{id:"linkedin",name:"LinkedIn",icon:m,color:"bg-blue-700 hover:bg-blue-800",textColor:"text-blue-700"}],T=1===N.rank?"ü•á":2===N.rank?"ü•à":3===N.rank?"ü•â":"üèÜ";return t.jsx(t.Fragment,{children:t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:g,children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"relative bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-white",children:[t.jsx("button",{onClick:g,className:"absolute top-4 right-4 text-white/80 hover:text-white transition",children:t.jsx(a,{className:"w-6 h-6"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-6xl mb-3",children:T}),t.jsx("h2",{className:"text-2xl font-bold mb-1",children:"F√©licitations !"}),t.jsxs("p",{className:"text-white/90",children:["Rang #",N.rank," ‚Ä¢ ",N.score," points"]}),N.badges&&N.badges.length>0&&t.jsx("div",{className:"mt-3 flex flex-wrap justify-center gap-2",children:N.badges.map((e,r)=>t.jsxs("div",{className:"inline-flex items-center gap-1 bg-white/20 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium",children:["üèÜ ",e.name]},r))})]})]}),t.jsxs("div",{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Partage ton r√©sultat ! üéâ"}),t.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:$.map(e=>t.jsxs("button",{onClick:()=>C(e.id),className:`${e.color} text-white rounded-xl p-4 flex flex-col items-center gap-2 transition transform hover:scale-105`,children:[t.jsx(e.icon,{className:"w-6 h-6"}),t.jsx("span",{className:"text-sm font-medium",children:e.name})]},e.id))}),t.jsxs("div",{className:"space-y-2",children:[navigator.share&&t.jsxs("button",{onClick:()=>C("native"),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:[t.jsx(s,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium",children:"Partager"})]}),t.jsx("button",{onClick:()=>C("copy"),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition",children:w?t.jsxs(t.Fragment,{children:[t.jsx(n,{className:"w-5 h-5 text-green-500"}),t.jsx("span",{className:"font-medium text-green-500",children:"Lien copi√© !"})]}):t.jsxs(t.Fragment,{children:[t.jsx(i,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium",children:"Copier le lien"})]})}),t.jsxs("button",{onClick:()=>C("download"),disabled:y,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-xl hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition disabled:opacity-50",children:[t.jsx(o,{className:"w-5 h-5 "+(y?"animate-bounce":"")}),t.jsx("span",{className:"font-medium",children:y?"T√©l√©chargement...":"T√©l√©charger l'image"})]})]}),t.jsx("div",{className:"mt-6 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-xl",children:t.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 text-center",children:["üí° ",t.jsx("strong",{children:"Invite tes amis"})," √† rejoindre E-R√©ussite et progressez ensemble !"]})})]})]})})})}const v=()=>{var a;const{competitionId:n}=w(),i=j(),{currentCompetition:o,participant:l,questions:d,loading:c,error:m,joinCompetition:k,loadQuestions:v,submitAnswer:N,completeCompetition:C,isRegistered:$}=r(n),[T,S]=e.useState(0),[_,I]=e.useState(null),[R,A]=e.useState(Date.now()),[E,P]=e.useState(0),[q,D]=e.useState(!1),[F,O]=e.useState(null),[L,U]=e.useState(!1),[M,B]=e.useState(!1),[V,W]=e.useState(null),[z,J]=e.useState(!1);e.useEffect(()=>{n&&v(n)},[n,v]);const Q=(null==d?void 0:d.map(e=>({...e,question:{...e.question,answers:[e.question.option_a,e.question.option_b,e.question.option_c,e.question.option_d].filter(Boolean),correct_answer:["A","B","C","D"].indexOf(e.question.correct_option)}})))||[];e.useEffect(()=>{(async()=>{if(o&&!$&&"completed"!==o.status){(await k(n)).success}})()},[o,$,n,k]),e.useEffect(()=>{if(!o||!l)return;const e=()=>{if(o.duration_minutes){const e=l.started_at?new Date(l.started_at):new Date,t=new Date(e.getTime()+6e4*o.duration_minutes),r=Math.max(0,Math.floor((t-Date.now())/1e3));P(r),0!==r||M||G()}};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[o,l,M]);const G=e.useCallback(async()=>{if(M)return;B(!0);const e=await C();e.success&&W(e.data)},[C,M]);if(c&&!o)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx(x,{className:"w-12 h-12 text-purple-600 animate-spin mx-auto"}),t.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Chargement..."})]})});if(m)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 max-w-md",children:[t.jsx(g,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-bold text-red-900 dark:text-red-200 mb-2 text-center",children:"Erreur"}),t.jsx("p",{className:"text-red-700 dark:text-red-300 text-center",children:m})]})});if(M&&V)return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center p-4",children:[t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 p-8 max-w-2xl w-full",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce",children:t.jsx(h,{className:"w-12 h-12 text-white"})}),t.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Comp√©tition Termin√©e ! üéâ"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:null==o?void 0:o.title}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[t.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white",children:[t.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Votre classement"}),t.jsxs("p",{className:"text-4xl font-bold",children:["#",V.rank]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white",children:[t.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Score final"}),t.jsx("p",{className:"text-4xl font-bold",children:V.score})]}),t.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white",children:[t.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Points gagn√©s"}),t.jsxs("p",{className:"text-4xl font-bold",children:["+",V.reward_points]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-6 text-white",children:[t.jsx("p",{className:"text-sm opacity-90 mb-1",children:"XP gagn√©"}),t.jsxs("p",{className:"text-4xl font-bold",children:["+",V.reward_xp]})]})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("button",{onClick:()=>J(!0),className:"flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all flex items-center justify-center gap-2",children:[t.jsx(s,{className:"w-5 h-5"}),"Partager mes r√©sultats"]}),t.jsx("button",{onClick:()=>i("/competitions"),className:"flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors",children:"Voir le classement"})]}),t.jsx("button",{onClick:()=>i("/competitions"),className:"w-full px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300",children:"Autres comp√©titions"})]})}),z&&V&&t.jsx(y,{isOpen:z,onClose:()=>J(!1),competitionTitle:(null==o?void 0:o.title)||"Comp√©tition",score:V.score,rank:V.rank,totalParticipants:(null==o?void 0:o.current_participants)||0,badges:V.badges})]});const K=Q[T];if(!K)return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center",children:t.jsx(x,{className:"w-12 h-12 text-purple-600 animate-spin"})});const X=(T+1)/d.length*100;return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-4",children:t.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-purple-600 dark:text-purple-400",children:[t.jsx(p,{className:"w-5 h-5"}),t.jsxs("span",{className:"font-semibold",children:["Question ",T+1," / ",d.length]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-blue-600 dark:text-blue-400",children:[t.jsx(h,{className:"w-5 h-5"}),t.jsxs("span",{className:"font-semibold",children:["Score: ",(null==l?void 0:l.score)||0]})]})]}),t.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg font-bold text-lg "+(E<60?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 animate-pulse":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"),children:[t.jsx(u,{className:"w-5 h-5"}),(H=E,`${Math.floor(H/60)}:${(H%60).toString().padStart(2,"0")}`)]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full transition-all duration-500",style:{width:`${X}%`}})})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-8",children:K.question.question_text}),t.jsx("div",{className:"space-y-3",children:null==(a=K.question.answers)?void 0:a.map((e,r)=>{const a=_===r,s=q&&r===K.question.correct_answer,n=q&&a&&!s;return t.jsx("button",{onClick:()=>!q&&I(r),disabled:q||L,className:`w-full p-4 rounded-lg border-2 text-left transition-all ${q?s?"border-green-500 bg-green-50 dark:bg-green-900/20":n?"border-red-500 bg-red-50 dark:bg-red-900/20":"border-gray-200 dark:border-gray-700":a?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-600"} ${q||L?"cursor-not-allowed":"cursor-pointer"}`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:e}),q&&s&&t.jsx(b,{className:"w-5 h-5 text-green-600"}),q&&n&&t.jsx(g,{className:"w-5 h-5 text-red-600"})]})},r)})}),q&&F&&t.jsxs("div",{className:"mt-6 p-4 rounded-lg "+(F.is_correct?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"),children:[t.jsx("p",{className:"font-semibold "+(F.is_correct?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:F.is_correct?"‚úÖ Bonne r√©ponse !":"‚ùå Mauvaise r√©ponse"}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["+",F.points_earned," points"]})]}),!q&&t.jsx("button",{onClick:async()=>{if(null===_||L)return;U(!0);const e=Q[T],t=Math.floor((Date.now()-R)/1e3),r=await N(e.id,_,t);r.success?(O(r.data),D(!0),setTimeout(()=>{T<d.length-1?(S(e=>e+1),I(null),A(Date.now()),D(!1),O(null)):G(),U(!1)},2e3)):U(!1)},disabled:null===_||L,className:"w-full mt-6 px-6 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg font-bold text-lg disabled:opacity-50 disabled:cursor-not-allowed hover:from-purple-700 hover:to-blue-700 transition-all flex items-center justify-center gap-2",children:L?t.jsxs(t.Fragment,{children:[t.jsx(x,{className:"w-5 h-5 animate-spin"}),"Envoi en cours..."]}):t.jsxs(t.Fragment,{children:["Valider",t.jsx(f,{className:"w-5 h-5"})]})})]})]})});var H};export{v as default};
