import{r as e,j as s}from"./vendor-react-470eca1f.js";import{e as t,s as a,C as l,c as i,a as r,b as n,B as c}from"./index-80385b81.js";import{I as d}from"./input-5c98a0d4.js";import{B as o}from"./badge-3c6eba89.js";import"./tabs-04421a9d.js";import{c as m,ao as x,d as u,bO as h,bD as j,z as f,m as v,ap as p,J as N,b3 as g}from"./vendor-ui-297a683c.js";import{A as y,m as b}from"./vendor-charts-0ffd78b1.js";import"./vendor-supabase-1d8f37f5.js";import"./vendor-router-da2b77bd.js";function w(){const{user:w}=t(),[z,S]=e.useState([]),[q,_]=e.useState([]),[C,R]=e.useState(!0),[$,k]=e.useState(""),[O,A]=e.useState("all"),[I,J]=e.useState("all"),[M,D]=e.useState(new Set),[F,L]=e.useState({}),[Q,T]=e.useState({total:0,favorites:0,notes:0,averageScore:0});e.useEffect(()=>{(null==w?void 0:w.id)&&(B(),E(),V())},[null==w?void 0:w.id]),e.useEffect(()=>{G()},[z,$,O,I]);const B=async()=>{try{R(!0);const{data:e,error:s}=await a.from("quiz_results").select("\n          id,\n          quiz_id,\n          score,\n          correct_answers,\n          total_questions,\n          time_taken,\n          completed_at,\n          quiz:quiz_id (\n            id,\n            title,\n            difficulty,\n            chapitres:chapitre_id (\n              id,\n              title,\n              matieres:matiere_id (\n                id,\n                name\n              )\n            )\n          )\n        ").eq("user_id",w.id).order("completed_at",{ascending:!1});if(s)throw s;S(e||[]),W(e||[])}catch(e){}finally{R(!1)}},E=async()=>{try{const e=localStorage.getItem(`quiz-favorites-${w.id}`);e&&D(new Set(JSON.parse(e)))}catch(e){}},V=async()=>{try{const e=localStorage.getItem(`quiz-notes-${w.id}`);e&&L(JSON.parse(e))}catch(e){}},W=(e,s=M,t=F)=>{const a=e.length,l=s.size,i=Object.keys(t).filter(e=>{var s;return null==(s=t[e])?void 0:s.trim()}).length,r=a>0?Math.round(e.reduce((e,s)=>e+s.score,0)/a):0;T({total:a,favorites:l,notes:i,averageScore:r})},G=()=>{let e=[...z];$&&(e=e.filter(e=>{var s,t;return null==(t=null==(s=e.quiz)?void 0:s.title)?void 0:t.toLowerCase().includes($.toLowerCase())})),"all"!==O&&(e=e.filter(e=>{var s,t,a;return(null==(a=null==(t=null==(s=e.quiz)?void 0:s.chapitres)?void 0:t.matieres)?void 0:a.name)===O})),"all"!==I&&(e=e.filter(e=>{var s;return(null==(s=e.quiz)?void 0:s.difficulty)===I})),_(e)},H=e=>{switch(null==e?void 0:e.toLowerCase()){case"facile":return"bg-green-500";case"moyen":return"bg-yellow-500";case"difficile":return"bg-red-500";default:return"bg-gray-500"}},K=e=>e>=80?"text-green-600":e>=50?"text-yellow-600":"text-red-600";return C?s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Chargement de vos quiz..."})]})}):s.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"ðŸ“š RÃ©vision Quiz"}),s.jsx("p",{className:"text-muted-foreground",children:"Revoyez vos quiz passÃ©s, ajoutez des notes et suivez votre progression"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(l,{children:s.jsx(i,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Quiz"}),s.jsx("p",{className:"text-2xl font-bold",children:Q.total})]}),s.jsx(m,{className:"w-8 h-8 text-primary"})]})})}),s.jsx(l,{children:s.jsx(i,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Score Moyen"}),s.jsxs("p",{className:`text-2xl font-bold ${K(Q.averageScore)}`,children:[Q.averageScore,"%"]})]}),s.jsx(x,{className:"w-8 h-8 text-green-600"})]})})}),s.jsx(l,{children:s.jsx(i,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Favoris"}),s.jsx("p",{className:"text-2xl font-bold",children:Q.favorites})]}),s.jsx(u,{className:"w-8 h-8 text-yellow-500"})]})})}),s.jsx(l,{children:s.jsx(i,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Avec Notes"}),s.jsx("p",{className:"text-2xl font-bold",children:Q.notes})]}),s.jsx(h,{className:"w-8 h-8 text-blue-600"})]})})})]}),s.jsxs(l,{children:[s.jsx(r,{children:s.jsxs(n,{className:"flex items-center gap-2",children:[s.jsx(j,{className:"w-5 h-5"}),"Filtres"]})}),s.jsx(i,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(f,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s.jsx(d,{placeholder:"Rechercher un quiz...",value:$,onChange:e=>k(e.target.value),className:"pl-10"})]}),s.jsxs("select",{value:O,onChange:e=>A(e.target.value),className:"px-3 py-2 border rounded-md",children:[s.jsx("option",{value:"all",children:"Toutes les matiÃ¨res"}),(()=>{const e=new Set;return z.forEach(s=>{var t,a,l;const i=null==(l=null==(a=null==(t=s.quiz)?void 0:t.chapitres)?void 0:a.matieres)?void 0:l.name;i&&e.add(i)}),Array.from(e)})().map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("select",{value:I,onChange:e=>J(e.target.value),className:"px-3 py-2 border rounded-md",children:[s.jsx("option",{value:"all",children:"Toutes les difficultÃ©s"}),s.jsx("option",{value:"facile",children:"Facile"}),s.jsx("option",{value:"moyen",children:"Moyen"}),s.jsx("option",{value:"difficile",children:"Difficile"})]})]})})]}),s.jsx("div",{className:"space-y-4",children:s.jsx(y,{children:0===q.length?s.jsx(l,{children:s.jsx(i,{className:"pt-6 text-center",children:s.jsx("p",{className:"text-muted-foreground",children:"Aucun quiz trouvÃ© avec ces filtres"})})}):q.map((e,t)=>{var a,d,m,x,h,j;return s.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.05*t},children:s.jsxs(l,{className:"hover:shadow-md transition-shadow",children:[s.jsx(r,{children:s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(n,{className:"text-lg",children:(null==(a=e.quiz)?void 0:a.title)||"Quiz sans titre"}),s.jsx(c,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=new Set(M);s.has(e)?s.delete(e):s.add(e),D(s),localStorage.setItem(`quiz-favorites-${w.id}`,JSON.stringify([...s])),W(z,s,F)})(e.id),className:"p-1 h-auto",children:s.jsx(u,{className:"w-5 h-5 "+(M.has(e.id)?"fill-yellow-500 text-yellow-500":"text-gray-400")})})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(o,{variant:"outline",children:(null==(x=null==(m=null==(d=e.quiz)?void 0:d.chapitres)?void 0:m.matieres)?void 0:x.name)||"MatiÃ¨re"}),s.jsx(o,{className:H(null==(h=e.quiz)?void 0:h.difficulty),children:(null==(j=e.quiz)?void 0:j.difficulty)||"Non dÃ©fini"}),s.jsxs("span",{className:"flex items-center gap-1 text-sm",children:[s.jsx(v,{className:"w-4 h-4"}),new Date(e.completed_at).toLocaleDateString("fr-FR")]})]})]})})}),s.jsxs(i,{children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Score"}),s.jsxs("p",{className:`text-2xl font-bold ${K(e.score)}`,children:[e.score,"%"]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Bonnes RÃ©ponses"}),s.jsxs("p",{className:"text-xl font-semibold flex items-center justify-center gap-1",children:[s.jsx(p,{className:"w-5 h-5 text-green-600"}),e.correct_answers,"/",e.total_questions]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Temps"}),s.jsxs("p",{className:"text-xl font-semibold flex items-center justify-center gap-1",children:[s.jsx(N,{className:"w-5 h-5 text-blue-600"}),Math.round(e.time_taken/60),"min"]})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Questions RatÃ©es"}),s.jsxs("p",{className:"text-xl font-semibold flex items-center justify-center gap-1",children:[s.jsx(g,{className:"w-5 h-5 text-red-600"}),e.total_questions-e.correct_answers]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"text-sm font-medium mb-2 block",children:"ðŸ“ Notes personnelles"}),s.jsx("textarea",{value:F[e.id]||"",onChange:s=>((e,s)=>{const t={...F,[e]:s};L(t),localStorage.setItem(`quiz-notes-${w.id}`,JSON.stringify(t)),W(z,M,t)})(e.id,s.target.value),placeholder:"Ajoutez vos notes, points Ã  revoir, etc...",className:"w-full px-3 py-2 border rounded-md min-h-[80px] resize-none"})]}),s.jsx("div",{className:"mt-4 flex gap-2",children:s.jsx(c,{variant:"outline",size:"sm",onClick:()=>window.location.href=`/quiz/${e.quiz_id}`,children:"Refaire ce quiz"})})]})]})},e.id)})})})]})}export{w as default};
