import{r as e,j as s}from"./vendor-react-470eca1f.js";import{H as r}from"./Helmet-2c7e73f6.js";import{N as t}from"./Navbar-fef78110.js";import{e as a,L as i,u as l,s as o,C as n,a as d,b as c,f as m,c as p,B as x}from"./index-80385b81.js";import{I as h}from"./input-5c98a0d4.js";import{L as u}from"./label-45a837d0.js";import{c as b}from"./vendor-router-da2b77bd.js";import{m as f}from"./vendor-charts-0ffd78b1.js";import{j,bF as v,bG as g,as as N,a4 as w,bH as k,aU as y,aG as C,aJ as z,bI as E,bJ as S,V as I}from"./vendor-ui-297a683c.js";import"./vendor-supabase-1d8f37f5.js";const q=()=>{const{user:q,signOut:T}=a(),{theme:M,toggleTheme:F,isDark:O}=i(),{toast:R}=l(),A=b(),[D,V]=e.useState(!0),[G,L]=e.useState(!1),[P,B]=e.useState(null),[H,J]=e.useState({email:!0,push:!0,quiz:!0,achievements:!0,newsletter:!1}),[$,U]=e.useState({current:"",new:"",confirm:""}),[_,K]=e.useState({current:!1,new:!1,confirm:!1}),[Z,Q]=e.useState({language:"fr",timezone:"Africa/Dakar",emailVisibility:"public"});e.useEffect(()=>{W()},[q]);const W=async()=>{if(q){V(!0);try{const{data:e,error:s}=await o.from("profiles").select("*").eq("id",q.id).single();if(s)throw s;if(B(e),e.preferences){const s="string"==typeof e.preferences?JSON.parse(e.preferences):e.preferences;s.notifications&&J(s.notifications),s.language&&Q(e=>({...e,language:s.language})),s.timezone&&Q(e=>({...e,timezone:s.timezone}))}}catch(e){R({title:"Erreur",description:"Impossible de charger vos param√®tres.",variant:"destructive"})}finally{V(!1)}}};return D?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-purple-50/30 to-slate-50 dark:from-slate-900 dark:via-purple-950/30 dark:to-slate-900",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 font-semibold",children:"Chargement des param√®tres..."})]})}):s.jsxs(s.Fragment,{children:[s.jsxs(r,{children:[s.jsx("title",{children:"Param√®tres - E-R√©ussite"}),s.jsx("meta",{name:"description",content:"G√©rez vos param√®tres de compte, notifications et pr√©f√©rences."})]}),s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-purple-50/30 to-slate-50 dark:from-slate-900 dark:via-purple-950/30 dark:to-slate-900 transition-colors duration-300",children:[s.jsx(t,{}),s.jsx("section",{className:"pt-32 pb-20 px-4",children:s.jsxs("div",{className:"max-w-5xl mx-auto",children:[s.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-12",children:s.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[s.jsx("div",{className:"p-3 bg-gradient-to-br from-primary to-accent rounded-2xl shadow-lg",children:s.jsx(j,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-4xl md:text-5xl font-bold font-heading text-slate-900 dark:text-white",children:"Param√®tres"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-lg",children:"Personnalisez votre exp√©rience sur E-R√©ussite"})]})]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:s.jsxs(n,{className:"border-2 border-slate-200 dark:border-slate-700 shadow-xl dark:bg-slate-800/50 backdrop-blur-sm",children:[s.jsxs(d,{className:"bg-gradient-to-r from-primary/10 to-accent/10 dark:from-primary/20 dark:to-accent/20 border-b border-slate-200 dark:border-slate-700",children:[s.jsxs(c,{className:"flex items-center gap-2 text-slate-900 dark:text-white",children:[O?s.jsx(v,{className:"w-6 h-6 text-primary"}):s.jsx(g,{className:"w-6 h-6 text-accent"}),"Apparence"]}),s.jsx(m,{className:"dark:text-slate-400",children:"Choisissez le th√®me de l'interface"})]}),s.jsx(p,{className:"p-6",children:s.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-3 rounded-xl ${O?"bg-slate-800":"bg-white"} border-2 ${O?"border-slate-700":"border-slate-200"}`,children:O?s.jsx(v,{className:"w-6 h-6 text-purple-400"}):s.jsx(g,{className:"w-6 h-6 text-yellow-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-slate-900 dark:text-white",children:O?"Mode sombre":"Mode clair"}),s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:O?"Confortable pour les yeux la nuit":"Id√©al pour la journ√©e"})]})]}),s.jsxs(x,{onClick:F,className:"bg-gradient-to-r from-primary to-accent text-white hover:scale-105 transition-all duration-300",children:["Basculer vers ",O?"clair":"sombre"]})]})})]})}),s.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:s.jsxs(n,{className:"border-2 border-slate-200 dark:border-slate-700 shadow-xl dark:bg-slate-800/50 backdrop-blur-sm",children:[s.jsxs(d,{className:"bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-950/30 dark:to-cyan-950/30 border-b border-slate-200 dark:border-slate-700",children:[s.jsxs(c,{className:"flex items-center gap-2 text-slate-900 dark:text-white",children:[s.jsx(N,{className:"w-6 h-6 text-blue-500"}),"Notifications"]}),s.jsx(m,{className:"dark:text-slate-400",children:"G√©rez vos pr√©f√©rences de notifications"})]}),s.jsxs(p,{className:"p-6 space-y-4",children:[[{key:"email",label:"Notifications par email",icon:w},{key:"push",label:"Notifications push",icon:k},{key:"quiz",label:"Rappels de quiz",icon:N},{key:"achievements",label:"Badges et r√©alisations",icon:y},{key:"newsletter",label:"Newsletter hebdomadaire",icon:w}].map((e,r)=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-900/70 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(e.icon,{className:"w-5 h-5 text-primary"}),s.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:e.label})]}),s.jsx("button",{onClick:()=>J(s=>({...s,[e.key]:!s[e.key]})),className:"relative w-14 h-7 rounded-full transition-colors duration-300 "+(H[e.key]?"bg-gradient-to-r from-green-400 to-green-600":"bg-slate-300 dark:bg-slate-700"),children:s.jsx("span",{className:"absolute top-1 left-1 w-5 h-5 rounded-full bg-white shadow-md transition-transform duration-300 "+(H[e.key]?"translate-x-7":"translate-x-0")})})]},e.key)),s.jsxs(x,{onClick:async()=>{L(!0);try{const e={...P.preferences,notifications:H},{error:s}=await o.from("profiles").update({preferences:e,updated_at:new Date}).eq("id",q.id);if(s)throw s;R({title:"‚úÖ Pr√©f√©rences sauvegard√©es",description:"Vos pr√©f√©rences de notifications ont √©t√© mises √† jour."})}catch(e){R({title:"Erreur",description:"Impossible de sauvegarder vos pr√©f√©rences.",variant:"destructive"})}finally{L(!1)}},disabled:G,className:"w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white hover:shadow-xl transition-all",children:[s.jsx(C,{className:"w-4 h-4 mr-2"}),G?"Enregistrement...":"Enregistrer les pr√©f√©rences"]})]})]})}),s.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:s.jsxs(n,{className:"border-2 border-slate-200 dark:border-slate-700 shadow-xl dark:bg-slate-800/50 backdrop-blur-sm",children:[s.jsxs(d,{className:"bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-950/30 dark:to-orange-950/30 border-b border-slate-200 dark:border-slate-700",children:[s.jsxs(c,{className:"flex items-center gap-2 text-slate-900 dark:text-white",children:[s.jsx(z,{className:"w-6 h-6 text-red-500"}),"S√©curit√©"]}),s.jsx(m,{className:"dark:text-slate-400",children:"Modifiez votre mot de passe"})]}),s.jsx(p,{className:"p-6",children:s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),$.new===$.confirm)if($.new.length<6)R({title:"Erreur",description:"Le mot de passe doit contenir au moins 6 caract√®res.",variant:"destructive"});else{L(!0);try{const{error:e}=await o.auth.updateUser({password:$.new});if(e)throw e;R({title:"‚úÖ Mot de passe modifi√©",description:"Votre mot de passe a √©t√© chang√© avec succ√®s."}),U({current:"",new:"",confirm:""})}catch(s){R({title:"Erreur",description:s.message||"Impossible de changer le mot de passe.",variant:"destructive"})}finally{L(!1)}}else R({title:"Erreur",description:"Les mots de passe ne correspondent pas.",variant:"destructive"})},className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"current-password",className:"dark:text-slate-300",children:"Mot de passe actuel"}),s.jsxs("div",{className:"relative",children:[s.jsx(h,{id:"current-password",type:_.current?"text":"password",value:$.current,onChange:e=>U(s=>({...s,current:e.target.value})),className:"pr-10 dark:bg-slate-900/50 dark:border-slate-700 dark:text-white",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}),s.jsx("button",{type:"button",onClick:()=>K(e=>({...e,current:!e.current})),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300",children:_.current?s.jsx(E,{className:"w-5 h-5"}):s.jsx(S,{className:"w-5 h-5"})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"new-password",className:"dark:text-slate-300",children:"Nouveau mot de passe"}),s.jsxs("div",{className:"relative",children:[s.jsx(h,{id:"new-password",type:_.new?"text":"password",value:$.new,onChange:e=>U(s=>({...s,new:e.target.value})),className:"pr-10 dark:bg-slate-900/50 dark:border-slate-700 dark:text-white",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0}),s.jsx("button",{type:"button",onClick:()=>K(e=>({...e,new:!e.new})),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300",children:_.new?s.jsx(E,{className:"w-5 h-5"}):s.jsx(S,{className:"w-5 h-5"})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(u,{htmlFor:"confirm-password",className:"dark:text-slate-300",children:"Confirmer le nouveau mot de passe"}),s.jsxs("div",{className:"relative",children:[s.jsx(h,{id:"confirm-password",type:_.confirm?"text":"password",value:$.confirm,onChange:e=>U(s=>({...s,confirm:e.target.value})),className:"pr-10 dark:bg-slate-900/50 dark:border-slate-700 dark:text-white",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0}),s.jsx("button",{type:"button",onClick:()=>K(e=>({...e,confirm:!e.confirm})),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300",children:_.confirm?s.jsx(E,{className:"w-5 h-5"}):s.jsx(S,{className:"w-5 h-5"})})]})]}),s.jsxs(x,{type:"submit",disabled:G,className:"w-full bg-gradient-to-r from-red-500 to-orange-500 text-white hover:shadow-xl transition-all",children:[s.jsx(z,{className:"w-4 h-4 mr-2"}),G?"Modification...":"Changer le mot de passe"]})]})})]})}),s.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:s.jsxs(n,{className:"border-2 border-red-200 dark:border-red-900/50 shadow-xl dark:bg-slate-800/50 backdrop-blur-sm",children:[s.jsxs(d,{className:"bg-gradient-to-r from-red-50 to-red-100 dark:from-red-950/50 dark:to-red-900/30 border-b border-red-200 dark:border-red-900/50",children:[s.jsxs(c,{className:"flex items-center gap-2 text-red-700 dark:text-red-400",children:[s.jsx(I,{className:"w-6 h-6"}),"Zone de danger"]}),s.jsx(m,{className:"text-red-600 dark:text-red-400",children:"Actions irr√©versibles"})]}),s.jsx(p,{className:"p-6 space-y-4",children:s.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-950/30 border-2 border-red-200 dark:border-red-900/50 rounded-xl",children:[s.jsx("h4",{className:"font-bold text-red-700 dark:text-red-400 mb-2",children:"Supprimer mon compte"}),s.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 mb-4",children:["Cette action supprimera d√©finitivement votre compte et toutes vos donn√©es. Cette action est ",s.jsx("strong",{children:"irr√©versible"}),"."]}),s.jsxs(x,{onClick:async()=>{if(!window.confirm("‚ö†Ô∏è ATTENTION : Cette action est irr√©versible.\n\n√ätes-vous s√ªr de vouloir supprimer d√©finitivement votre compte ?\n\nToutes vos donn√©es (progression, badges, historique) seront perdues."))return;if(window.confirm("üî¥ DERNI√àRE CONFIRMATION\n\nTapez OK pour confirmer la suppression d√©finitive de votre compte.")){L(!0);try{const{error:e}=await o.from("profiles").delete().eq("id",q.id);if(e)throw e;await T(),R({title:"Compte supprim√©",description:"Votre compte a √©t√© supprim√© avec succ√®s."}),A("/")}catch(e){R({title:"Erreur",description:"Impossible de supprimer le compte. Contactez le support.",variant:"destructive"})}finally{L(!1)}}},variant:"destructive",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800",children:[s.jsx(I,{className:"w-4 h-4 mr-2"}),"Supprimer d√©finitivement mon compte"]})]})})]})})]})]})})]})]})};export{q as default};
