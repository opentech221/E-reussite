import{r as e,j as t}from"./vendor-react-470eca1f.js";import{s as r}from"./index-80385b81.js";import"./vendor-supabase-1d8f37f5.js";import"./vendor-ui-297a683c.js";import"./vendor-router-da2b77bd.js";import"./vendor-charts-0ffd78b1.js";const s=()=>{const[s,i]=e.useState([]),[o,a]=e.useState(!0),n=(e,t="info")=>{i(r=>[...r,{message:e,type:t,time:(new Date).toLocaleTimeString()}])};return e.useEffect(()=>{(async()=>{n("üöÄ D√âBUT DES TESTS DE PROGRESSION","title");const e="b8fe56ad-e6e8-44f8-940f-a9e1d1115097";n("\nüìä TEST 1 : R√©cup√©ration de user_progress","title");try{const{data:t,error:s}=await r.from("user_progress").select("*").eq("user_id",e);if(s)n(`‚ùå ERREUR user_progress: ${s.message}`,"error");else{n(`‚úÖ user_progress trouv√©es: ${(null==t?void 0:t.length)||0} entr√©es`,"success");const e=(null==t?void 0:t.filter(e=>e.completed))||[];n(`   ‚úÖ Compl√©t√©es: ${e.length}`,"success"),n("   ‚è≥ Non compl√©t√©es: "+((null==t?void 0:t.length)-e.length),"info"),e.length>0&&(n("\n   üìñ Chapitres compl√©t√©s (IDs):","info"),e.slice(0,5).forEach(e=>{n(`      - chapitre_id: ${e.chapitre_id}, completed_at: ${e.completed_at}`,"info")}))}}catch(t){n(`‚ùå EXCEPTION user_progress: ${t.message}`,"error")}n("\nüìö TEST 2 : R√©cup√©ration des mati√®res BFEM","title");try{const{data:e,error:t}=await r.from("matieres").select("*").eq("level","bfem");t?n(`‚ùå ERREUR matieres: ${t.message}`,"error"):(n(`‚úÖ Mati√®res trouv√©es: ${(null==e?void 0:e.length)||0}`,"success"),e&&e.length>0&&(n("\n   üìö Liste des mati√®res:","info"),e.forEach(e=>{n(`      - ${e.name} (ID: ${e.id})`,"info")})))}catch(t){n(`‚ùå EXCEPTION matieres: ${t.message}`,"error")}n("\nüìñ TEST 3 : R√©cup√©ration des chapitres","title");try{const{data:e,error:t}=await r.from("chapitres").select("id, title, matiere_id").limit(10);t?n(`‚ùå ERREUR chapitres: ${t.message}`,"error"):(n(`‚úÖ Chapitres trouv√©s (premiers 10): ${(null==e?void 0:e.length)||0}`,"success"),e&&e.length>0&&(n("\n   üìñ Exemples de chapitres:","info"),e.slice(0,5).forEach(e=>{n(`      - "${e.title}" (ID: ${e.id}, matiere_id: ${e.matiere_id})`,"info")})))}catch(t){n(`‚ùå EXCEPTION chapitres: ${t.message}`,"error")}n("\nüîó TEST 4 : Jointure user_progress + chapitres","title");try{const{data:t,error:s}=await r.from("user_progress").select("\n            id,\n            chapitre_id,\n            completed,\n            completed_at,\n            chapitres (\n              id,\n              title,\n              matiere_id\n            )\n          ").eq("user_id",e).eq("completed",!0);s?n(`‚ùå ERREUR jointure: ${s.message}`,"error"):(n(`‚úÖ Jointure r√©ussie: ${(null==t?void 0:t.length)||0} entr√©es`,"success"),t&&t.length>0&&(n("\n   üîó Chapitres avec d√©tails:","info"),t.slice(0,5).forEach(e=>{var t,r;n(`      - "${(null==(t=e.chapitres)?void 0:t.title)||"TITRE MANQUANT"}" (matiere_id: ${null==(r=e.chapitres)?void 0:r.matiere_id})`,"info")})))}catch(t){n(`‚ùå EXCEPTION jointure: ${t.message}`,"error")}n("\nüåü TEST 5 : Jointure user_progress + chapitres + matieres","title");try{const{data:t,error:s}=await r.from("user_progress").select("\n            id,\n            chapitre_id,\n            completed,\n            completed_at,\n            chapitres (\n              id,\n              title,\n              matiere_id,\n              matieres (\n                id,\n                name\n              )\n            )\n          ").eq("user_id",e).eq("completed",!0).order("completed_at",{ascending:!1});s?n(`‚ùå ERREUR jointure compl√®te: ${s.message}`,"error"):(n(`‚úÖ Jointure compl√®te r√©ussie: ${(null==t?void 0:t.length)||0} entr√©es`,"success"),t&&t.length>0&&(n("\n   üåü Donn√©es compl√®tes:","info"),t.slice(0,5).forEach(e=>{var t,r,s;const i=(null==(r=null==(t=e.chapitres)?void 0:t.matieres)?void 0:r.name)||"MATI√àRE MANQUANTE",o=(null==(s=e.chapitres)?void 0:s.title)||"TITRE MANQUANT";n(`      - [${i}] ${o}`,"info")})))}catch(t){n(`‚ùå EXCEPTION jointure compl√®te: ${t.message}`,"error")}n("\nüßÆ TEST 6 : Calcul progression par mati√®re","title");try{const{data:t}=await r.from("matieres").select("id, name").eq("level","bfem");if(t&&0!==t.length){n(`‚úÖ Analyse de ${t.length} mati√®res`,"success");for(const s of t){const{data:t}=await r.from("chapitres").select("id").eq("matiere_id",s.id),{data:i}=await r.from("user_progress").select("chapitre_id").eq("user_id",e).eq("completed",!0).in("chapitre_id",(null==t?void 0:t.map(e=>e.id))||[]),o=(null==t?void 0:t.length)||0,a=(null==i?void 0:i.length)||0,l=o>0?Math.round(a/o*100):0;n(`   ${l>0?"‚úÖ":"‚ö™"} ${s.name}: ${a}/${o} = ${l}%`,l>0?"success":"info")}}else n("‚ùå Aucune mati√®re BFEM trouv√©e","error")}catch(t){n(`‚ùå EXCEPTION calcul progression: ${t.message}`,"error")}n("\nüèÅ FIN DES TESTS","title"),a(!1)})()},[]),t.jsxs("div",{style:{padding:"20px",fontFamily:"monospace",backgroundColor:"#1e1e1e",color:"#d4d4d4",minHeight:"100vh"},children:[t.jsx("h1",{style:{color:"#4ec9b0",marginBottom:"20px"},children:"üîß Test Progression Dashboard - Mode Debug"}),o&&t.jsx("div",{style:{color:"#ce9178",marginBottom:"20px"},children:"‚è≥ Tests en cours..."}),t.jsx("div",{style:{backgroundColor:"#252526",padding:"15px",borderRadius:"5px",maxHeight:"80vh",overflow:"auto"},children:s.map((e,r)=>{let s="#d4d4d4";return"error"===e.type&&(s="#f48771"),"success"===e.type&&(s="#4ec9b0"),"title"===e.type&&(s="#dcdcaa"),t.jsxs("div",{style:{color:s,marginBottom:"5px",fontSize:"title"===e.type?"16px":"14px",fontWeight:"title"===e.type?"bold":"normal"},children:[t.jsx("span",{style:{color:"#858585",marginRight:"10px"},children:e.time}),e.message]},r)})}),!o&&t.jsx("div",{style:{marginTop:"20px",color:"#4ec9b0"},children:"‚úÖ Tests termin√©s ! V√©rifiez les r√©sultats ci-dessus."})]})};export{s as default};
