import{s as e}from"./index-80385b81.js";async function t(t,r,a){try{const n=a.slice(0,5).map(e=>({slug:e.slug,title:e.title,score:e.score,category:e.category})),o=a.length>0?a[0].score:null,{data:c,error:i}=await e.from("profiles").update({orientation_test_id:r,preferred_careers:n,orientation_completed_at:(new Date).toISOString(),top_career_match_score:o}).eq("id",t).select().single();if(i)throw i;return c}catch(n){throw n}}async function r(t){try{const{data:r,error:a}=await e.from("profiles").select("orientation_test_id, preferred_careers, orientation_completed_at, top_career_match_score").eq("id",t).single();if(a)throw a;return r.orientation_completed_at?{testId:r.orientation_test_id,careers:r.preferred_careers||[],completedAt:r.orientation_completed_at,topScore:r.top_career_match_score}:null}catch(r){return null}}async function a(t){try{const{data:r,error:a}=await e.from("profiles").select("financial_situation, network_support, location, religious_values, academic_level").eq("id",t).single();if(a)throw a;const n={q13:null,q14:o(r.financial_situation),q15:c(r.location),q16:i(r.network_support),q17:l(r.religious_values)};return r.academic_level&&(n.q13={bac:"40","bac+2":"50","bac+3":"55","bac+5":"60",doctorat:"65"}[r.academic_level]||null),n}catch(r){return{q13:null,q14:null,q15:null,q16:null,q17:null}}}async function n(t){try{const a=await r(t);if(!a||0===a.careers.length)return[];const n=a.careers.map(e=>e.slug),{data:o,error:c}=await e.from("careers").select("*").in("slug",n);if(c)throw c;const i=o.map(e=>{const t=a.careers.find(t=>t.slug===e.slug);return{...e,match_score:(null==t?void 0:t.score)||0}});return i.sort((e,t)=>t.match_score-e.match_score),i}catch(a){return[]}}function o(e){return{low:"constrained",medium:"moderate",high:"comfortable"}[e]||null}function c(e){if(!e)return null;const t=e.toLowerCase();return["dakar","thies","saint-louis","kaolack"].some(e=>t.includes(e))?"urban":["rural","village","campagne"].some(e=>t.includes(e))?"rural":"semi-urban"}function i(e){return{strong:"strong",moderate:"moderate",weak:"weak",none:"weak"}[e]||null}function l(e){return{very_important:"very-important",important:"important",neutral:"neutral",not_important:"not-important"}[e]||null}export{n as a,r as g,a as p,t as s};
