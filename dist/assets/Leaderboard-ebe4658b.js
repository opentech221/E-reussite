import{r as e,j as s}from"./vendor-react-470eca1f.js";import{H as a}from"./Helmet-2c7e73f6.js";import{N as t}from"./Navbar-fef78110.js";import{e as l,s as r,C as i,c as d,B as n,a as o,b as c,A as m,m as x,n as u}from"./index-80385b81.js";import{T as h,a as p,b,c as g}from"./tabs-04421a9d.js";import"./progress-d9418a6f.js";import{f,aP as j,aW as _,bh as w,bi as N,ao as v,d as k,Z as y,p as z,c as q,aH as C,bj as A,A as S}from"./vendor-ui-297a683c.js";import{m as T}from"./vendor-charts-0ffd78b1.js";import"./vendor-supabase-1d8f37f5.js";import"./vendor-router-da2b77bd.js";const P=({user:e,position:a,category:t,showTrend:r=!1})=>{var i,d;const{user:n}=l(),o=(null==n?void 0:n.id)===e.id,c=((e,s)=>{switch(s){case"points":return e.total_points||0;case"streak":return e.current_streak||0;case"quizzes":return e.quizzes_completed||0;case"lessons":return e.lessons_completed||0;case"badges":return e.badges_count||0;default:return 0}})(e,t),h=e.trend||0;return s.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*a},className:"p-3 sm:p-4 rounded-lg border-2 transition-all duration-300 shadow-[0_0_16px_0_rgba(34,197,94,0.18)] dark:shadow-[0_0_24px_0_rgba(34,197,94,0.25)] "+(o?"bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-white/40":"bg-white dark:bg-slate-800 border-slate-200 dark:border-white/20 hover:shadow-lg dark:hover:shadow-[0_0_30px_rgba(34,197,94,0.25)]"),children:s.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[s.jsx("div",{className:"flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 flex-shrink-0",children:(p=a,1===p?s.jsx(C,{className:"w-6 h-6 text-yellow-500"}):2===p?s.jsx(A,{className:"w-6 h-6 text-slate-400"}):3===p?s.jsx(A,{className:"w-6 h-6 text-amber-600"}):s.jsx("span",{className:"text-lg font-bold text-slate-600 dark:text-slate-300",children:p}))}),s.jsxs(m,{className:`w-10 h-10 sm:w-12 sm:h-12 flex-shrink-0 ${a<=3?"ring-2":""} ${1===a?"ring-yellow-400":2===a?"ring-slate-400":3===a?"ring-amber-600":""}`,children:[s.jsx(x,{src:e.avatar_url}),s.jsx(u,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white font-semibold text-sm",children:(null==(i=e.display_name)?void 0:i.charAt(0))||(null==(d=e.email)?void 0:d.charAt(0))||"U"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[s.jsx("h3",{className:"font-semibold truncate text-sm sm:text-base "+(o?"text-blue-900":"text-slate-900 dark:text-white"),children:e.display_name||"Utilisateur anonyme"}),o&&s.jsx("span",{className:"px-2 py-0.5 bg-gradient-to-r from-green-400 to-green-600 text-white text-xs rounded-full flex-shrink-0 shadow-md border border-green-500",children:"Vous"}),e.level&&s.jsxs("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-green-100 dark:bg-green-900/60 text-green-700 dark:text-green-300 border border-green-300 dark:border-green-700 shadow-sm",children:["Niveau ",e.level]}),"quizzes"===t&&s.jsxs("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-100 dark:bg-blue-900/60 text-blue-700 dark:text-blue-300 border border-blue-300 dark:border-blue-700 shadow-sm",children:[e.quizzes_completed," quiz"]}),"badges"===t&&s.jsxs("span",{className:"ml-1 px-2 py-0.5 rounded-full text-xs font-semibold bg-yellow-100 dark:bg-yellow-900/60 text-yellow-700 dark:text-yellow-300 border border-yellow-300 dark:border-yellow-700 shadow-sm",children:[e.badges_count," badges"]})]}),s.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 text-xs sm:text-sm text-slate-600 dark:text-slate-300 flex-wrap",children:[e.location&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(j,{className:"w-3 h-3 flex-shrink-0"}),s.jsx("span",{className:"truncate",children:e.location})]}),e.school&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(_,{className:"w-3 h-3 flex-shrink-0"}),s.jsx("span",{className:"truncate hidden sm:inline",children:e.school})]})]})]}),s.jsxs("div",{className:"text-right flex-shrink-0",children:[s.jsx("div",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white",children:c.toLocaleString()}),s.jsx("div",{className:"text-xs sm:text-sm text-slate-500",children:(e=>{switch(e){case"points":return"points";case"streak":return"jours";case"quizzes":return"quiz";case"lessons":return"leÃ§ons";case"badges":return"badges";default:return""}})(t)}),r&&0!==h&&s.jsxs(T.div,{initial:{scale:0},animate:{scale:1},className:"flex items-center gap-1 text-xs mt-1 justify-end "+(h>0?"text-green-600":"text-red-600"),children:[h>0?s.jsx(w,{className:"w-3 h-3"}):s.jsx(N,{className:"w-3 h-3"}),s.jsx("span",{children:Math.abs(h)})]})]})]})});var p},U=({region:a})=>{const[t,l]=e.useState([]),[i,d]=e.useState(!0);e.useEffect(()=>{n()},[a]);const n=async()=>{d(!0);try{const{data:e,error:s}=await r.from("profiles").select("id, full_name, avatar_url");if(s)throw s;const{data:a}=await r.from("user_points").select("user_id, total_points, level, current_streak"),{data:t}=await r.from("quiz_results").select("user_id, score, completed_at"),{data:i}=await r.from("user_badges").select("user_id"),{data:d}=await r.from("user_progress").select("user_id, completed").eq("completed",!0),n=e.map(e=>{const s=null==a?void 0:a.find(s=>s.user_id===e.id),l=(null==t?void 0:t.filter(s=>s.user_id===e.id))||[],r=(null==i?void 0:i.filter(s=>s.user_id===e.id))||[],n=(null==d?void 0:d.filter(s=>s.user_id===e.id))||[];return{id:e.id,display_name:e.full_name||"Utilisateur",avatar_url:e.avatar_url,total_points:(null==s?void 0:s.total_points)||0,current_streak:(null==s?void 0:s.current_streak)||0,quizzes_completed:l.length,lessons_completed:n.length,badges_count:r.length,trend:0}}).sort((e,s)=>s.total_points-e.total_points);l(n.slice(0,20))}catch(e){l([])}finally{d(!1)}};return i?s.jsx("div",{className:"flex items-center justify-center h-32",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s.jsx("div",{className:"space-y-3",children:t.map((e,a)=>s.jsx(P,{user:e,position:a+1,category:"points",showTrend:!0},e.id))})},V=({category:e,users:a})=>{const t=a[0],{user:r}=l(),n=a.findIndex(e=>e.id===(null==r?void 0:r.id))+1,o=(e=>{switch(e){case"points":return{icon:k,title:"Points Totaux",color:"text-yellow-500",suffix:"pts"};case"streak":return{icon:y,title:"SÃ©rie Quotidienne",color:"text-orange-500",suffix:"jours"};case"quizzes":return{icon:z,title:"Quiz ComplÃ©tÃ©s",color:"text-purple-500",suffix:"quiz"};case"lessons":return{icon:q,title:"LeÃ§ons TerminÃ©es",color:"text-blue-500",suffix:"leÃ§ons"};default:return{icon:S,title:"Performance",color:"text-green-500",suffix:""}}})(e),c=o.icon;return s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-6",children:[s.jsx(i,{className:"dark:bg-slate-800 dark:border-white/20 border-2 shadow-lg dark:shadow-[0_0_30px_rgba(255,255,255,0.4)]",children:s.jsxs(d,{className:"p-4 sm:p-6 text-center",children:[s.jsx(c,{className:`w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 ${o.color}`}),s.jsx("div",{className:"text-xl sm:text-2xl font-bold dark:text-slate-100",children:t&&t["points"===e?"total_points":"streak"===e?"current_streak":"quizzes"===e?"quizzes_completed":"lessons_completed"]||0}),s.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-300",children:"Record actuel"})]})}),s.jsx(i,{className:"dark:bg-slate-800 dark:border-white/20 border-2 shadow-lg dark:shadow-[0_0_30px_rgba(255,255,255,0.4)]",children:s.jsxs(d,{className:"p-4 sm:p-6 text-center",children:[s.jsx(f,{className:"w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 text-yellow-500"}),s.jsx("div",{className:"text-xl sm:text-2xl font-bold dark:text-slate-100",children:a.length}),s.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-300",children:"Participants"})]})}),s.jsx(i,{className:"dark:bg-slate-800 dark:border-white/20 border-2 shadow-lg dark:shadow-[0_0_30px_rgba(255,255,255,0.4)]",children:s.jsxs(d,{className:"p-4 sm:p-6 text-center",children:[s.jsx(v,{className:"w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 text-green-500"}),s.jsxs("div",{className:"text-xl sm:text-2xl font-bold dark:text-slate-100",children:["#",n||"--"]}),s.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-300",children:"Votre position"})]})})]})},E=()=>{const[m,x]=e.useState([]),[u,_]=e.useState(!0),[w,N]=e.useState("points"),[v,C]=e.useState("all"),{user:A}=l();e.useEffect(()=>{A&&S()},[A,w,v]);const S=async()=>{_(!0);try{const{data:e,error:s}=await r.from("profiles").select("id, full_name, avatar_url");if(s)throw s;const{data:a}=await r.from("user_points").select("user_id, total_points, level, current_streak"),{data:t}=await r.from("quiz_results").select("user_id, score, completed_at"),{data:l}=await r.from("user_badges").select("user_id"),{data:i}=await r.from("user_progress").select("user_id, completed").eq("completed",!0),d=e.map(e=>{const s=null==a?void 0:a.find(s=>s.user_id===e.id),r=(null==t?void 0:t.filter(s=>s.user_id===e.id))||[],d=(null==l?void 0:l.filter(s=>s.user_id===e.id))||[],n=(null==i?void 0:i.filter(s=>s.user_id===e.id))||[];return{id:e.id,display_name:e.full_name||"Utilisateur",avatar_url:e.avatar_url,total_points:(null==s?void 0:s.total_points)||0,current_streak:(null==s?void 0:s.current_streak)||0,quizzes_completed:r.length,lessons_completed:n.length,badges_count:d.length,level:(null==s?void 0:s.level)||1,trend:0}}).sort((e,s)=>{switch(w){case"points":default:return s.total_points-e.total_points;case"streak":return s.current_streak-e.current_streak;case"quizzes":return s.quizzes_completed-e.quizzes_completed;case"lessons":return s.lessons_completed-e.lessons_completed;case"badges":return s.badges_count-e.badges_count}});x(d.slice(0,100))}catch(e){x([])}finally{_(!1)}},T=[{id:"points",label:"Points",icon:k},{id:"streak",label:"SÃ©ries",icon:y},{id:"quizzes",label:"Quiz",icon:z},{id:"lessons",label:"LeÃ§ons",icon:q}],E=[{id:"west",label:"Afrique de l'Ouest"},{id:"north",label:"Afrique du Nord"},{id:"central",label:"Afrique Centrale"},{id:"east",label:"Afrique de l'Est"},{id:"south",label:"Afrique Australe"}];return u?s.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-900",children:[s.jsx(t,{}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:"Chargement du classement..."})]})]}):s.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900",children:[s.jsxs(a,{children:[s.jsx("title",{children:"Classement - E-RÃ©ussite"}),s.jsx("meta",{name:"description",content:"Classement des meilleurs Ã©tudiants d'Afrique francophone"})]}),s.jsx(t,{}),s.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"text-center mb-6 bg-gradient-to-r from-blue-50 via-green-50 to-pink-50 dark:from-slate-800 dark:via-green-900/30 dark:to-slate-900 rounded-2xl p-8 shadow-[0_0_32px_0_rgba(34,197,94,0.18)] dark:shadow-[0_0_40px_0_rgba(34,197,94,0.25)]",children:[s.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-green-300 mb-2 drop-shadow-[0_2px_8px_rgba(34,197,94,0.18)]",children:"ðŸ† Classement"}),s.jsx("p",{className:"text-sm sm:text-base text-slate-600 dark:text-slate-200",children:"CompÃ©tition amicale entre apprenants africains"})]}),s.jsx(V,{category:w,users:m}),s.jsx(i,{className:"bg-white dark:bg-slate-800 dark:border-white/20 border-2 shadow-lg dark:shadow-[0_0_25px_rgba(255,255,255,0.3)]",children:s.jsx(d,{className:"p-4",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-200",children:"CatÃ©gorie"}),s.jsx("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2",children:T.map(e=>{const a=e.icon;return s.jsxs(n,{variant:w===e.id?"default":"outline",size:"sm",onClick:()=>N(e.id),className:"flex items-center justify-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs sm:text-sm",children:e.label})]},e.id)})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-200",children:"PÃ©riode"}),s.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{id:"all",label:"Tout temps"},{id:"week",label:"Cette semaine"},{id:"month",label:"Ce mois"}].map(e=>s.jsx(n,{variant:v===e.id?"default":"outline",size:"sm",onClick:()=>C(e.id),className:"text-xs sm:text-sm",children:e.label},e.id))})]})]})})}),s.jsxs(h,{defaultValue:"global",className:"w-full",children:[s.jsxs(p,{className:"grid w-full grid-cols-2",children:[s.jsxs(b,{value:"global",className:"flex items-center gap-2",children:[s.jsx(f,{className:"w-4 h-4"}),"Classement Global"]}),s.jsxs(b,{value:"regional",className:"flex items-center gap-2",children:[s.jsx(j,{className:"w-4 h-4"}),"Par RÃ©gion"]})]}),s.jsx(g,{value:"global",className:"mt-6",children:s.jsxs(i,{className:"dark:bg-slate-800 dark:border-white/20 border-2 shadow-lg dark:shadow-[0_0_30px_rgba(255,255,255,0.4)]",children:[s.jsx(o,{children:s.jsxs(c,{className:"flex items-center gap-2 dark:text-slate-200",children:[s.jsx(f,{className:"w-5 h-5 text-yellow-500"}),"Top des Apprenants"]})}),s.jsx(d,{children:s.jsx("div",{className:"space-y-3",children:m.map((e,a)=>s.jsx(P,{user:e,position:a+1,category:w,showTrend:!0},e.id))})})]})}),s.jsx(g,{value:"regional",className:"mt-6",children:s.jsxs(h,{defaultValue:"west",className:"w-full",children:[s.jsx(p,{className:"grid w-full grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-1",children:E.map(e=>s.jsxs(b,{value:e.id,className:"text-[10px] sm:text-xs px-1 sm:px-3",children:[s.jsx("span",{className:"hidden sm:inline",children:e.label}),s.jsx("span",{className:"sm:hidden",children:e.label.replace("Afrique ","")})]},e.id))}),E.map(e=>s.jsx(g,{value:e.id,className:"mt-6",children:s.jsxs(i,{className:"dark:bg-slate-800 dark:border-white/20 border-2 shadow-lg dark:shadow-[0_0_30px_rgba(255,255,255,0.4)]",children:[s.jsx(o,{children:s.jsxs(c,{className:"flex items-center gap-2 dark:text-slate-200",children:[s.jsx(j,{className:"w-5 h-5 text-blue-500"}),e.label]})}),s.jsx(d,{children:s.jsx(U,{region:e.id})})]})},e.id))]})})]})]})})]})};export{E as default};
