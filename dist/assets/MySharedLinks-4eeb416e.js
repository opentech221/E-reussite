import{r as e,j as s}from"./vendor-react-470eca1f.js";import{e as a,u as t,N as r,l as i,C as l,a as n,b as d,f as c,c as o,B as x,g as m,h}from"./index-80385b81.js";import{B as u}from"./badge-3c6eba89.js";import{bK as g,ao as p,U as b,aa as j,Y as v,ab as w,m as N,bh as f,bi as y,b as k,bL as C,bH as z,bM as _,bC as L,V as q}from"./vendor-ui-297a683c.js";import"./vendor-supabase-1d8f37f5.js";import"./vendor-router-da2b77bd.js";import"./vendor-charts-0ffd78b1.js";const I=[{value:"all",label:"Tous les liens",icon:g},{value:"course",label:"Cours",icon:"ğŸ“š"},{value:"quiz",label:"Quiz",icon:"ğŸ“"},{value:"exam",label:"Examens",icon:"ğŸ“"},{value:"certificate",label:"Certificats",icon:"ğŸ†"},{value:"referral",label:"Parrainage",icon:"ğŸ"},{value:"perplexity",label:"Perplexity",icon:"ğŸ¤–"}];function S(){const{user:S}=a(),{toast:E}=t(),[A,$]=e.useState([]),[P,T]=e.useState(null),[U,V]=e.useState(!0),[D,F]=e.useState(null),[M,B]=e.useState("all"),[G,H]=e.useState(new Set),[K,Q]=e.useState({});e.useEffect(()=>{S&&(W(),J())},[S,M]),e.useEffect(()=>{A.length>0&&S&&Y()},[A.length]);const W=async()=>{try{V(!0);const e="all"===M?null:M,{data:s,error:a}=await r.getUserLinks(S.id,e);if(a)throw a;$(s||[])}catch(e){E({title:"Erreur",description:"Impossible de charger les liens",variant:"destructive"})}finally{V(!1)}},Y=async()=>{try{const e=A.map(async e=>{try{const s=await i.getCustomLinkAnalytics(e.id,"30d");return{linkId:e.id,analytics:s}}catch(s){return{linkId:e.id,analytics:null}}}),s=await Promise.all(e),a={};s.forEach(({linkId:e,analytics:s})=>{s&&(a[e]=s)}),Q(a)}catch(e){}},J=async()=>{try{const{data:e,error:s}=await r.getUserLinksStats(S.id);if(s)throw s;T(e)}catch(e){}},O=e=>{const s=I.find(s=>s.value===e);return(null==s?void 0:s.icon)||"ğŸ”—"};return S?s.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-4xl font-bold mb-2 dark:text-white",children:"ğŸ”— Mes Liens de Partage"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"GÃ©rez tous vos liens courts Dub.co et consultez leurs statistiques"})]}),P&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[s.jsx(l,{children:s.jsx(o,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:s.jsx(g,{className:"w-6 h-6 text-blue-600 dark:text-blue-300"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total liens"}),s.jsx("p",{className:"text-2xl font-bold dark:text-white",children:P.totalLinks})]})]})})}),s.jsx(l,{children:s.jsx(o,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:s.jsx(p,{className:"w-6 h-6 text-green-600 dark:text-green-300"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total clics"}),s.jsx("p",{className:"text-2xl font-bold dark:text-white",children:P.totalClicks})]})]})})}),s.jsx(l,{children:s.jsx(o,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-lg",children:s.jsx(b,{className:"w-6 h-6 text-purple-600 dark:text-purple-300"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Visiteurs uniques"}),s.jsx("p",{className:"text-2xl font-bold dark:text-white",children:P.totalUniqueClicks})]})]})})})]}),s.jsx("div",{className:"flex flex-wrap gap-3 mb-6",children:I.map(e=>{var a,t;const r=M===e.value,i=(null==(t=null==(a=null==P?void 0:P.byType)?void 0:a[e.value])?void 0:t.count)||0;return s.jsxs(x,{variant:r?"default":"outline",size:"sm",onClick:()=>B(e.value),className:`\n                gap-2 px-4 py-2 rounded-xl font-medium transition-all duration-300 \n                ${r?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg shadow-blue-500/30 scale-105 border-none":"bg-white dark:bg-gray-800 text-gray-800 dark:text-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 dark:hover:from-blue-900/20 dark:hover:to-purple-900/20 hover:shadow-md hover:scale-102 border-2 border-gray-200 dark:border-gray-700"}\n              `,children:["string"==typeof e.icon?s.jsx("span",{className:"text-lg",children:e.icon}):s.jsx(e.icon,{className:"w-4 h-4 "+(r?"animate-pulse":"")}),s.jsx("span",{children:e.label}),i>0&&s.jsx(u,{variant:r?"secondary":"outline",className:`\n                    ml-1 px-2 py-0.5 rounded-full font-bold text-xs\n                    ${r?"bg-white/20 text-white border-white/30":"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-700"}\n                  `,children:i})]},e.value)})}),U?s.jsx("div",{className:"flex justify-center py-12",children:s.jsx(j,{className:"w-8 h-8 animate-spin text-blue-600"})}):0===A.length?s.jsx(l,{children:s.jsxs(o,{className:"py-12 text-center",children:[s.jsx(g,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),s.jsx("h3",{className:"text-xl font-semibold mb-2 dark:text-white",children:"Aucun lien partagÃ©"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Commencez Ã  partager des cours, quiz ou examens pour voir vos liens ici"})]})}):s.jsx("div",{className:"grid grid-cols-1 gap-4",children:A.map(e=>{var a;return s.jsx(l,{className:"hover:shadow-lg transition-shadow",children:s.jsx(o,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("span",{className:"text-2xl",children:O(e.link_type)}),s.jsx(u,{variant:"secondary",children:(null==(a=I.find(s=>s.value===e.link_type))?void 0:a.label)||e.link_type})]}),s.jsx("h3",{className:"text-lg font-semibold mb-1 dark:text-white truncate",children:e.title}),e.description&&s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2",children:e.description}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("code",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded text-sm flex-1 truncate",children:e.short_link}),s.jsx(x,{size:"sm",variant:"ghost",onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),E({title:"CopiÃ© ! ğŸ“‹",description:"Le lien a Ã©tÃ© copiÃ© dans le presse-papiers"})}catch(s){E({title:"Erreur",description:"Impossible de copier le lien",variant:"destructive"})}})(e.short_link),children:s.jsx(v,{className:"w-4 h-4"})}),s.jsx(x,{size:"sm",variant:"ghost",onClick:()=>window.open(e.short_link,"_blank"),children:s.jsx(w,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(p,{className:"w-4 h-4"}),s.jsxs("span",{children:[e.clicks||0," clics"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(b,{className:"w-4 h-4"}),s.jsxs("span",{children:[e.unique_clicks||0," uniques"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(N,{className:"w-4 h-4"}),s.jsx("span",{children:e.created_at?m(new Date(e.created_at),{addSuffix:!0,locale:h}):"Date inconnue"})]}),(e.clicks>0||K[e.id])&&s.jsx(x,{size:"sm",onClick:()=>{return s=e.id,void H(e=>{const a=new Set(e);return a.has(s)?a.delete(s):a.add(s),a});var s},disabled:!K[e.id],className:`\n                            ml-auto px-4 py-2 rounded-lg font-medium transition-all duration-300\n                            ${K[e.id]?G.has(e.id)?"bg-gradient-to-r from-red-500 to-pink-500 text-white shadow-lg shadow-red-500/30 hover:shadow-red-500/50 hover:scale-105":"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg shadow-green-500/30 hover:shadow-green-500/50 hover:scale-105":"bg-gray-100 dark:bg-gray-800 text-gray-400 cursor-wait"}\n                          `,children:K[e.id]?G.has(e.id)?s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),s.jsx("span",{className:"text-xs font-semibold",children:"Masquer dÃ©tails"})]}):s.jsxs(s.Fragment,{children:[s.jsx(y,{className:"w-4 h-4 mr-2 animate-bounce"}),s.jsx("span",{className:"text-xs font-semibold",children:"ğŸ“Š Voir dÃ©tails"})]}):s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"w-4 h-4 mr-2 animate-spin"}),s.jsx("span",{className:"text-xs font-semibold",children:"Chargement..."})]})})]}),G.has(e.id)&&K[e.id]&&s.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-blue-200 dark:border-blue-700 rounded-lg bg-gradient-to-br from-blue-50/50 to-purple-50/50 dark:from-blue-900/10 dark:to-purple-900/10 p-4 space-y-4 animate-fadeIn",children:[K[e.id].countries&&K[e.id].countries.length>0&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md hover:shadow-lg transition-shadow duration-300",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-md",children:s.jsx(k,{className:"w-5 h-5 text-white"})}),s.jsx("span",{className:"font-bold text-base dark:text-white",children:"ğŸŒ Pays des visiteurs"})]}),s.jsx("div",{className:"space-y-2",children:K[e.id].countries.slice(0,5).map((a,t)=>s.jsxs("div",{className:"flex items-center justify-between text-sm group hover:bg-blue-50 dark:hover:bg-blue-900/20 p-2 rounded-lg transition-colors duration-200",children:[s.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300 group-hover:text-blue-600 dark:group-hover:text-blue-400",children:a.country||"Inconnu"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-32 h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-blue-600 rounded-full transition-all duration-500 ease-out",style:{width:a.clicks/(K[e.id].clicks||1)*100+"%"}})}),s.jsxs("span",{className:"font-semibold text-gray-600 dark:text-gray-400 min-w-[4rem] text-right",children:[a.clicks," ",s.jsx("span",{className:"text-xs",children:"clics"})]})]})]},t))})]}),K[e.id].devices&&K[e.id].devices.length>0&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md hover:shadow-lg transition-shadow duration-300",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"p-2 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg shadow-md",children:s.jsx(C,{className:"w-5 h-5 text-white"})}),s.jsx("span",{className:"font-bold text-base dark:text-white",children:"ğŸ’» Appareils utilisÃ©s"})]}),s.jsx("div",{className:"flex flex-wrap gap-3",children:K[e.id].devices.map((e,a)=>s.jsxs(u,{className:`\n                                    gap-2 px-4 py-2 rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all duration-300 hover:scale-110\n                                    ${"mobile"===e.device_type?"bg-gradient-to-r from-pink-500 to-rose-500 text-white border-none":"bg-gradient-to-r from-blue-500 to-cyan-500 text-white border-none"}\n                                  `,children:["mobile"===e.device_type?s.jsx(z,{className:"w-4 h-4"}):s.jsx(C,{className:"w-4 h-4"}),s.jsx("span",{children:e.device_type||"Inconnu"}),s.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full",children:e.clicks})]},a))})]}),K[e.id].browsers&&K[e.id].browsers.length>0&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md hover:shadow-lg transition-shadow duration-300",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"p-2 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg shadow-md",children:s.jsx(_,{className:"w-5 h-5 text-white"})}),s.jsx("span",{className:"font-bold text-base dark:text-white",children:"ğŸŒ Navigateurs"})]}),s.jsx("div",{className:"flex flex-wrap gap-3",children:K[e.id].browsers.map((e,a)=>s.jsxs(u,{className:"gap-2 px-4 py-2 rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all duration-300 hover:scale-110 bg-gradient-to-r from-orange-500 to-amber-500 text-white border-none",children:[s.jsx(_,{className:"w-4 h-4"}),s.jsx("span",{children:e.browser||"Inconnu"}),s.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full",children:e.clicks})]},a))})]})]}),e.tags&&e.tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-3",children:e.tags.map((e,a)=>s.jsx(u,{variant:"outline",className:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600",children:e},a))})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(x,{size:"sm",variant:"outline",onClick:()=>(async e=>{try{F(e.id);const s=await i.getCustomLinkAnalytics(e.id,"30d");s&&(Q(a=>({...a,[e.id]:s})),await r.updateLinkAnalytics(e.id,s),await W(),await J(),E({title:"Analytics mis Ã  jour ! ğŸ“Š",description:`${s.clicks||0} clics â€¢ ${s.uniqueClicks||0} visiteurs uniques`}))}catch(s){E({title:"Erreur",description:"Impossible de rÃ©cupÃ©rer les analytics",variant:"destructive"})}finally{F(null)}})(e),disabled:D===e.id,children:D===e.id?s.jsx(j,{className:"w-4 h-4 animate-spin"}):s.jsx(L,{className:"w-4 h-4"})}),s.jsx(x,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce lien ?"))try{await r.deleteLink(S.id,e),await W(),await J(),E({title:"Lien supprimÃ© ! ğŸ—‘ï¸",description:"Le lien a Ã©tÃ© supprimÃ© avec succÃ¨s"})}catch(s){E({title:"Erreur",description:"Impossible de supprimer le lien",variant:"destructive"})}})(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:s.jsx(q,{className:"w-4 h-4"})})]})]})})},e.id)})})]}):s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsx(l,{className:"w-96",children:s.jsxs(n,{children:[s.jsx(d,{children:"Connexion requise"}),s.jsx(c,{children:"Vous devez Ãªtre connectÃ© pour voir vos liens partagÃ©s"})]})})})}export{S as default};
