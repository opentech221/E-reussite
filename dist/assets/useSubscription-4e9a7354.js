import{r as t}from"./vendor-react-470eca1f.js";import{e as r,s as e}from"./index-80385b81.js";const a=()=>{const{user:a}=r(),[n,s]=t.useState(null),[i,o]=t.useState(!0),[c,u]=t.useState(null),l=async()=>{if(a)try{o(!0),u(null);const{data:t,error:r}=await e.rpc("get_subscription_status",{p_user_id:a.id});if(r)throw r;s(t)}catch(t){u(t.message)}finally{o(!1)}else o(!1)};return t.useEffect(()=>{a&&l()},[a]),{subscription:n,loading:i,error:c,hasSubscription:(null==n?void 0:n.has_subscription)||!1,isActive:(null==n?void 0:n.is_active)||!1,status:(null==n?void 0:n.status)||"none",daysRemaining:(null==n?void 0:n.days_remaining)||0,trialEndDate:null==n?void 0:n.trial_end_date,paymentStatus:null==n?void 0:n.payment_status,startFreeTrial:async()=>{if(!a)throw new Error("Utilisateur non connecté");try{o(!0),u(null);const{data:t,error:r}=await e.rpc("start_free_trial",{p_user_id:a.id});if(r)throw r;return await l(),t}catch(t){throw u(t.message),t}finally{o(!1)}},checkAccess:async()=>{if(!a)return!1;try{const{data:t,error:r}=await e.rpc("check_user_access",{p_user_id:a.id});if(r)throw r;return t}catch(t){return!1}},completePayment:async(t,r,n=null)=>{if(!a)throw new Error("Utilisateur non connecté");try{o(!0),u(null);const{data:s,error:i}=await e.rpc("complete_payment",{p_user_id:a.id,p_transaction_id:t,p_payment_method:r,p_phone_number:n});if(i)throw i;return await l(),s}catch(s){throw u(s.message),s}finally{o(!1)}},getTransactionHistory:async()=>{if(!a)return[];try{const{data:t,error:r}=await e.from("payment_transactions").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});if(r)throw r;return t||[]}catch(t){return[]}},refreshStatus:l}};export{a as u};
